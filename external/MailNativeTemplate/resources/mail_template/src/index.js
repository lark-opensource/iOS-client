parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"C4qV":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some(function(t,r){return t[0]===e&&(n=r,!0)}),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var n=t(this.__entries__,e),r=this.__entries__[n];return r&&r[1]},e.prototype.set=function(e,n){var r=t(this.__entries__,e);~r?this.__entries__[r][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,r=t(n,e);~r&&n.splice(r,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,r=this.__entries__;n<r.length;n++){var i=r[n];t.call(e,i[1],i[0])}},e}()}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},o=2;function s(t,e){var n=!1,r=!1,s=0;function c(){n&&(n=!1,t()),r&&h()}function a(){i(c)}function h(){var t=Date.now();if(n){if(t-s<o)return;r=!0}else n=!0,r=!1,setTimeout(a,e);s=t}return h}var c=20,a=["top","right","bottom","left","width","height","size","weight"],h="undefined"!=typeof MutationObserver,u=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=s(this.refresh.bind(this),c)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},t.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),h?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,n=void 0===e?"":e;a.some(function(t){return!!~n.indexOf(t)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),f=function(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];Object.defineProperty(t,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return t},d=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||r},p=E(0,0,0,0);function v(t){return parseFloat(t)||0}function _(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduce(function(e,n){return e+v(t["border-"+n+"-width"])},0)}function l(t){for(var e={},n=0,r=["top","right","bottom","left"];n<r.length;n++){var i=r[n],o=t["padding-"+i];e[i]=v(o)}return e}function b(t){var e=t.getBBox();return E(0,0,e.width,e.height)}function m(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return p;var r=d(t).getComputedStyle(t),i=l(r),o=i.left+i.right,s=i.top+i.bottom,c=v(r.width),a=v(r.height);if("border-box"===r.boxSizing&&(Math.round(c+o)!==e&&(c-=_(r,"left","right")+o),Math.round(a+s)!==n&&(a-=_(r,"top","bottom")+s)),!w(t)){var h=Math.round(c+o)-e,u=Math.round(a+s)-n;1!==Math.abs(h)&&(c-=h),1!==Math.abs(u)&&(a-=u)}return E(i.left,i.top,c,a)}var y="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof d(t).SVGGraphicsElement}:function(t){return t instanceof d(t).SVGElement&&"function"==typeof t.getBBox};function w(t){return t===d(t).document.documentElement}function g(t){return n?y(t)?b(t):m(t):p}function O(t){var e=t.x,n=t.y,r=t.width,i=t.height,o="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,s=Object.create(o.prototype);return f(s,{x:e,y:n,width:r,height:i,top:n,right:e+r,bottom:i+n,left:e}),s}function E(t,e,n,r){return{x:t,y:e,width:n,height:r}}var M=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=E(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=g(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),A=function(){return function(t,e){var n=O(e);f(this,{target:t,contentRect:n})}}(),x=function(){function t(t,n,r){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof d(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new M(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof d(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new A(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),T="undefined"!=typeof WeakMap?new WeakMap:new e,R=function(){return function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=u.getInstance(),r=new x(e,n,this);T.set(this,r)}}();["observe","unobserve","disconnect"].forEach(function(t){R.prototype[t]=function(){var e;return(e=T.get(this))[t].apply(e,arguments)}});var D=void 0!==r.ResizeObserver?r.ResizeObserver:R,j=exports.default=D;
},{}],"cxKd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.adjustImgPlaceholder=n,exports.removePlaceholder=o,exports.showImgPlaceholder=r;var e=require("./utils"),t=require("./commands"),i=null;function r(t,r,n,a){var s;if(t.parentNode.classList.contains("loading_container"))s=t.parentNode;else{var o,h=(o=(0,e.checkEnableImageQueue)()?d(t,r):l(t,n)).height,g=o.width;if(h&&g){if(s=document.createElement("div"),(0,e.isNumeric)(g)?s.style.width="".concat(g,"px"):s.style.width=g,(0,e.isNumeric)(h)?s.style.height="".concat(h,"px"):s.style.height=h,s.classList.add("loading_container"),(0,e.checkEnableImageQueue)()){if(o.paddingTop){var p=document.createElement("div");p.style.paddingTop=o.paddingTop,p.style.width="0px",p.style.height="0px",s.style.height="auto",s.append(p)}s.classList.add("loadingMinSize")}t.parentNode.insertBefore(s,t),s.append(t),(0,e.hideDomElement)(t)}}if(s){var c=getComputedStyle(s),u=(g=parseFloat(c.width),h=parseFloat(c.height),s.querySelector(".loading_svg"));u&&u.remove();var v=s.querySelector(".error_div");v&&v.remove();var C=s.querySelector(".error_svg");C&&(s.classList.remove("show_error"),C.remove());var m=s.querySelector(".intercept_svg");if(m&&m.remove(),h>0&&g>0&&!a)if(s.classList.add("withBackground"),(0,e.hideDomElement)(t),n){var w=(0,e.convertToNodeFirstElementByStr)('<svg class="intercept_svg" width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8.9 9.76L6.226 7.11732C5.92976 6.82054 5.44955 6.82054 5.15331 7.11732L2 10.2764V2.5H13.09L13.3718 2.02L14.25 0.5H2C0.9 0.5 0 1.4 0 2.5V17.5C0 18.6 0.9 19.5 2 19.5H3.28L8.9 9.76Z"/>\n<path d="M18.9655 5.43994C18.9655 6.4895 18.1166 7.33994 17.0689 7.33994C16.0213 7.33994 15.1724 6.4895 15.1724 5.43994C15.1724 4.39038 16.0213 3.53994 17.0689 3.53994C18.1166 3.53994 18.9655 4.39038 18.9655 5.43994Z"/>\n<path d="M17.33 0.5H20C21.1 0.5 22 1.4 22.0001 2.5V17.5C22.0001 18.6 21.1 19.5 20 19.5H6.34996L10.86 11.6906L13.6553 14.56L16.912 11.2973C17.2083 11.0005 17.6885 11.0005 17.9847 11.2973L19.2338 12.5487L20 13.33L20 2.5H16.17L16.4496 2.02L17.33 0.5Z"/>\n</svg>');if(s.appendChild(w),!(0,e.checkEnableImageQueue)()){g<48&&(s.style.width="".concat(48,"px")),h<48&&(s.style.height="".concat(48,"px"))}}else if(r){s.classList.add("show_error");var f=(0,e.convertToNodeFirstElementByStr)('<svg class="error_svg" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.87 2.05999C21.42 2.05999 21.87 2.50999 21.87 3.05999V8.64499L19.87 10.645V4.05999H3.86999V20.06H10.455L8.455 22.06H2.87C2.32 22.06 1.87 21.61 1.87 21.06V3.05999C1.87 2.50999 2.32 2.05999 2.87 2.05999H20.87ZM21.87 11.47V21.055C21.87 21.605 21.42 22.055 20.87 22.055H11.285L13.285 20.055H19.87V13.47L21.87 11.47ZM17.755 10.245C17.835 10.325 17.87 10.425 17.87 10.53V12.65L12.455 18.06H10.095C10.065 18.06 10.04 18.055 10.01 18.05L5.73 18.04C5.61 18.04 5.5 17.965 5.455 17.855C5.41 17.745 5.435 17.615 5.52 17.53L9.65499 13.395C9.81 13.24 10.065 13.24 10.22 13.395L12.125 15.3L17.18 10.245C17.345 10.08 17.6 10.08 17.755 10.245ZM17.87 15.47V17.755C17.87 17.92 17.735 18.055 17.57 18.055H15.28L17.87 15.47ZM8.87 6.05999V9.05999H5.87V6.05999H8.87Z"/></svg>'),N=window.retryWording;if(N){var y='<span style="font-size:12px; line-height:1em; font-weight:400; color:var(--text-caption); padding-top:6px">'.concat(N,"</span>"),x=(0,e.convertToNodeFirstElementByStr)(y),L=i;if(L||(L=i=(0,e.getTextWidth)(N,x.style.font)),L+20<=g){var I=document.createElement("div");I.style.display="flex",I.style.flexDirection="column",I.style.alignItems="center",I.appendChild(f),I.appendChild(x),I.className="error_div",s.appendChild(I)}else s.appendChild(f)}else s.appendChild(f)}else{var O=(0,e.convertToNodeFirstElementByStr)('<svg class="loading_svg" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M5.22051 5.1516C5.33192 5.0401 5.46421 4.95165 5.6098 4.89128C5.7554 4.83091 5.91146 4.79981 6.06908 4.79975C6.2267 4.79969 6.38278 4.83068 6.52842 4.89095C6.67407 4.95121 6.80641 5.03958 6.9179 5.15099C7.02939 5.2624 7.11785 5.39468 7.17822 5.54028C7.23859 5.68588 7.26969 5.84194 7.26975 5.99956C7.2698 6.15717 7.23882 6.31326 7.17855 6.4589C7.11829 6.60454 7.02992 6.73689 6.91851 6.84838C6.24533 7.52037 5.71161 8.31878 5.34803 9.19773C4.98444 10.0767 4.79816 11.0188 4.7999 11.97C4.7999 15.9642 8.02429 19.2 11.9999 19.2C15.9755 19.2 19.1999 15.9642 19.1999 11.97C19.1999 11.6517 19.3263 11.3465 19.5514 11.1215C19.7764 10.8964 20.0816 10.77 20.3999 10.77C20.7182 10.77 21.0234 10.8964 21.2484 11.1215C21.4735 11.3465 21.5999 11.6517 21.5999 11.97C21.5999 17.2878 17.3027 21.6 11.9999 21.6C6.6971 21.6 2.3999 17.2878 2.3999 11.97C2.3999 9.37799 3.4271 6.94618 5.22051 5.1516Z"/></svg>');s.appendChild(O)}else r&&s.classList.add("show_error")}}function n(i,n,a,s){if(i&&(i.onload=i.onerror=function(){},n.loaded=i.loaded),(0,e.setImageCls)(n),s)r(n,!0,!1);else{n.onImgLoad=function(){},(0,e.showDomElement)(n),n.onload=n.onerror=function(){},t.Commands.imageOnLoad(a,Date.now());var l=n.parentNode;l.classList.contains("loading_container")&&(l.parentNode.insertBefore(n,l),l.remove())}}function a(e){return{width:parseInt(e.getAttribute("data-realwidth")),height:parseInt(e.getAttribute("data-realheight"))}}function s(e){return{width:parseFloat(e.getAttribute("width")),height:parseFloat(e.getAttribute("height"))}}function l(t,i){var r=getComputedStyle(t);if(("none"===r.display||"hidden"===r.visibility)&&!i)return{width:0,height:0};var n=a(t),l=n.width,o=n.height,d=s(t),h=parseInt(d.width),g=parseInt(d.height),p=parseInt(t.style.width),c=parseInt(t.style.height),u=(0,e.getContentPageWidth)();if((0,e.isNullOrNaN)(l)||(0,e.isNullOrNaN)(o)){o=l=(0,e.isMailClient)()||i?48:160;var v=(0,e.isNullOrNaN)(c)||(0,e.isNullOrNaN)(p),C=(0,e.isNullOrNaN)(g)||(0,e.isNullOrNaN)(h);if(v&&C)return o=l=g||h||o,l&&l>u&&(o=l=(0,e.getContentPageWidth)()),{width:l,height:o}}var m=p||h,w=t.style.width.indexOf("px")>-1,f=t.style.width.indexOf("%")>-1;m&&f?m=t.style.width:!w&&h&&(m=h);var N=c||g,y=t.style.height.indexOf("px")>-1,x=t.style.height.indexOf("%")>-1;return N&&x?N=t.style.height:!y&&g&&(N=g),(0,e.isNullOrNaN)(m)?(0,e.isNullOrNaN)(N)||x?(m=l,N=o):m=N/o*l:(0,e.isNullOrNaN)(N)&&(N=m/l*o),u&&m>u&&(N*=u/m,m=u),{width:m,height:N}}function o(t){(0,e.showDomElement)(t);var i=t.parentNode;i.classList.contains("loading_container")&&(i.parentNode.insertBefore(t,i),i.remove())}function d(t,i){var r,n,a,s,l=getComputedStyle(t);if("none"===l.display||"hidden"===l.visibility)return{width:0,height:0};if(((0,e.isNullOrNaN)(t.alt)||""===t.alt)&&!i)var o=t.getBoundingClientRect(),d=o.width,g=o.height;var p=(0,e.getContentPageWidth)(),c=parseInt(t.getAttribute("data-realwidth")),u=parseInt(t.getAttribute("data-realheight")),v=parseInt(t.getAttribute("data-width")),C=parseInt(t.getAttribute("data-height"));if(d&&g?r=d/g:c&&u?r=c/u:v&&C&&(r=v/C),r)n=Math.min(d||c||v,p),s=1/r*100+"%";else{n=d||t.getAttribute("width"),a=g||t.getAttribute("height");var m=t.style.width;!n&&m.indexOf("px")>1?n=parseInt(m):!n&&m.indexOf("%")>1&&(n=m);var w=t.style.height;!a&&w.indexOf("px")>1?a=parseInt(w):!a&&w.indexOf("%")>1&&(a=w),n&&(0,e.isNumeric)(n)&&(n=Math.min(n,p)),n&&(0,e.isNumeric)(n)&&a&&(0,e.isNumeric)(a)&&(s=1/(r=n/a)*100+"%")}return{width:h(n),height:h(a),paddingTop:s}}function h(t){return t&&(0,e.isNumeric)(t)?t>0&&t<10?0:t+"px":t||"auto"}
},{"./utils":"FOZT","./commands":"TnH5"}],"KACJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addForceLoadingImage=l,exports.getHasImage=m,exports.initImageQueue=h,exports.setHasImage=u;var t=require("./commands"),e=require("./imagePlaceholder"),n=require("./utils"),a=require("./index");function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){d=!0,s=t},f:function(){try{r||null==n.return||n.return()}finally{if(d)throw s}}}}function o(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}try{if(IntersectionObserver)var r=new IntersectionObserver(function(t){var e,n=i(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;if(a.isIntersecting){var o=a.target.classList.contains("loading_container"),s=a.target;o&&(s=a.target.querySelector("img")),I.getInstance().imageEnterViewport(s)}}}catch(r){n.e(r)}finally{n.f()}I.getInstance().startQueue()},{threshold:0})}catch(w){t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," IntersectionObserver not available:")+w,t.LogLevel.error)}var d=13;function g(t){var e;return t.closest&&(e=t.closest(".message-item")),e?e.querySelectorAll("div.message-content img"):(0,n.$$)("div.message-content img")}var c=!1;function u(){c=!0}function m(){return c}function h(e,n){t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," start init"));var a,o=i(g(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;I.getInstance().addImageNode(s,!1,n)}}catch(d){o.e(d)}finally{o.f()}var r=I.getInstance().length();return I.getInstance().startQueue(),0!==r&&u(),0!==r}function l(t,e){I.getInstance().addImageNode(t,!0,e),I.getInstance().startQueue()}var I=function(){var e;function a(){this.imageNodeHighSet=new Set,this.imageNodeLowSet=new Set,this.imagesRunning=new Set,this.maxLowRunningNum=(0,n.isIOS)()?Number.MAX_SAFE_INTEGER:4,this.maxRunningNum=(0,n.isIOS)()?Number.MAX_SAFE_INTEGER:6,this.taskNum=0}function i(t){var e=t.imageTask.loadingContainer();r&&(e&&r.unobserve(e),r.unobserve(t))}return a.prototype.addImageNode=function(e,n,a){if(this.taskNum=this.taskNum+1,e.imageTask=e.imageTask||new N(e,this.taskNum,a),n&&(e.imageTask.status=f.INIT,e.imageTask.isBlock=a),e.imageTask.status===f.INIT)if(t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," function:").concat("addImageNode".padEnd(d," ")," logId:").concat(e.imageTask.logId()," isInViewport:").concat(e.imageTask.isInViewport," forceLoading:").concat(n)),e.imageTask.status=f.PENDING,e.imageTask.isInViewport)this.imageNodeHighSet.add(e),t.Commands.imageLoadingOnScreen(e.imageTask.src),e.imageTask.showLoadingContainer(!0);else if(this.imageNodeHighSet.add(e),r){var i=e.imageTask.loadingContainer();i?r.observe(i):r.observe(e)}else e.imageTask.showLoadingContainer()},a.prototype.finishTask=function(e,n){t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," function:").concat("finishTask".padEnd(d," ")," logId:").concat(e.imageTask.logId()," shouldUnobserve:").concat(n," length:").concat(this.length())),this.imagesRunning.delete(e),n&&i(e)},a.prototype.startQueue=function(){var e;this.imageNodeHighSet.size>0&&this.imagesRunning.size<=this.maxRunningNum&&(e=this.imageNodeHighSet.keys().next().value,this.imageNodeHighSet.delete(e)),!e&&this.imageNodeLowSet.size>0&&this.imagesRunning.size<=this.maxLowRunningNum&&(e=this.imageNodeLowSet.keys().next().value,this.imageNodeLowSet.delete(e)),e&&(t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," function:").concat("startTask".padEnd(d," ")," logId:").concat(e.imageTask.logId()," status:").concat(e.imageTask.status," isInViewport:").concat(e.imageTask.isInViewport)),e.imageTask.status===f.PENDING&&(this.imagesRunning.add(e),e.imageTask.startTask()),this.startQueue())},a.prototype.imageEnterViewport=function(e){t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," function:").concat("enterViewport".padEnd(d," ")," logId:").concat(e.imageTask.logId()," status:").concat(e.imageTask.status)),this.imageNodeLowSet.delete(e)&&(e.imageTask.isInViewport=!0,this.imageNodeHighSet.add(e)),i(e),t.Commands.imageLoadingOnScreen(e.imageTask.src),e.imageTask.showLoadingContainer()},a.prototype.length=function(){return this.imageNodeHighSet.size+this.imageNodeLowSet.size},{getInstance:function(){return e||(e=new a)}}}(),f={INIT:0,PENDING:1,INTERCEPT:2,LOADING:3,COMPLETE:4,ERRORED:5},N=function(){function i(t,e,a){this.imageNode=t,this.isBlock=a,this.src=function(t){var e=t.src,a=t.getAttribute("cid-data-src");(0,n.isNullOrNaN)(a)||(e=a);var i=t.getAttribute("intercepted-data-src");(0,n.isNullOrNaN)(i)||(e=i);return e}(t),this.isInViewport=function(t){var e=t,n=t.parentNode;n.classList.contains("loading_container")&&(e=n);if(e&&e.getBoundingClientRect){var a=e.getBoundingClientRect(),i=a.bottom>0&&a.bottom<window.innerHeight+a.height,o=a.left>0&&a.left<window.innerWidth+a.width;return i&&o}return!1}(t),t.hasAttribute("intercepted-data-src")?this.status=f.INTERCEPT:this.status=f.INIT,this.id=e.toString().padStart(5,"0")}function o(t,e){t.onload=t.onerror=function(){},I.getInstance().finishTask(t,e),setTimeout(function(){I.getInstance().startQueue()})}return i.prototype.logId=function(){return this.id},i.prototype.loadingContainer=function(){var t=this.imageNode.parentNode;if(t.classList.contains("loading_container"))return t},i.prototype.showLoadingContainer=function(t){var a=this;(0,n.setImageCls)(this.imageNode),this.status===f.INTERCEPT&&(0,e.showImgPlaceholder)(this.imageNode,!1,!0),this.status===f.PENDING&&((0,e.showImgPlaceholder)(this.imageNode,!1,!1,t),t&&setTimeout(function(){a.showLoadingContainer(!1)},300)),this.status===f.LOADING&&(0,e.showImgPlaceholder)(this.imageNode,!1,!1),this.status===f.ERRORED&&(0,e.showImgPlaceholder)(this.imageNode,!0,!1),this.status===f.COMPLETE&&(0,e.removePlaceholder)(this.imageNode)},i.prototype.startTask=function(){var t=this;this.isInViewport||"none"!==this.imageNode.style.display||this.loadingContainer()?(this.status=f.LOADING,this.isInViewport?this.startDownload():setTimeout(function(){t.startDownload()},0)):o(this.imageNode,!1)},i.prototype.startDownload=function(){var e,n,i;this.imageNode.src===this.src?(n=!1,e=new Image):(n=!0,e=this.imageNode),e.onload=function(e,n){return function(){var i=e.imageNode;n||(i.src=e.src),e.status=f.COMPLETE,t.Commands.imageOnLoad(e.src,Date.now()),i.imageTask.showLoadingContainer(),(0,a.scaleOnImgLoad)(i),o(i,!0)}}(this,n),e.onerror=(i=this,function(){t.Commands.log("MailImageQueue:threadId:".concat(window.t_id," function:").concat("onerror".padEnd(d," ")," logId:").concat(i.logId()));var e=i.imageNode;i.status=f.ERRORED,t.Commands.imageOnError(i.src,Date.now()),e.imageTask.showLoadingContainer(),(0,a.scaleOnImgLoad)(e),o(e,!0)}),t.Commands.imageStartLoad(this.src,Date.now(),this.isBlock),e.src=this.src},i}();
},{"./commands":"TnH5","./imagePlaceholder":"cxKd","./utils":"FOZT","./index":"Focm"}],"WwWL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScaleOperation=void 0,exports.isInProtectedMode=L,exports.removeAutoTableTD=ge,exports.removeScaleBreakWord=pe,exports.removeTableWrapperIfNeed=P,exports.rescaleOnResize=C,exports.resetRevertableStyles=fe,exports.revertNodeStyles=ve,exports.scaleOptimizeFeat=I,exports.setHardCodeStyle=le,exports.setNeedsScale=D,exports.setRevertableStyle=de,exports.setRevertableStyleScale=ue,exports.setTableScale=ce,exports.shouldOptimizeLongText=N,exports.shouldOptimizeScale=b,exports.shouldOptimizeScalePerformance=w,exports.shouldScaleMessageContent=A,exports.updateScaledTableHeight=se;var e=require("./commands"),t=require("./utils"),n=a(require("resize-observer-polyfill")),r=require("./contentImage");function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return c(e)||i(e,t)||h(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,l,i=[],c=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(s)throw a}}return i}}function c(e){if(Array.isArray(e))return e}function s(e){return d(e)||u(e)||h(e)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e){if(Array.isArray(e))return g(e)}function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw o}}}}function h(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p="larkRevertable";if(A())var v=new n.default(function(t,n){var r=[];e.Commands.log("fixContentScale resizeObs",!0);var a,o=m(t);try{for(o.s();!(a=o.n()).done;){var l=a.value;if(e.Commands.log("fixContentScale resizeObs tag: ".concat(l.target.tagName,", class: ").concat(l.target.classList),!0),l.target&&l.target.closest){var i=l.target.closest(".message-item");r.push(i)}}}catch(c){o.e(c)}finally{o.f()}r.length>0&&D(s(new Set(r)))});var y,x=exports.ScaleOperation={none:0,fixHardCodeWidth:1,fixHardCodeMinWidth:2,fixHardCodeScrollHeight:4,fixTableScale:8},S={medium:"16px","xx-small":"9px","x-small":"10px",small:"13px",large:"18px","x-large":"24px","xx-large":"32px"};function C(){return(0,t.checkIsTrue)(window.rescaleOnResize)}function b(){return(0,t.checkIsTrue)(window.scaleOptimize)}function w(){return(0,t.checkIsTrue)(window.scalePerformance)}function A(){return b()&&(0,t.checkIsTrue)(window.scaleMessageContent)}function L(){return(0,t.checkIsTrue)(window.openProtectedMode)}function N(){return(0,t.checkIsTrue)(window.longTextOptimize)}function I(){var e="";return b()&&(e+="scaleoptimize"),A()&&(e+="scalemessagecontent"),e+="optimizeImgDownload",w()&&(e+="scalePerformance"),N()&&(e+="longText"),(0,t.checkEnableImageQueue)()&&(e+="ImageQueue"),(0,r.getHasImage)()&&(e+="hasImage"),e}function O(e){!w()&&v&&e&&v.observe(e)}function T(e){!w()&&v&&e&&v.unobserve(e)}var M,k,q=0,z=!1,E=Date.now(),_=Date.now(),F=0;function H(t){if(e.Commands.log("fixContentScale newFixScaleIn",!0),Date.now()-E>500&&Date.now()-_<2e3){if(F+=1,e.Commands.log("fixContentScale scale frequency ".concat(F),!0),F>5)return Array.from(document.querySelectorAll(".".concat($))).forEach(function(e){var t=e.children[0];t&&T(t)}),void e.Commands.log("fixContentScale scale too frequent, ignore!",!0)}else _=Date.now(),F=0;if(q+=1,!z){z=!0;setTimeout(function(){if(y){var t={first_scale_cost:y,scale_count:q,optimize_feat:I()};e.Commands.track("email_scale_performance_dev",t)}},2e3)}try{var n=Date.now();if(t)for(var r,a,o=function(){var n=t[l];if(n){var o=n.querySelector(".outer-content-container");if(o){o.style.height="",r=parseInt(getComputedStyle(o).paddingLeft),r=isNaN(r)?0:r;var i=o.offsetWidth-r;0===(a=n.querySelectorAll(".message-content > .message-inner-content")).length&&(a=n.querySelectorAll(".message-content > .".concat($," > .message-inner-content"))),a.forEach(function(t){"none"!==getComputedStyle(t).display&&(R(t,i),w()&&oe(t)&&(e.Commands.log("fixContentScale update wrapper size after update scroll height",!0),j(t)))}),n.querySelectorAll(".message-content > .history-quote-outer-wrapper").forEach(function(t){var n=t.querySelector(".history-quote-read-block");n&&"none"!==getComputedStyle(n).display&&(R(n,i),w()&&oe(n)&&(e.Commands.log("fixContentScale update wrapper size after update scroll height",!0),j(n)))})}}},l=0;l<t.length;l++)o();y||(y=Date.now()-n)}catch(i){e.Commands.log("fixContentScale newFixScaleIn error "+i,e.LogLevel.error)}}var W=[];function D(t){if(!L()){e.Commands.log("fixContentScale setNeedsScale",!0);var n=Date.now()-E>500?200:0;if(M)return e.Commands.log("fixContentScale have scale timer",!0),void(W&&t.forEach(function(e){for(var t=!1,n=e.getAttribute("message-id"),r=0;r<W.length;r++){var a=W[r];if(a){var o=a.getAttribute("message-id");if(o&&o==n){t=!0;break}}}t||W.push(e)}));var r=null==k?Number.MAX_VALUE:Date.now()-k;if(r>=n)return e.Commands.log("fixContentScale direct scale",!0),k=Date.now(),void H(t);var a=n-r;e.Commands.log("fixContentScale delay scale ".concat(a),!0),W=t,M=setTimeout(function(){e.Commands.log("fixContentScale excute timeout scale",!0),M=null,k=Date.now(),H(W),W=[]},a)}}function B(e){var t=getComputedStyle(e),n=parseFloat(t.marginLeft)+parseFloat(t.marginRight),r=e.scrollWidth,a=e.parentNode.getAttribute("lark-scale");return console.log("fixContentScale scollWidth ".concat(r,", sideMargin ").concat(n,", scaleFactor ").concat(a)),a&&(r*=a),n<0?r+n:r}function R(t,n){var r=B(t);if(e.Commands.log("fixContentScale scrollWidth ".concat(r,", offsetWidth ").concat(n)),r<=n)return e.Commands.log("fixContentScale updateScaleWrapperSizeIfNeed",!0),j(t),!0;var a=t.parentNode;t.classList.contains(Q)&&a&&!a.classList.contains($)&&(e.Commands.log("fixContentScale trigger by resize",!0),t.classList.remove(Q));var o,l,i=Date.now(),c=!1;(re(t.querySelectorAll("div[style], textarea[style]"),n)&&(r=B(t))<=n&&(c=!0,e.Commands.log("fixContentScale fixHardCode succeed")),c)||ne(t.querySelectorAll("img"),n)&&(r=B(t))<=n&&(c=!0,e.Commands.log("fixContentScale fixImg succeed"));!c&&N()&&(ae(t.querySelectorAll("p[style], span[style]"),n)&&(r=B(t))<=n&&(c=!0,e.Commands.log("fixContentScale fixImg succeed")));(c||(te(o=t.querySelectorAll("table"),Y,Z),(r=B(t))<=n?(c=!0,e.Commands.log("fixContentScale autoTable succeed")):e.Commands.log("auto table fails")),c||(te(l=t.querySelectorAll("td"),null,ee),(r=B(t))<=n?(c=!0,e.Commands.log("fixContentScale autoTD succeed")):(he(o,l),e.Commands.log("fixContentScale Revert auto table and td"))),c)?j(t):(V(t.querySelectorAll("table"),t.parentNode,n,!0),(r=B(t))<=n&&(c=!0,e.Commands.log("fixContentScale fixTableScale succeed")));c?e.Commands.log("fixContentScale succeeded time:"+(Date.now()-i)):A()&&V([t],t.parentNode,n,!1);return w()&&j(t),c}function j(n){var r=Array.from(n.querySelectorAll(".".concat($))),a=1,o=n.parentNode;if(o.classList.contains($)){r.unshift(o);var l=o.getAttribute("lark-scale");l&&(a=l)}var i=!1,c=function(n){var r=n.children[0];if(r){var l=(0,t.getElementContentBounds)(r),c=n===o?1:a,s=n.getAttribute("lark-scale"),f=Math.ceil(Math.max(l.width/c,r.scrollWidth*s)),u=parseFloat(n.style.width),d=parseFloat(n.style.height);if(s){var m=Math.ceil(l.height/s/c);if(f!=u){var h=Math.ceil(f/s),g=n===o?U:X,p=!1;if((s=u/h)<g&&(p=!0,s=g),s&&s>0){if(de(r,"transform","scale(".concat(s,")")),n.setAttribute("lark-scale",s),n===o&&(a=s),p){var v=Math.ceil(h*s);n.style.width="".concat(v,"px")}G(r,s)}}var y=Math.ceil(m*s);Math.ceil(d)!==y&&n!==o&&(e.Commands.log("fixContentScale update wrapper size height from: ".concat(d," to ").concat(y),!0),i=!0),n.style.height="".concat(y,"px")}}};r.forEach(function(e){c(e)}),w()&&i&&c(o)}function P(e,n){var r,a=".".concat($),o=e?(0,t.findMessageItem)(e):null;r=o?o.querySelectorAll(a):(0,t.$$)(a),n&&(n.table_wrapper_count=r.length);for(var l=0;l<r.length;l++){var i=r[l];if(i&&1==i.children.length){var c=i.children[0];T(c),i.parentNode.replaceChild(c,i)}}}var $="MailScaleWrapper",Q="LTransformed",U="0.4",X="0.1";function V(n,r,a,o){e.Commands.log("fixContentScale fixTableScale",!0);return n.forEach(function(n){var l=(0,t.getElementContentBounds)(n);if(!(l.width<=0||l.height<=0||K(n.parentNode,Q))){n.classList.remove(Q),T(n),me(n,"transform"),me(n,"transform-origin");var i=n.parentNode;i.classList.contains($)&&i.parentNode.replaceChild(n,i),l=(0,t.getElementContentBounds)(n);var c=Math.ceil(Math.max(l.width,n.scrollWidth)),s=a,f=r.getBoundingClientRect().left;l.left>f&&(console.log("fixContentScale extra padding ".concat(l.left-f)),s-=l.left-f);var u=s/c,d=o?X:U;if((u=Math.max(u,d))<1){var m=document.createElement("span");m.style.display="block",m.style.overflow="hidden",m.classList.add($),n.parentNode.replaceChild(m,n),m.appendChild(n),(0,t.isAndroid)()&&(m.removeEventListener("scroll",J),m.addEventListener("scroll",J)),"table"==n.tagName.toLowerCase()&&(ie(n,m,u),l=(0,t.getElementContentBounds)(n),c=Math.ceil(Math.max(l.width,n.scrollWidth)),u=Math.max(s/c,d)),de(n,"transform","scale(".concat(u,")")),G(n,u),n.classList.add(Q),m.setAttribute("lark-scale",u);var h=s,g=Math.ceil(l.height*u);e.Commands.log("fixContentScale finish w:".concat(h,"px, h:").concat(g,"px, scale: ").concat(u),!0),de(m,"width","".concat(h,"px")),de(m,"height","".concat(g,"px")),O(n)}}}),[]}function G(e,n){var r=(0,t.getAllElementBounds)(e),a=r.outer.left-r.border.left,o=r.outer.top-r.border.top;w()&&(a/=n,o/=n),de(e,"transform-origin","".concat(a,"px ").concat(o,"px"))}function J(e){var t=e.target;t&&t.classList.contains($)&&(t.scrollTop>0&&(t.scrollTop=0),t.scrollLeft>0&&(t.scrollLeft=0))}function K(e,t){for(;e&&(!e.classList||!e.classList.contains(t));)e=e.parentNode;return e}function Y(e){return e.hasAttribute("width")||e.style.width}var Z="auto-table",ee="auto-td";function te(e,n,r){for(var a=!1,o=r===Z,l=0;l<e.length;l++){var i,c=e[l];if(!(n&&!n(c)||c.classList.contains(r)))if((0,t.isIOS)()&&o&&(i=c.getBoundingClientRect().width),c.classList.add(r),a=!0,(0,t.isIOS)()&&o){var s=c.getBoundingClientRect().width;i>0&&0===s&&c.classList.remove(r)}}return a}function ne(t,n){for(var r=!1,a=0;a<t.length;a++){var o=t[a],l=o;for(l=o;l&&(!l.tagName||"table"!==l.tagName.toLowerCase());)l=l.parentNode;if(!l){var i=o.offsetWidth,c=o.offsetHeight,s=o.style.marginLeft,f=o.style.marginRight,u=0<=(s?s.indexOf("px"):-1)?parseInt(s,10):0;u+=0<=(f?f.indexOf("px"):-1)?parseInt(f,10):0,e.Commands.log("nodeOffsetWidth is "+o.offsetWidth+", marginL is "+s+", marginR is "+f+", total margin is "+u),i+u>n&&(de(o,"max-width",n-u-f+"px"),de(o,"width","100%"),de(o,"height",c<5&&0!==c?"".concat(c,"px"):"auto"),r=!0)}}return r}function re(e,t){for(var n,r=!1,a=0;a<e.length;a++){var o=e[a],l=(n=o.style.width||o.style.minWidth)?n.indexOf("px"):-1,i=n.slice(0,l);l>=0&&i>t&&(de(o,"width","100%"),de(o,"min-width",""),de(o,"max-width","".concat(i,"px")),r=!0)}return r}function ae(e,t){for(var n,r=!1,a=0;a<e.length;a++){var o=e[a],l=(n=o.style.textIndent)?n.indexOf("px"):-1,i=1;-1===l&&(i=1.333,l=n.indexOf("pt"));var c=n.slice(0,l)*i;l>=0&&c>t&&(de(o,"text-indent","100%"),r=!0)}return r}function oe(e){for(var t=[e],n=!1;t.length>0;){var r=t.shift();if(r instanceof Element&&!r.classList.contains($)&&!r.classList.contains("loading_container"))r.scrollHeight>r.clientHeight&&(n=!0,de(r,"height","auto"));else if(r.nodeType==Node.TEXT_NODE){var a=getComputedStyle(r.parentNode);if(parseFloat(a.fontSize)>parseFloat(a.lineHeight)){for(var o=r.parentNode;o&&"inline"==getComputedStyle(o).display;)o=o.parentNode;o&&(n=!0,de(o,"line-height","normal"))}}for(var l=0;l<r.childNodes.length;l++)t.push(r.childNodes[l])}return n}function le(e,t,n,r){if(t&&de(e,"max-width",e.style.width),n&&(de(e,"max-width",e.style.minWidth),de(e,"min-width","")),de(e,"width","100%"),r){var a=getComputedStyle(e),o=parseFloat(a.width)/r;de(e,"height","".concat(o,"px"))}else de(e,"height","auto")}function ie(n,r,a){try{var o={},l=function(e){if(e.style.fontSize){me(e,"font-size");var t=parseFloat(getComputedStyle(e).fontSize),n=o["".concat(t)]||[];n.push(e),o["".concat(t)]=n}},i=function(e,n){ue(e,"font-size",n,!0),(0,t.BFSTraverseNode)(e,function(r){if(r!==e&&r.style.fontSize)return!1;if((0,t.isNumeric)(r.style.lineHeight)){if(r===e){var a=getComputedStyle(r),o=parseFloat(a.lineHeight),l=parseFloat(a.fontSize);if(!isNaN(o)&&!isNaN(l)&&l>o){var i=Math.ceil(o*n);de(r,"line-height","".concat(i,"px"),!0)}}}else ue(r,"line-height",n,!0);return!0});for(var a=e.parentNode;null!=a&&a!==r;)a.style.height&&(de(a,"min-height",a.style.height,!1),de(a,"height","",!1),de(a,"max-height","",!1)),a=a.parentNode};l(n),n.querySelectorAll("*").forEach(function(e){l(e)});for(var c,s=Object.keys(o),f=0;f<s.length;f++){(m=parseFloat(s[f]))>9&&m*a<9&&(null==c||m<c)&&(c=m)}var u;1/a*.625;var d=((c=null==c?9:c)*(u=9/(c*a))+(16-c)*a)/16;r.style.fontSize="".concat(d,"rem");for(f=0;f<s.length;f++){var m=s[f],h=o["".concat(m)];if(h)for(var g=parseFloat(m),p=g-c,v=(p>=0?c*u+p*a:g-p*a)/g,y=0;y<h.length;y++)i(h[y],v)}}catch(x){e.Commands.log("scaleFont error:"+x,e.LogLevel.error)}}function ce(e,t,n){var r=100*(1-n)/(2*n);de(e,"transform","scale("+n+") translate(-"+r+"%,-"+r+"%)",!1),de(e,"margin-left","0",!1),de(e,"margin-right","0",!1),de(e,"border-collapse","separate",!1),de(e,"border-spacing","0",!1),e.setAttribute("lark-scale",n),se(t,n)}function se(e,n){var r=e.querySelector("table");if(!isNaN(n)){var a,o=0;if(!("TABLE"==e.firstChild.tagName)){(o=e.clientHeight-r.clientHeight)>30&&(o=30)}a=r.scrollHeight*n+(0,t.getBorderHeight)(r);for(var l=e.children,i=0;i<l.length;i++)l[i]!==r&&(a+=l[i].scrollHeight+(0,t.getBorderHeight)(r));a>0&&de(e,"height","".concat(a+o,"px"),!0),de(e,"overflow","visible")}}function fe(e){for(var t=e.larkOriginStyles||{},n=0,r=Object.entries(t);n<r.length;n++){var a=o(r[n],2),l=a[0],i=a[1];e.style["".concat(l)]=i}e.larkOriginStyles=void 0,e.removeAttribute(p)}function ue(e,t,n,r){var a,o=e.larkOriginStyles||{};a=o&&null!=o["".concat(t)]?o["".concat(t)]:e.style["".concat(t)];var l=parseFloat(a);return l?(de(e,t,a.replace("".concat(l),"".concat(l*n)),r),!0):!(!a.toLowerCase||!S["".concat(a.toLowerCase())])&&(l=parseFloat(S["".concat(a.toLowerCase())]),de(e,t,"".concat(l*n,"px"),r),!0)}function de(e,t,n,r){var a=e.larkOriginStyles||{};a&&null==a["".concat(t)]&&(a["".concat(t)]=e.style["".concat(t)],e.setAttribute(p,"true"),e.larkOriginStyles=a),e.ignoreScaleCLS=!0,e.style.setProperty(t,n,r?"important":"")}function me(e,t){var n=(e.larkOriginStyles||{})["".concat(t)];null!=n&&(e.style["".concat(t)]=n,e.larkOriginStyles["".concat(t)]=void 0)}function he(e,t){for(var n=[e,t],r=0;r<n.length;r++){var a=n[r];if(a)for(var o=0;o<a.length;o++){var l=a[o];0===r?l.classList.remove(Z):l.classList.remove(ee)}}}function ge(e,n){var r=e?(0,t.findMessageItem)(e):null;if(r){var a=r.querySelectorAll(".".concat(Z)),o=r.querySelectorAll(".".concat(ee));he(a,o),n&&(n.auto_table_count=a.length,n.auto_td_count=o.length)}}function pe(e,n){var r=e?(0,t.findMessageItem)(e):null;if(r&&n){r.querySelectorAll(".".concat("scale-word-break")).forEach(function(e){e.classList.remove("scale-word-break")})}}function ve(e,n){var r,a="[".concat(p,"]"),o=e?(0,t.findMessageItem)(e):null;r=o?o.querySelectorAll(a):(0,t.$$)(a),n&&(n.modify_node_count=r.length),r.forEach(function(e){fe(e)})}
},{"./commands":"TnH5","./utils":"FOZT","resize-observer-polyfill":"C4qV","./contentImage":"KACJ"}],"FOZT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.$=c,exports.$$=u,exports.AvatarType=exports.AvatarLogHelper=void 0,exports.BFSTraverseNode=G,exports.WebTimeLogHelper=exports.ImageDownloadLogHelper=void 0,exports.addClass=Y,exports.checkEnableImageQueue=P,exports.checkIsTrue=F,exports.convertToNodeByStr=w,exports.convertToNodeFirstElementByStr=y,exports.domReadyTime=void 0,exports.findMessageItem=Q,exports.findMessageItemsByAddress=U,exports.findSiblingElement=b,exports.findSiblingElementMatchFn=_,exports.getAllElementBounds=nt,exports.getBorderHeight=N,exports.getChromeVer=p,exports.getContentPageWidth=O,exports.getElementContentBounds=K,exports.getElementFrame=I,exports.getOutsideScreenHeight=it,exports.getQuoteClassPostfix=B,exports.getTextWidth=k,exports.hideDomElement=L,exports.isAndroid=m,exports.isIOS=d,exports.isInViewport=s,exports.isMailClient=D,exports.isNull=x,exports.isNullOrNaN=S,exports.isNumeric=V,exports.isPad=A,exports.modifyLabelsRTL=at,exports.pointInsideRect=z,exports.removeClass=j,exports.setContentScrollable=v,exports.setImageCls=l,exports.shouldOptimizeAvatar=M,exports.shouldOptimizeLargeMail=R,exports.showDomElement=T,exports.stopWindowScroll=h,exports.windowScrollTo=g;var t=require("./commands"),e=require("./mailScale"),o=require("./contentImage"),r={iOS:1,Android:2,unsupported:99},n=exports.domReadyTime={value:null};function i(){var t=navigator.userAgent;return t.indexOf("Android")>-1||t.indexOf("Adr")>-1?r.Android:t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||t.indexOf("Mac OS X")>-1||t.indexOf("AppleWebKit")>-1?r.iOS:r.unsupported}var a=i();function s(t,e){if(t&&t.getBoundingClientRect){var o=t.getBoundingClientRect();return e?o.top>0&&o.bottom<window.innerHeight:o.bottom>0&&o.bottom<window.innerHeight+o.height}return!1}function l(t){for(;t;)t.ignoreImageCLS=!0,t=t.parentNode}function d(){return a==r.iOS}function m(){return a==r.Android}function p(){if(m()){var t=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return!!t&&parseInt(t[2],10)}return!1}function c(t){return document.querySelector(t)}function u(t){return document.querySelectorAll(t)}var f=null;function g(t,e){t=parseInt(t);var o=c("html"),r=o.getBoundingClientRect().height;if(t>=o.scrollHeight-r){var n=Math.ceil(t+r);document.body.style.height="".concat(n,"px")}else if(t<0)return;var i=window.pageYOffset<t;clearInterval(f),f=setInterval(function(){var o=parseInt(Math.min(Math.abs(window.pageYOffset-t),6)),r=parseInt(window.pageYOffset);o>0&&i&&r<t?window.scrollBy(0,o):o>0&&!i&&r>t?window.scrollBy(0,-o):(clearInterval(f),e&&e())},.5)}function h(){clearInterval(f)}function v(t){var e=c("html");if(t){if(e.style.top){var o=parseFloat(e.style.top);e.style.top=null,e.style.width=null,e.style.overflow=null,document.body.style.height=null,window.scrollTo(0,-o)}}else e.style.top="".concat(e.getBoundingClientRect().top,"px"),e.style.width="100%",e.style.overflow="hidden"}function w(t){var e=document.createElement("div");return e.innerHTML=t,e}function y(t){return w(t).firstElementChild}function b(t,e,o){return _(t,function(t){return t.matches(e)},o)}function _(t,e,o){if(!t)return null;for(var r=o?t.previousElementSibling:t.nextElementSibling;r&&!e(r);)r=o?r.previousElementSibling:r.nextElementSibling;return r}function x(t){try{return t.toString(),!1}catch(e){return!0}}function S(t){return x(t)||"number"==typeof t&&isNaN(t)}var E,C="NoDisplay";function L(t){if(!x(t)&&!t.classList.contains("display-none")){if(null==t.getAttribute("lark-pre-display")){var e=t.style.display;x(e)||"none"==e?t.setAttribute("lark-pre-display",C):t.setAttribute("lark-pre-display",e)}t.style.setProperty("display","none","important")}}function T(t){if(!x(t)){var e=t.getAttribute("lark-pre-display");for(null!=e&&(e==C?t.style.setProperty("display",""):t.style.setProperty("display",e),t.removeAttribute("lark-pre-display"));t.classList.contains("display-none");)t.classList.remove("display-none")}}function N(t){var e=getComputedStyle(t);return parseFloat(e.getPropertyValue("border-top-width")||"0px")+parseFloat(e.getPropertyValue("border-bottom-width")||"0px")}function I(t){if(t&&t.getBoundingClientRect){var e=t.getBoundingClientRect();return{x:e.x,y:e.y,width:e.width,height:e.height}}}function A(){return"true"===window.isPad}function D(){return"true"===window.isMailClient}function M(){return F(window.optimizeAvatar)}function R(){return F(window.optimizeLargeMail)}function P(){return F(window.enableImageQueue)}function F(t){return"string"==typeof t&&"true"===t.toLowerCase()||("boolean"==typeof t&&!0===t||"number"==typeof t&&0!==t)}function O(){if(!E){var e=document.querySelector(".message-item.expand .item-content");if(e)E=parseFloat(getComputedStyle(e).width),t.Commands.log("contentWidth with expand ".concat(E),!0);else{var o=document.querySelector(".message-item");if(o){var r=parseFloat(getComputedStyle(o).width);E=r-32,t.Commands.log("contentWidth with messageItem ".concat(E),!0)}else t.Commands.log("messageItem not found",t.LogLevel.error)}}return E}function z(e,o,r){if(null==e.x||null==e.y||null==e.width||null==e.height||null==o.x||null==o.y)return t.Commands.log("pointInsideRect not valid params"),!1;var n=(r=r||{top:0,right:0,bottom:0,left:0}).top||0,i=r.right||0,a=r.bottom||0,s=r.left||0,l=o.x>=e.x+s&&o.x<=e.x+e.width-i,d=o.y>=e.y+n&&o.y<=e.y+e.height-a;return l&&d}function V(t){return!isNaN(+t)}function B(t){if(t.matches("[larkmailquote=true]"))return t.className.replace(/[^0-9]/gi,"");if(t){var e=t.querySelector("[larkmailquote=true]");if(e)return e.className.replace(/[^0-9]/gi,"")}}function k(e,o){try{var r=document.createElement("canvas").getContext("2d");return r.font=o,r.measureText(e).width}catch(n){t.Commands.log("getTextSize error ".concat(n))}}var H,W=exports.WebTimeLogHelper=function(){function r(){this.startDelayTime=0,this.startInitTime=0,this.endInitTime=0}function n(t,e){return 0===e||t-e<0?0:t-e}return r.prototype.startDelay=function(){this.startDelayTime=Date.now()},r.prototype.startInit=function(){this.startInitTime=Date.now()},r.prototype.endInit=function(t){this.endInitTime=Date.now(),this.messageCount=t},r.prototype.reportWebTime=function(){var r={},i=function(){var t=window.navigator.userAgent.toLowerCase(),e={name:"unknown",version:0};/(ttwebview)\D+(\d[\d.]*)/.test(t)?(e.name=RegExp.$1,e.version=RegExp.$2):/(chrome|firefox|opera|netscape|msie|safari)\D+(\d[\d.]*)/.test(t)?(e.name=RegExp.$1,e.version=RegExp.$2):/(applewebkit)\D+(\d[\d.]*)/.test(t)&&(e.name=RegExp.$1,e.version=RegExp.$2);return e}(),a=!1;try{var s=performance.timing;r.web_response_time=n(s.responseEnd,s.responseStart),r.web_dom_time=n(s.domContentLoadedEventStart,s.responseEnd),r.web_dcl_time=n(s.domContentLoadedEventEnd,s.domContentLoadedEventStart),r.web_resources_time=n(s.loadEventStart,s.domContentLoadedEventEnd),r.web_onload_time=n(s.loadEventEnd,s.loadEventStart),r.web_fpt_cost_time=n(s.responseEnd,s.fetchStart),r.web_tti_cost_time=n(s.domInteractive,s.fetchStart),r.web_dom_ready_cost_time=n(s.domContentLoadedEventEnd,s.fetchStart),r.web_load_cost_time=n(s.loadEventEnd,s.fetchStart)}catch(p){a=!0,t.Commands.log("get timing error ".concat(p))}for(var l=performance.getEntries(),d=0;d<l.length;d++){var m=l[d];"first-contentful-paint"===m.name&&(r.web_fcp_cost_time=l[d].startTime),a&&m instanceof PerformanceNavigationTiming&&(r.web_response_time=n(m.responseEnd,m.responseStart),r.web_dom_time=n(m.domContentLoadedEventStart,m.responseEnd),r.web_dcl_time=n(m.domContentLoadedEventEnd,m.domContentLoadedEventStart),r.web_resources_time=n(m.loadEventStart,m.domContentLoadedEventEnd),r.web_onload_time=n(m.loadEventEnd,m.loadEventStart),r.web_fpt_cost_time=n(m.responseEnd,m.fetchStart),r.web_tti_cost_time=n(m.domInteractive,m.fetchStart),r.web_dom_ready_cost_time=n(m.domContentLoadedEventEnd,m.fetchStart),r.web_load_cost_time=n(m.loadEventEnd,m.fetchStart))}r.web_init_delay=n(this.startInitTime,this.startDelayTime),r.web_init_time=n(this.endInitTime,this.startInitTime),r.browser_engine_version=i.version,r.browser_engine_name=i.name,r.optimize_feat=function(){var t="";(0,e.shouldOptimizeScale)()&&(t+="scaleoptimize");t+="optimizeImgDownload",(0,e.shouldScaleMessageContent)()&&(t+="scalemessagecontent");(0,e.shouldOptimizeScalePerformance)()&&(t+="scalePerformance");R()&&(t+="optimizeLargeMail");P()&&(t+="imageQueue");(0,o.getHasImage)()&&(t+="hasImage");return t}(),r.template_msg_count=this.messageCount,t.Commands.track("email_template_message_load_time",r)},r}(),q=exports.AvatarType={IMG:"IMG",TEXT:"TEXT"},X=exports.AvatarLogHelper=function(){function o(){this.stopReport=!1}function r(o,r,n){try{var i,a={},s=window.performance.timing.domContentLoadedEventEnd;i=0===s?0:Math.max(0,n-s),a.time_wait_ms=i,a.cache=r,a.avatar_type=o,a.optimize_feat=function(){var t="";(0,e.shouldOptimizeScale)()&&(t+="scaleoptimize");M()&&(t+="optimizeAvatar");return t}(),t.Commands.track("template_avatar_load_time",a)}catch(l){t.Commands.log("track template_avatar_load_time error:"+l,t.LogLevel.info)}}return o.prototype.setStopReport=function(t){this.stopReport=t},o.prototype.onTextCacheAvatarLoad=function(){if(!this.stopReport)try{var e=window.performance.timing.domContentLoadedEventEnd;r(q.TEXT,1,e)}catch(o){t.Commands.log("track template_avatar_load_time error:"+o,t.LogLevel.info)}},o.prototype.onAvatarLoad=function(t,e,o){this.stopReport||r(t,e,o&&o>0?o:Date.now())},o}(),$=exports.ImageDownloadLogHelper=function(){var e=0,o=1,r=2;function n(){this.startTimeDict={}}function i(e,o,r){var n=e[o];if(n){var i=n.start;if(i){var a=Date.now(),s=a-i,l=n.isRetry,d=new URL(o).protocol.slice(0,-1),m=a-window.pageStartLoadTime,p=s,c=n.inQueueTime;c?p=s-c:c=0;var u="";window.supportedSchemes.includes(d)&&(u+="nativeIntercept","true"===window.improveImageLoading&&(u+="imageLoading")),"true"===window.newImageTimeout&&(u+="imageTimeout");var f={cost_time:s,result_code:r,is_retry:l,total_cost_time:m,optimize_feat:u,scheme:d,in_queue_time:c,actual_download_time:p};t.Commands.track("template_image_download_time_dev",f)}}}return n.prototype.startRetry=function(t){this.startTimeDict[t]={start:Date.now(),isRetry:1}},n.prototype.startDownload=function(t){this.startTimeDict[t]={start:Date.now(),isRetry:0}},n.prototype.inFlight=function(t){var e=this.startTimeDict[t];if(e){var o=e.start;o&&(this.startTimeDict[t].inQueueTime=Date.now()-o)}},n.prototype.onTimeout=function(t){i(this.startTimeDict,t,r),this.startTimeDict[t]=void 0},n.prototype.onError=function(t){i(this.startTimeDict,t,e),this.startTimeDict[t]=void 0},n.prototype.onLoad=function(t){i(this.startTimeDict,t,o),this.startTimeDict[t]=void 0},n}();function U(e){if(!x(e)){for(var o=document.getElementsByClassName("message-item"),r=[],n=0;n<o.length;n++){var i=o[n],a=i.querySelector(".avatar").getAttribute("user-address");t.Commands.log("updateFollowType success:1 messageItemsAddress"+a,t.LogLevel.info),a.toLowerCase()==e&&r.push(i)}if(t.Commands.log("findMessageItems success: "+r.length,t.LogLevel.info,!0),!x(r))return r}}function Q(t){if(!x(t)){var e=c('.message-item[message-id="'.concat(t,'"]'));if(!x(e))return e}}function Y(t,e){x(t)||x(e)||t.classList.contains(e)||t.classList.add(e)}function j(t,e){if(!x(t)&&!x(e))for(;t.classList.contains(e);)t.classList.remove(e)}function G(t,e){if(t)for(var o,r=[t];r.length>0;){var n=e(o=r.shift());if(o.children&&n)for(var i=0;i<o.children.length;i++)r.push(o.children[i])}}function K(t){if(!(t instanceof Element))return null;if("TABLE"!==t.nodeName)return t.getBoundingClientRect();var o;if((0,e.shouldOptimizeScalePerformance)()){var r=nt(t).outer;o={left:r.left,top:r.top,right:r.right,bottom:r.bottom}}else o={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE},G(t,function(t){if(J(t)){var e=nt(t).outer;0===e.width&&0===e.height&&0===e.left&&0===e.right&&0===e.top&&0===e.bottom||(o={left:Math.min(o.left,e.left),top:Math.min(o.top,e.top),right:Math.max(o.right,e.right),bottom:Math.max(o.bottom,e.bottom)})}return Z(t)});return o.width=o.right-o.left,o.height=o.bottom-o.top,o}function J(t){if(!(t instanceof Element)||t===document.body)return!1;var e=window.getComputedStyle(t),o=t.tagName.toLowerCase();if("none"===e.display||"inline"===e.display&&"img"===o)return!1;return!["base","title","head","tfoot","caption","tr","noscript","col","th","style","tbody","thead","meta","td","link","colgroup","script"].includes(o)}function Z(t){if(!(t instanceof Element))return!1;var e=window.getComputedStyle(t).overflowX;return"auto"===e||"visible"===e}function tt(t,e,o){x(e)&&(e=1),x(o)&&(o=1);var r=window.getComputedStyle(t).transform;if(!x(r)){if(r.startsWith("matrix(")){var n=r.match(/(\d+(?:\.\d+)?)/g);6===n.length&&(e*=parseFloat(n[0]),o*=parseFloat(n[3]))}}if(!x(t.parentNode)&&t.parentNode instanceof Element){var i=tt(t.parentNode,e,o);e=i.horizontalScale,o=i.verticalScale}return{horizontalScale:e,verticalScale:o}}function et(t,e,o,r){r=r||window.getComputedStyle(t);var n=parseFloat(r.getPropertyValue("margin-top")),i=parseFloat(r.getPropertyValue("margin-right")),a=parseFloat(r.getPropertyValue("margin-bottom")),s=parseFloat(r.getPropertyValue("margin-left"));return{top:isNaN(n)?0:n*o,right:isNaN(i)?0:i*e,bottom:isNaN(a)?0:a*o,left:isNaN(s)?0:s*e}}function ot(t,e,o,r){r=r||window.getComputedStyle(t);var n=parseFloat(r.getPropertyValue("border-top-width")),i=parseFloat(r.getPropertyValue("border-right-width")),a=parseFloat(r.getPropertyValue("border-bottom-width")),s=parseFloat(r.getPropertyValue("border-left-width"));return{top:isNaN(n)?0:n*o,right:isNaN(i)?0:i*e,bottom:isNaN(a)?0:a*o,left:isNaN(s)?0:s*e}}function rt(t,e,o,r){r=r||window.getComputedStyle(t);var n=parseFloat(r.getPropertyValue("padding-top")),i=parseFloat(r.getPropertyValue("padding-right")),a=parseFloat(r.getPropertyValue("padding-bottom")),s=parseFloat(r.getPropertyValue("padding-left"));return{top:isNaN(n)?0:n*o,right:isNaN(i)?0:i*e,bottom:isNaN(a)?0:a*o,left:isNaN(s)?0:s*e}}function nt(t,o){o=o||window.getComputedStyle(t);var r,n=t.getBoundingClientRect(),i=ot(t,(r=(0,e.shouldOptimizeScalePerformance)()?tt(t):x(t.parentNode)?1:tt(t.parentNode)).horizontalScale,r.verticalScale,o),a=rt(t,r.horizontalScale,r.verticalScale,o),s={left:n.left+i.left+a.left,right:n.right-i.right-a.right,top:n.top+i.top+a.top,bottom:n.bottom-i.bottom-a.bottom};s.width=s.right-s.left,s.height=s.bottom-s.top;var l={left:n.left+i.left,right:n.right-i.right,top:n.top+i.top,bottom:n.bottom-i.bottom};l.width=l.right-l.left,l.height=l.bottom-l.top;var d={};for(var m in n)d[m]=n[m];var p=et(t,r.horizontalScale,r.verticalScale,o),c={left:n.left-Math.max(p.left,0),right:n.right+Math.max(p.right,0),top:n.top-Math.max(p.top,0),bottom:n.bottom+Math.max(p.bottom,0)};return c.width=c.right-c.left,c.height=c.bottom-c.top,{content:s,inner:l,border:d,outer:c}}function it(){if(!H){var t=c("meta[name=screenHeight]");H=parseInt(t.getAttribute("value"))}return H}function at(){try{for(var e=u(".message-label-item[labeldir=rtl]"),o=0;o<e.length;o++){var r=e[o];if(m())r.style.direction="rtl";else if(d()&&r.scrollWidth>r.offsetWidth){var n=r.firstChild,i="..."+n.nodeValue;r.style.textOverflow="clip";for(var a=Array.from(i);r.scrollWidth>r.offsetWidth&&a.length>"...".length;)i="..."+a.slice("...".length+1).join(""),a=Array.from(i),n.nodeValue=i,n.innerHTML=i}}}catch(s){t.Commands.log("modifyLabelsRTL error:"+s,t.LogLevel.info)}}
},{"./commands":"TnH5","./mailScale":"WwWL","./contentImage":"KACJ"}],"TnH5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LogLevel=exports.Commands=void 0,exports.notifyContentRendered=d;var e=require("./utils");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,o){return(t=n(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e){var o=a(e,"string");return"symbol"==t(o)?o:String(o)}function a(e,o){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,o||"default");if("object"!=t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}function r(){}var s,c=exports.LogLevel={debug:0,info:1,warn:2,error:3},i=!(0,e.shouldOptimizeLargeMail)(),l=[];function d(){i||(i=!0,l.forEach(function(e){p(e)}),l=[])}function p(t){if((0,e.isIOS)())"log"!=t.method&&m.log("invokeMethod ios:"+t.method,c.info,!0),window.webkit.messageHandlers.invoke.postMessage(t);else if((0,e.isAndroid)()){"log"!=t.method&&m.log("invokeMethod android:"+t.method,c.info);var o=JSON.stringify(t);window.messagelist.prompt(o)}}function g(){for(var e=document.querySelectorAll(".menu"),t=0;t<e.length;t++){e[t].classList.remove("open-menu")}}r.prototype.copyContents=function(e){p({method:"copyContents",args:{messageIDs:e}})},r.prototype.imageStartLoad=function(e,t,o,n){try{s=s||n||performance.timing.domContentLoadedEventEnd}catch(a){}p({method:"imageStartLoad",args:{src:e,timestamp:t,isBlocked:o,domContentLoadedTimeCache:s}})},r.prototype.clickOnLink=function(e,t){p({method:"clickOnLink",args:{messageID:e,href:t}})},r.prototype.imageOnLoad=function(e,t){p({method:"imageOnLoad",args:{src:e,timestamp:t}})},r.prototype.imageOnError=function(e,t){p({method:"imageOnError",args:{src:e,timestamp:t}})},r.prototype.imageLoadingOnScreen=function(e){p({method:"imageLoadingOnScreen",args:{src:e}})},r.prototype.popoverDidClose=function(){p({method:"popoverDidClose",args:{}})},r.prototype.fixScaleFinish=function(){p({method:"fixScaleFinish",args:{}})},r.prototype.readmoreMessage=function(e){g(),m.log("readmoreMessage",c.info),p({method:"readmore",args:{messageId:e}})},r.prototype.recallDetail=function(e){m.log("recallDetail command",c.info),p({method:"recallDetail",args:{messageId:e}})},r.prototype.downloadAttachment=function(e,t){m.log("downloadAttachment",c.info),p({method:"downloadAttachment",args:{messageID:e,file_token:t}})},r.prototype.followBtnClickMethod=function(e,t,o){p({method:"followBtnClickMethod",args:{mailAddress:e,followName:t,followAction:o}})},r.prototype.followRecommendContact=function(e,t){p({method:"followRecommendContact",args:{mailAddress:e,followName:t}})},r.prototype.stopRecommendContact=function(){p({method:"stopRecommendContact",args:{}})},r.prototype.closeContactRecommendBanner=function(e){p({method:"closeContactRecommendBanner",args:{mailAddress:e}})},r.prototype.cancelAttachmentDownload=function(e,t){m.log("cancelAttachmentDownload",c.info),p({method:"cancelAttachmentDownload",args:{messageID:e,file_token:t}})},r.prototype.openAttachment=function(e,t,o){g(),m.log("openAttachment",c.info),p({method:"openAttachment",args:{messageID:e,file_token:t,file_url:o}})},r.prototype.deleteDraft=function(e,t){g(),m.log("deleteDraft",c.info),p({method:"deleteDraft",args:{draftId:e,threadID:t}})},r.prototype.scrollTo=function(e){m.log("scrollTo",c.info),p({method:"scrollTo",args:{offsetY:e}})},r.prototype.clickDraft=function(e,t){g(),m.log("clickDraft",c.info),p({method:"clickDraft",args:{draftId:e,replyMessageId:t}})},r.prototype.clickLabel=function(e){g(),m.log("clickLabel",c.info),p({method:"clickLabel",args:{label:e}})},r.prototype.clickDocPreview=function(){m.log("clickDocPreview",c.info);p({method:"clickDocPreview",args:{}})},r.prototype.clickImage=function(e,t,o){g(),m.log("clickImage",c.info),p({method:"clickImage",args:{currentImage:e,images:t,messageID:o}})},r.prototype.needContents=function(e,t){m.log("needContents",c.info),p({method:"needContents",args:{msgIDs:e,type:t}})},r.prototype.needContentLocateSearch=function(e,t){m.log("needContentLocateSearch",c.info),p({method:"needContentLocateSearch",args:{messageID:e,idx:t}})},r.prototype.exitSearch=function(){m.log("exitSearch",c.info,!0);p({method:"exitSearch",args:{}})},r.prototype.searchResults=function(e,t,o,n){m.log("searchResults",c.info,!0);var a={method:"searchResults",args:{key:e,searchType:t,resultInfo:o,idx:n}};m.log("testSearchABC searchResults ".concat(JSON.stringify(a))),p(a)},r.prototype.jsSearchStart=function(){m.log("jsSearchStart",c.info,!0);p({method:"jsSearchStart",args:{}})},r.prototype.checkUrls=function(e){m.log("checkUrls",c.info),p({method:"checkUrls",args:{urls:e}})},r.prototype.checkUserids=function(e){m.log("checkUserids",c.info),p({method:"checkUserids",args:{userids:e}})},r.prototype.showCalendarDetail=function(e){console.log("showCalendarDetail ",e),p({method:"showCalendarDetail",args:{messageId:e}})},r.prototype.acceptCalendar=function(e,t){g(),console.log("acceptCalendar ",e),p({method:"acceptCalendar",args:{messageId:e,threadId:t}})},r.prototype.refuseCalendar=function(e,t){g(),console.log("refuseCalendar ",e),p({method:"refuseCalendar",args:{messageId:e,threadId:t}})},r.prototype.pendingCalendar=function(e,t){g(),console.log("pendingCalendar ",e),p({method:"pendingCalendar",args:{messageId:e,threadId:t}})},r.prototype.updateCalendarAction=function(e,t,o){g(),console.log("updateCalendarAction ",e),p({method:"updateCalendarAction",args:{messageId:e,threadId:t,lastAction:o}})},r.prototype.clickFlag=function(){g(),console.log("clickFlag ");p({method:"clickFlag",args:{}})},r.prototype.log=function(e,t,o){void 0===t&&(t=c.info);var n={method:"log",args:{content:e,level:t}};(!0===t||o||t==c.error)&&(t==c.error?console.error(e):console.log(e)),i?p(n):l.push(n)},r.prototype.receiverClick=function(e,t){p({method:"receiverClick",args:{messageid:e,expand:t}})},r.prototype.messageclick=function(e,t,o){g(),p({method:"messageClick",args:{messageid:e,expand:t,needContent:o}})},r.prototype.sendStatusClick=function(e){p({method:"sendStatusClick",args:{messageId:e}})},r.prototype.addressclick=function(e,t,o,n,a,r){g(),p({method:"addressClick",args:{address:e,userid:t,popoverFrame:o,name:n,userType:a,tenantId:r}})},r.prototype.avatarimageclick=function(e,t,o,n,a,r){g(),p({method:"avatarClick",args:{address:t,userid:e,name:o,userType:n,tenantId:a,popoverFrame:r}})},r.prototype.domReady=function(){var e;window.pageStartLoadTime&&(e=Date.now()-window.pageStartLoadTime),p({method:"domReady",args:{jsCostTime:e}})},r.prototype.callbackJsLifecycle=function(e,t){p({method:"callbackJsLifecycle",args:{lifecycle:e,timings:t}})},r.prototype.track=function(e,t){var o={method:"track",args:{event:e,params:t}};m.log("".concat(e," ").concat(JSON.stringify(t))),i?p(o):l.push(o)},r.prototype.translate=function(e){g(),m.log("translateClick",c.info),p({method:"translateClick",args:{messageID:e}})},r.prototype.selectTranslationLanguageClick=function(e){p({method:"selectTranslationLanguageClick",args:{messageID:e}})},r.prototype.viewOriginalClick=function(e){p({method:"viewOriginalClick",args:{messageID:e}})},r.prototype.viewTranslationClick=function(e){p({method:"viewTranslationClick",args:{messageID:e}})},r.prototype.cancelScheduleSendClick=function(e){p({method:"cancelScheduleSendClick",args:{messageID:e}})},r.prototype.expandMessagesFirstVisible=function(e){p({method:"expandMessagesFirstVisible",args:{messageIds:e}})},r.prototype.translationBlockClick=function(e,t,o){p({method:"translationBlockClick",args:{messageId:e,htmlBody:t,bottomOffset:o}})},r.prototype.shareManageButtonClick=function(){p({method:"shareManageButtonClick",args:{}})},r.prototype.shareCheckButtonClick=function(){p({method:"shareCheckButtonClick",args:{}})},r.prototype.shareManageButtonPosition=function(e,t,o,n){p({method:"shareManageButtonPosition",args:{top:e,left:t,width:o,height:n}})},r.prototype.contextMenuClick=function(e,t,n,a,r){p({method:"contextMenuClick",args:o(o(o(o(o({threadId:e},"threadId",e),"messageId",t),"isTranslated",n),"avatar",a),"menuFrame",r)})},r.prototype.reportMessage=function(e){m.log("reportMessage ".concat(e),c.info,!0),p({method:"reportMessage",args:{messageID:e}})},r.prototype.trustMessage=function(e){m.log("trustMessage ".concat(e),c.info,!0),p({method:"trustMessage",args:{messageID:e}})},r.prototype.closeSafetyBanner=function(e){m.log("closeSafetyBanner ".concat(e),c.info,!0),p({method:"closeSafetyBanner",args:{messageID:e}})},r.prototype.calendarNeedUpdate=function(e,t){m.log("calendarNeedUpdate ".concat(e," ").concat(t),c.info,!0),p({method:"calendarNeedUpdate",args:{threadId:e,messageId:t}})},r.prototype.atUserInfos=function(e){p({method:"atUserInfos",args:{infoArray:e}})},r.prototype.clickShowInterceptedImages=function(e){p({method:"clickShowInterceptedImages",args:{messageID:e}})},r.prototype.interceptedMoreAction=function(e,t,o,n,a){p({method:"interceptedMoreAction",args:{messageID:e,buttonX:t,buttonY:o,buttonWidth:n,buttonHeight:a}})},r.prototype.showInterceptedBanner=function(e){p({method:"showInterceptedBanner",args:{messageID:e}})},r.prototype.triggerLoadMore=function(e,t,o,n){p({method:"triggerLoadMore",args:{isUp:e,isNewMessageAtTop:t,messageID:o,timestamp:n}})},r.prototype.currentVisualMessage=function(e){p({method:"currentVisualMessage",args:{visibleList:e}})},r.prototype.replyAction=function(e){p({method:"replyAction",args:{messageID:e}})},r.prototype.replyAllAction=function(e){p({method:"replyAllAction",args:{messageID:e}})},r.prototype.forwardAction=function(e){p({method:"forwardAction",args:{messageID:e}})},r.prototype.sendToChatAction=function(e){p({method:"sendToChatAction",args:{messageID:e}})},r.prototype.clickDontSendReceipt=function(e){p({method:"clickDontSendReceipt",args:{messageID:e}})},r.prototype.clickSendReceipt=function(e){p({method:"clickSendReceipt",args:{messageID:e}})},r.prototype.clickMessageDraft=function(e){p({method:"clickMessageDraft",args:{messageID:e}})};var m=exports.Commands=new r;m.log("js commands finish",c.info);
},{"./utils":"FOZT"}],"HrG0":[function(require,module,exports) {
"use strict";var r=require("./commands");function t(r,t){return Object.prototype.toString.call(r)==="[object "+(t||"Object")+"]"}function e(r){var t=r.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),e=r.toString(),o=e.indexOf("(");return o>0&&(e=e.slice(0,o)),t.indexOf(e)<0&&(t=e+"@"+t),t}window.onerror=function(o,i,n,a,c){var s=o;if(c&&c.stack&&(s=e(c)),t(s,"Event")&&(s+=s.type?"--"+s.type+"--"+(s.target?s.target.tagName+"::"+s.target.src:""):""),r.Commands.log("js error:"+s+",url:"+i+",line:"+n+",col:"+a,r.LogLevel.info),window.slardar_js_monitor)r.Commands.log("slardar_js_monitor is true, ignore track report.");else{var l={title:"error",msg:s,category:"js_error",col:a.toString(),line:n.toString()};r.Commands.track("mail_webview_javascript_error",l)}};
},{"./commands":"TnH5"}],"IjMb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserType=void 0,exports.getAvatarUserids=u,exports.initAvatar=s,exports.updateAvatar=l;var e=require("./commands"),a=require("./index"),r=require("./utils"),t=["#4C88FF","#3370EB","#DB7018","#F05B56","#B54AB5","#5E68E8","#93AF04"],o=exports.UserType={group:2,enterpriseMailGroup:250};function n(e){var a=e.split("").reduce(function(e,a){return e+a.charCodeAt(0)},0)%t.length;return t[a]||"#EFF0F1"}var i=[];function l(e,t,l){var s=e.querySelectorAll(".avatar");t&&(0,a.avatarLogger)().setStopReport(!0);for(var u,c=function(){var e=s[p];if(e.querySelector("lk-native-avatar"))return 0;var t=e.querySelector("img");if(t&&(t.onload=function(){v(t)},t.defaultValue&&"none"!==t.style.display&&v(t,t.defaultValue)),(0,r.shouldOptimizeAvatar)())return t?(t.onerror=function(){d(t)},t.defaultValue&&"none"===t.style.display&&d(t,t.defaultValue)):(0,a.avatarLogger)().onTextCacheAvatarLoad(),0;u=e.getAttribute("user-name");var c=e.getAttribute("user-id"),g=e.getAttribute("user-type"),f=e.querySelector("img");if(!(f&&null!=f.src&&""!=f.src)&&(void 0===c||null==c||"0"==c||c.length<1||g==o.group||g==o.enterpriseMailGroup||!0===l))if(u&&u.trim().length>0){var y=n(u=u.trim()),A=new MutationObserver(function(){var e;A.disconnect(),e=l?0:1,(0,a.avatarLogger)().onAvatarLoad(r.AvatarType.TEXT,e)});A.observe(e,{childList:!0}),e.style.background=y,e.innerHTML=u.substr(0,1).toUpperCase()}else e.classList.add("avatar-placeholder");else e.classList.add("avatar-placeholder"),i.push(c)},p=0;p<s.length;p++)c()}function s(){try{l(document)}catch(a){e.Commands.log("updateAvatar error:"+a,e.LogLevel.info)}}function u(){return i}function v(t,o){var n;t.style.display="flex",e.Commands.log("MailAvatarManager onAvatarImgLoad",e.LogLevel.info),n=t.src.startsWith("mail-avatar-id")?0:1,(0,a.avatarLogger)().onAvatarLoad(r.AvatarType.IMG,n,o)}function d(t,o){e.Commands.log("MailAvatarManager onAvatarImgError",e.LogLevel.info),t.style.display="none",t.nextElementSibling.style.display="flex",(0,a.avatarLogger)().onAvatarLoad(r.AvatarType.TEXT,0,o)}
},{"./commands":"TnH5","./index":"Focm","./utils":"FOZT"}],"I9d7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.markQuoteRendered=exports.handleBlock=exports.renderQuote=void 0;var e=require("../utils"),n=require("../commands"),t=getComputedStyle(document.documentElement).getPropertyValue("--icon-n3"),o='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.6265 11.2205C19.1246 11.6208 19.1246 12.3791 18.6265 12.7794L8.29248 21.0851C7.63808 21.611 6.66602 21.1452 6.66602 20.3056L6.66602 3.69426C6.66602 2.8547 7.63808 2.38886 8.29248 2.91481L18.6265 11.2205Z" fill="'+t+'"/></svg>',r='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.2205 18.4604C11.6208 18.9585 12.3791 18.9585 12.7794 18.4604L21.0851 8.1264C21.611 7.472 21.1452 6.49994 20.3056 6.49994H3.69426C2.8547 6.49994 2.38886 7.472 2.91481 8.1264L11.2205 18.4604Z" fill="'+t+'"/></svg>',i=encodeURIComponent(o),l=encodeURIComponent(r),a='url("data:image/svg+xml, '+i+'")',s='url("data:image/svg+xml, '+l+'")',d="lark-mail-quote",c="#quote-divider-line",u="adit-html-block",p="history-quote-read-block",m="history-quote-gap-tag",h="history-quote-outer-wrapper",g=[{selector:'[id*="'+d+'"]',value:function(e){return e}}],v=Date.now(),f="collapse"+v,x="quote"+v,q="controller"+v,w=500,C="\n.adit-html-block__attr {\n  font-size: 14px;\n  line-height: 22px;\n}\n.control-point-wrapper {\n  min-height: 48px;\n  display: flex;\n}\n\n."+h+".no-collapse-button .control-point-wrapper {\n  display: none;\n}\n\n."+q+" .quote-control-icon {\n  background-image: "+s+";\n  background-repeat: no-repeat;\n  background-size: contain;\n  width: 12px;\n  height: 12px;\n}\n."+q+" .quote-control-text {\n  margin-left: 4px;\n  font-size: 14px;\n  line-height: 20px;\n  color: var(--text-caption);\n  user-select: none;\n}\n."+f+" ."+h+":not(.no-collapse-button) ."+x+" {\n    display: none!important;\n}\n\n."+q+" {\n  position: absolute;\n  border-radius: 4px;\n  margin-left: -4px;\n  padding: 2px 4px;\n  align-items: center;\n  display: flex;\n  user-select: none;\n  outline-style: none;\n  -webkit-touch-callout: none;\n  -webkit-tap-highlight-color: rgba(0,0,0,0);\n  margin-top: 24px;\n}\n."+q+":active {\n  background: rgba(31, 35, 41, 0.08);\n}\n."+f+" ."+q+" .quote-control-icon {\n  background-image: "+a+";\n}\n\n."+h+" ."+m+" {\n  margin-top: 2px !important;\n}\n."+p+" {\n  margin-top: 16px;\n}\n."+h+" ."+p+" {\n  margin-top: 10px !important;\n}\n",b=document.createElement("style");function y(e,t,o){var r=e;1===r.children.length&&(r=r.children[0]);var i=_(r);if(i){var l=i.num,a=i.quote;if(a){a.classList.add(p);var s=r.querySelector(c),d=r.querySelector("."+u),m=null==s?void 0:s.closest("."+u);if(d&&m&&d===m&&(s.style.display="none"),l>1)k(r,a,t);else if(1===l){R(e.innerHTML).height>w&&k(r,a,t)}}else l>0&&o&&t&&n.Commands.track("email_message_list_quote_error",{msg_id:o})}}function L(){var n='\n    <div class="control-point-wrapper ignoreForSearch">\n      <div class="'+q+'" larkmailquote="true">\n       <div class="quote-control-icon"></div>\n       <div class="quote-control-text hide-quote">'+window.quoteHideTitle+'</div>\n       <div class="quote-control-text expand-quote">'+window.quoteExpandTitle+"</div>\n      </div>\n    </div>\n    ";return e.convertToNodeFirstElementByStr(n)}function k(e,n,t){var o,r,i;if(n.parentElement){n.classList.add(x);var l=document.createElement("div"),a=L();l.appendChild(a),l.classList.add(h),l.appendChild(n.cloneNode(!0)),n.parentElement.removeChild(n),t||l.classList.add("no-collapse-button");var s=e.closest(".outer-content-container"),d=e.closest(".message-content");if(s&&d){var c=d.classList.contains("translated-message-content")?"translated-quote-wrapper":"original-quote-wrapper";l.classList.add(c);var u=s.querySelector("."+c);u&&d.removeChild(u),d.insertBefore(l,e.nextElementSibling),s.classList.contains("quoteControlRoot")||(s.classList.add("quoteControlRoot"),t&&s.classList.add(f))}else null===(o=e.parentElement)||void 0===o||o.appendChild(l),null===(r=e.parentElement)||void 0===r||r.classList.add("quoteControlRoot"),t&&(null===(i=e.parentElement)||void 0===i||i.classList.add(f))}}function E(e){if(!e.classList.contains("quoteRendered")){var n=g.map(function(e){return e.selector});n.push(".gmail_quote"),n.forEach(function(n){e.querySelectorAll(n).forEach(function(e){e.classList.add("quoteRendered")})})}}function R(e){var n=document.createElement("div");n.style.cssText="height: 0; overflow: hidden; position: absolute";var t=document.createElement("div");t.innerHTML=e,E(t),n.appendChild(t),document.body.appendChild(n);var o=t.getBoundingClientRect();return n.remove(),{width:o.width,height:o.height}}function _(e){for(var n,t=0,o=0;o<g.length;o++){var r=g[o].selector,i=e.querySelectorAll(r);if(i.length>0){t+=i.length;for(var l=0;l<i.length;l++)if((!n||g[o].value(i[0]).contains(n))&&S(i[l],e)){n=g[o].value(i[l]);break}}}return{num:t,quote:n}}function S(e,n){for(var t=e.parentNode,o=e;t&&o&&t!==n;){var r=t.lastChild;if(r&&r!==o&&(!r.id||!r.id.includes("large-file-area")))return!1;o=t,t=t.parentElement}return!0}b.innerHTML=C,document.head.appendChild(b),exports.renderQuote=y,exports.handleBlock=k,exports.markQuoteRendered=E;
},{"../utils":"FOZT","../commands":"TnH5"}],"dnLp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatContent=o,exports.renderContentAndQuoteForMessage=i;var e=require("./renderQuote"),r=require("../commands");function o(e){try{var o,n=e.querySelector(".message-inner-content");if(0==(o=n?n.innerHTML:e.innerHTML).indexOf("\x3c!--")&&"--\x3e"==o.slice(-3)){var s=t(o=o.slice(4,-3)),i=n||e;i.innerHTML="",i.appendChild(s)}}catch(a){r.Commands.log("formatContent error:"+a,r.LogLevel.error)}}function t(e){var r=document.createElement("div");return"string"==typeof e&&(r.innerHTML=e),r}function n(o,t){if(o){var n=o.closest(".message-item");if(n){var s=n.getAttribute("message-id");return r.Commands.log("renderMessageListQuoteForMessage",r.LogLevel.info),(0,e.renderQuote)(o,t,s),n}}}function s(e){var r=e.querySelector(".is_body_clipped"),o=e.querySelector("[larkmailquote=true]");if(r)if(o){var t=o.closest(".quoteControlRoot");if(t){var n="collapse"+o.className.replace(/[^0-9]/gi,"");t.classList.contains(n)?r.style.display="none":r.style.display="flex"}}else r.style.display="flex"}function i(t,i){try{if(t){var a=t.closest(".message-item");a&&(o(t),n(t,i),s(a),(0,e.markQuoteRendered)(a),r.Commands.log("renderContentAndQuote ",r.LogLevel.info))}}catch(l){r.Commands.log("renderContentAndQuoteForMessage error:"+l,r.LogLevel.error)}}r.Commands.log("renderQuote",r.LogLevel.info);
},{"./renderQuote":"I9d7","../commands":"TnH5"}],"WX4Q":[function(require,module,exports) {
"use strict";var t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.getColorArray=exports.PropType=exports.Darken=void 0,function(t){t.color="color",t.backgroundColor="backgroundColor",t.border="border",t.backgroundImage="backgroundImage"}(t||(exports.PropType=t={}));const e={"255,255,255":[26,26,26],"242,243,245":[41,41,41],"222,224,227":[67,67,67],"143,149,158":[117,117,117],"55,60,67":[224,224,224],"0,0,0":[255,255,255],"51,112,255":[76,136,255],"225,234,255":[25,42,76],"186,206,253":[32,62,120],"78,131,253":[46,101,209],"36,91,219":[112,160,255],"19,60,154":[184,207,255],"52,199,36":[84,194,72],"217,245,214":[31,71,27],"183,237,177":[41,107,34],"98,210,86":[59,176,46],"46,161,33":[109,209,98],"24,96,16":[189,240,184],"127,59,245":[151,98,245],"236,226,254":[54,29,97],"205,178,250":[77,38,145],"147,90,246":[124,74,212],"100,37,208":[164,114,252],"56,13,130":[211,186,253],"255,198,10":[250,200,35],"250,241,209":[87,71,17],"248,230,171":[143,114,17],"250,211,85":[240,187,10],"220,155,4":[252,212,86],"121,81,1":[255,230,148],"245,74,69":[240,91,86],"253,226,226":[74,29,27],"251,191,188":[107,40,39],"247,105,100":[204,71,67],"216,57,49":[250,120,115],"129,37,32":[254,198,195],"239,240,241":[55,55,55],"187,191,196":[95,95,95],"100,106,115":[166,166,166],"245,246,247":[41,41,41]},r={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},o=t=>{const e=t.trim();let o=r[e];return o||("windowtext"===e?[0,0,0]:(o=a(e))||((o=n(e))||null))},n=t=>{const e=t.length;if(!/^#[A-Fa-f\d]+$/.test(t)||4!==e&&5!==e&&7!==e&&9!==e)return null;let r,o,n,l=1;return 4===e||5===e?(r=parseInt(t[1]+t[1],16),o=parseInt(t[2]+t[2],16),n=parseInt(t[3]+t[3],16),5===e&&(l=parseInt(t[4]+t[4],16)/255)):(r=parseInt(t[1]+t[2],16),o=parseInt(t[3]+t[4],16),n=parseInt(t[5]+t[6],16),9===e&&(l=parseInt(t[7]+t[8],16)/255)),1===l?[r,o,n]:[r,o,n,l]},l=t=>t.length>4?"":4===t.length?`rgba(${Math.round(t[0])}, ${Math.round(t[1])}, ${Math.round(t[2])}, ${t[3]})`:`rgb(${Math.round(t[0])}, ${Math.round(t[1])}, ${Math.round(t[2])})`,i=t=>t.length>4?"":t.reduce((t,e,r)=>`${t}${s(r<3?e:Math.round(255*e))}`,"#"),s=t=>t<16?"0"+t.toString(16):t.toString(16),a=t=>{let e=null;const r=u(t);if(r){const[t,o]=r;switch(t){case"rgb":e=o.slice(0,3).map(Math.round);break;case"hsl":e=h(o[0]/360,o[1]/100,o[2]/100).map(Math.round);break;case"hsv":e=f(o[0]/360,o[1]/100,o[2]/100).map(Math.round)}e&&void 0!==o[3]&&1!==o[3]&&(e[3]=o[3])}return e},c={red:0,orange:60,yellow:120,green:180,blue:240,purple:300},u=t=>{const e=/^((?:rgb|hs[lv])a?)\s*\(([^)]*)\)/i.exec(t);if(!e)return null;const r=e[1].toLowerCase(),o=r.replace(/a$/,"");if("rgb"!==o&&"hsl"!==o&&"hsv"!==o)return null;const n=r.endsWith("a"),l=e[2].trim().split(/\s*[,\/]\s*|\s+/);if(!(n?4===l.length:3===l.length))return null;const i=l.map((t,e)=>{if(t.endsWith("%"))return 3===e?parseFloat(t)/100:"rgb"===o?255*parseFloat(t)/100:parseFloat(t);if("hsl"===o&&0===e){if(t.endsWith("deg"))return parseFloat(t);if(void 0!==c[t])return c[t]}return parseFloat(t)});return[o,i]},d=(t,e,r)=>{const o=Math.max(t,e,r),n=Math.min(t,e,r),l=Math.floor((o+n)/5.1);if(o===n)return[0,0,l];const i=o-n,s=Math.floor(i/(l>50?510-o-n:o+n)*100);return o===t?[Math.floor(60*((e-r)/i+(e<r?6:0))),s,l]:o===e?[Math.floor(60*((r-t)/i+2)),s,l]:[Math.floor(60*((t-e)/i+4)),s,l]},g=(t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t),h=(t,e,r)=>{let o,n,l;if(0===e)o=n=l=r;else{const i=r<.5?r*(1+e):r+e-r*e,s=2*r-i;o=g(s,i,t+1/3),n=g(s,i,t),l=g(s,i,t-1/3)}return[Math.max(0,Math.min(Math.round(255*o),255)),Math.max(0,Math.min(Math.round(255*n),255)),Math.max(0,Math.min(Math.round(255*l),255))]},f=(t,e,r)=>{let o=0,n=0,l=0;const i=Math.floor(6*t),s=6*t-i,a=r*(1-e),c=r*(1-s*e),u=r*(1-(1-s)*e);switch(i%6){case 0:o=r,n=u,l=a;break;case 1:o=c,n=r,l=a;break;case 2:o=a,n=r,l=u;break;case 3:o=a,n=c,l=r;break;case 4:o=u,n=a,l=r;break;case 5:o=r,n=a,l=c}return[255*o,255*n,255*l]};exports.getColorArray=o;class p{constructor(){this.dark2Light={}}static genKey(t){return t.join(",")}getMap(t){let e=this.dark2Light[t];return e||(e={},this.dark2Light[t]=e),e}collectColor(t,e,r){this.getMap(r)[p.genKey(e)]=t}getLightColor(t,e){return this.getMap(e)[p.genKey(t)]}}const m=t=>(new DOMParser).parseFromString(`<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>${t}</body></html>`,"text/html"),b=60,y=96,k=8,C=24,w=["table","tbody","tfoot","colgroup","tr","td","th"],P=[["border-left-color","data-src-bd-left"],["border-top-color","data-src-bd-top"],["border-right-color","data-src-bd-right"],["border-bottom-color","data-src-bd-bottom"]],v=function(){let t=/\s*,\s*/,e=/(?:[+-]?\d*\.?\d+)(?:%|[a-z]+)?/,r=B(["(?:",/\#(?:[a-f0-9]{6}|[a-f0-9]{3})/,"|","(?:rgb|hsl)",/\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*\)/,"|","(?:rgba|hsla)",/\(\s*(?:\d{1,3}\s*,\s*){2}\d{1,3}\s*,\s*\d*\.?\d+\)/,"|",/[_a-z-][_a-z0-9-]*/,")"],""),o=B([r,"(?:\\s+",e,"(?:\\s+",e,")?)?"],""),n=B(["(?:",o,t,")*",o],""),l=B(["(?:(",/(?:[+-]?\d*\.?\d+)(?:deg|grad|rad|turn)/,")|",/to\s+((?:(?:left|right)(?:\s+(?:top|bottom))?))/,")"],"");return{gradientSearch:B(["(?:(",l,")",t,")?(",n,")"],"gi"),colorStopSearch:B(["\\s*(",r,")","(?:\\s+","(",e,"))?","(?:",t,"\\s*)?"],"gi")}}();function x(t,e){const r=4===t.length?t[3]:1;if(0===r)return;let o=T(t),n=null;if(o||(n=F(d(t[0],t[1],t[2])),o=h(n[0]/360,n[1]/100,n[2]/100)),e&&I(o,e)<4.5){n||(n=d(o[0],o[1],o[2]));const t=A(n[2],!1);o=h(n[0]/360,n[1]/100,t/100)}return 1!==r&&(o[3]=r),o}function M(e,r,n,s,a){let c="background-image";const u=e.getPropertyValue(c);if(-1!==u.indexOf("url"))return;if(-1!==u.indexOf("linear-gradient")){const r=function(e,r){const n=function(t){const e=/.*gradient\s*\(((?:\([^)]*\)|[^)(]*)*)\)/.exec(t);let r;return null!==e&&((r=function(t,e){const{gradientSearch:r,colorStopSearch:o}=t;let n=null;r.lastIndex=0;let l=r.exec(e);if(null!==l){n={original:l[0],colorStopList:[]},l[1]&&(n.line=l[1]),l[2]&&(n.angle=l[2]),l[3]&&(n.sideCorner=l[3]),o.lastIndex=0;let t=o.exec(l[4]);for(;null!==t;){const e={color:t[1]};t[2]&&(e.position=t[2]),n.colorStopList.push(e),t=o.exec(l[4])}}return n}(v,e[1])).original.trim()!==e[1].trim()&&(r.parseWarning=!0)),r}(u);let i=`linear-gradient(${n.line||""}`;for(let s=0;s<n.colorStopList.length;s++){const e=n.colorStopList[s],a=o(e.color);if(a){const o=4===a.length?a[3]:1;if(0!==o){let n=T(a);if(!n){const t=F(d(a[0],a[1],a[2]));n=h(t[0]/360,t[1]/100,t[2]/100),1!==o&&(n[3]=o)}i+=`, ${l(n)} ${e.position||""}`,r(a,n,t.backgroundImage);continue}}i+=`, ${e} ${e.position||""}`}return i+=")"}(0,n),i="important"===e.getPropertyPriority(c);return void s(t.backgroundImage,c,!1,u,r,i)}c="background-color";let g=!1,f="";const p=r();if(p&&-1!==w.indexOf(p.tagName.toLowerCase())){const t=p.getAttribute("bgcolor");t&&(f=t)}const m=e.getPropertyValue(c);if(m&&(f=m,g=!0),!f)return;const b=o(f);if(!b)return;const y=$(b,a);if(y){if(g){const r=l(y),o="important"===e.getPropertyPriority(c);s(t.backgroundColor,c,!1,f,r,o)}else{const e=i(y);s(t.backgroundColor,c,!0,f,e,!1)}return n(b,y,t.backgroundColor),y}}function $(t,e){const r=4===t.length?t[3]:1;if(0===r)return;let o=T(t),n=null;if(!o){const e=d(t[0],t[1],t[2]);if(j())return;n=function(t){const e=t[2];let r=0===e?k:Math.abs(100-e);return r=N(r,k,C),r+=1.8*Math.cos(r/10),[t[0],t[1],r]}(e),o=h(n[0]/360,n[1]/100,n[2]/100)}if(e&&I(o,e)<4.5){n||(n=d(o[0],o[1],o[2]));const t=A(n[2],!0);o=h(n[0]/360,n[1]/100,t/100)}return 1!==r&&(o[3]=r),o}const A=(t,e)=>{let r;return r=e?-t/5+30:-t/3+96};function L(e,r,n,i){const s=e.getPropertyValue(r);if(!s)return;const a=o(s);if(!a)return;const c=S(a);if(!c)return;const u=l(c),d="important"===e.getPropertyPriority(r);i(t.border,r,!1,s,u,d),n(a,c,t.border)}function S(t){const e=4===t.length?t[3]:1;if(0===e)return;let r=T(t);if(r)return r;const o=F(d(t[0],t[1],t[2]));return r=h(o[0]/360,o[1]/100,o[2]/100),1!==e&&(r[3]=e),r}const E=t=>{const e=t.map(t=>{const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)});return.2126*e[0]+.7152*e[1]+.0722*e[2]},I=(t,e)=>{const r=E(t),o=E(e);return r>o?(r+.05)/(o+.05):(o+.05)/(r+.05)},T=t=>{const r=t.join(",");return e[r]||null};function F(t){if(j())return t;const e=t[2];let r=Math.abs(100-e);return r=N(r,b,y),[t[0],t[1],r]}function j(t){return!1}function N(t,e,r){return t>r?r:t<e?e:t}function B(t,e){let r="";for(let o=0;o<t.length;o++)"string"==typeof t[o]?r+=t[o]:r+=t[o].source;return new RegExp(r,e)}const V=t=>{const e=document.createElement("style");return e.innerHTML=t.join("\n"),e.className="darken-generated",e},D=t=>{if(!t)return null;const e=document.createElement("iframe");document.head.appendChild(e);const r=e.contentDocument;if(!r)return null;const o=r.createElement("style");o.textContent=t,r.head.appendChild(o);const n=r.styleSheets[0];return e.remove(),n},q=(e,r,n)=>{const i=[],{selectorText:s,style:a}=e;let c="color",u=a.getPropertyValue(c);if(u&&"string"==typeof u){const e=o(u);if(e){const o=x(e);if(o){const n=l(o);if(n){const l=`${c}:${n}${"important"===a.getPropertyPriority(c)?" !important":""};`;i.push(l),r.collectColor(e,o,t.color)}}}}const d=(t,e,o)=>{r.collectColor(t,e,o)},g=(t,e,r,o,n,l)=>{const s=`${e}:${n}${l?" !important":""};`;i.push(s)};if(M(a,()=>{},d,g),["border-left-color","border-top-color","border-right-color","border-bottom-color"].forEach(t=>{L(a,t,d,g)}),c="box-shadow",(u=a.getPropertyValue(c))&&"string"==typeof u){const t=`${c}:null${"important"===a.getPropertyPriority(c)?" !important":""};`;i.push(t)}return i.length?`${s.split(",").map(t=>`${n} ${t}`).join(",")} {${i.join("\n")}}`:""},R=(e,r,n,s,a,c,u)=>{if(n(e))return;const d=e,g=d.tagName.toLowerCase();if("style"===g){const t=((t,e,r)=>{if(t.classList.contains("darken-generated"))return null;const o=t.sheet||D(t.textContent);if(!o)return null;const n=[];for(let l=0,i=o.cssRules,s=i.length;l<s;l++){const t=i[l];if(t.type===CSSRule.STYLE_RULE){const o=q(t,r,e);o&&n.push(o)}else if(t.type===CSSRule.MEDIA_RULE){const o=t,l=o.conditionText;if(l&&-1!==l.indexOf("prefers-color-scheme"))continue;const i=o.cssRules,s=[];for(let t=0,n=i.length;t<n;t++){const o=i[t];if(o.type===CSSRule.STYLE_RULE){const t=q(o,r,e);t&&s.push(t)}}if(s.length){const t=`@media ${l}{${s.join("\n")}}`;n.push(t)}}}return n.length?V(n):null})(d,r,s);if(t){const e=d.parentNode,r=d.nextSibling;e&&r?e.insertBefore(t,r):e&&e.appendChild(t)}return}if("img"===g)return;const h=function(e,r,n){const s="color";let a=!1,c="";if("font"===e.tagName.toLowerCase()){const t=e.getAttribute(s);t&&(c=t)}const u=e.style.getPropertyValue(s);if(u&&(c=u,a=!0),!c)return;const d=o(c);if(!d)return;let g=x(d,n);if(g){if(a){const t=l(g),r="important"===e.style.getPropertyPriority(s);e.style.setProperty(s,t,r?"important":void 0)}else{const t=i(g);e.setAttribute(s,t)}return e.setAttribute("data-src-color",c),r.collectColor(d,g,t.color),g}}(d,s,a?c:void 0)||u,f=function(e,r,o){return M(e.style,()=>e,(t,e,o)=>{r.collectColor(t,e,o)},(r,o,n,l,i,s)=>{n?e.setAttribute("bgcolor",i):e.style.setProperty(o,i,s?"important":void 0),r===t.backgroundImage?e.setAttribute("data-src-bg-image",l):r===t.backgroundColor&&e.setAttribute("data-src-bg-color",l)},o)}(d,s,a?h:void 0)||c;!function(t,e){P.forEach(([r,o])=>{t.hasAttribute(o)||L(t.style,r,(t,r,o)=>{e.collectColor(t,r,o)},(e,r,n,l,i,s)=>{t.style.setProperty(r,i,s?"important":void 0),t.setAttribute(o,l)})})}(d,s),function(t){const e=t.style.getPropertyValue("box-shadow");e&&(t.setAttribute("data-src-shadow",e),t.style.setProperty("box-shadow",null))}(d);let p=d.firstElementChild;for(;null!=p;){let t=p.nextElementSibling;R(p,r,n,s,a,f,h),p=t}},_=(e,r,n,s,a)=>{var c;if(r(e))return;const u=e,d=u.tagName.toLowerCase();if("style"===d)return void(u.classList.contains("darken-generated")&&(null===(c=u.parentNode)||void 0===c||c.removeChild(u)));if("img"===d)return;var g;!function(e,r,n,i){let s="background-image";const a=e.getAttribute("data-src-bg-image");if(a){e.removeAttribute("data-src-bg-image");const t="important"===e.style.getPropertyPriority(s);e.style.setProperty(s,a,t?"important":void 0)}if(s="background-color",r){const t=e.getAttribute("data-src-bg-color");if(t)if(e.removeAttribute("data-src-bg-color"),Boolean(e.style.getPropertyValue(s))){const r="important"===e.style.getPropertyPriority(s);e.style.setProperty(s,t,r?"important":void 0)}else e.setAttribute("bgcolor",t)}else{const r=e.style.getPropertyValue(s);if(r&&"string"==typeof r){const a=o(r);if(a){let r=n.getLightColor(a,t.backgroundColor);if(r||a.join(",")!==i.darkBackgroundColor.join(",")||(r=i.lightBackgroundColor),r){const t=l(r),o="important"===e.style.getPropertyPriority(s);e.style.setProperty(s,t,o?"important":void 0)}}}}}(u,n,s,a),function(e,r,n,s){const a="color";if(r){const t=e.getAttribute("data-src-color");if(t)if(e.removeAttribute("data-src-color"),Boolean(e.style.getPropertyValue(a))){const r="important"===e.style.getPropertyPriority(a);e.style.setProperty(a,t,r?"important":void 0)}else e.setAttribute(a,t)}else{let r=!1,c="";if("font"===e.tagName.toLowerCase()){const t=e.getAttribute(a);t&&(c=t)}const u=e.style.getPropertyValue(a);if(u&&(c=u,r=!0),!c)return;const d=o(c);if(!d)return;let g=n.getLightColor(d,t.color);if(g||d.join(",")!==s.darkFrontColor.join(",")||(g=s.lightFrontColor),g)if(r){const t=l(g),r="important"===e.style.getPropertyPriority(a);e.style.setProperty(a,t,r?"important":void 0)}else{const t=i(g);e.setAttribute(a,t)}}}(u,n,s,a),g=u,P.forEach(([t,e])=>{const r=g.getAttribute(e);if(r){g.removeAttribute(e);const o="important"===g.style.getPropertyPriority(t);g.style.setProperty(t,r,o?"important":void 0)}}),function(t){const e=t.getAttribute("data-src-shadow");t.removeAttribute("data-src-shadow"),e&&t.style.setProperty("box-shadow",e)}(u);let h=u.firstElementChild;for(;null!=h;){let t=h.nextElementSibling;_(h,r,n,s,a),h=t}};class O{constructor(t){this.transformCollector=new p,this.excludeChecker=z;const{isEnabledContrast:e=!0,darkBackgroundColor:r,darkFrontColor:n,lightBackgroundColor:l,lightFrontColor:i}=t;this.isEnabledContrast=e,this.colorConfig={darkBackgroundColor:o(r)||[0,0,0],darkFrontColor:o(n)||[255,255,255],lightBackgroundColor:o(l)||[255,255,255],lightFrontColor:o(i)||[0,0,0]}}darken(t){const e=(new Date).getTime(),{html:r,selectorPrependInStyle:o,excludeSelectors:n}=t;let l,i;if(this.excludeChecker=W(n),"string"==typeof r){const t=m(r);R(t.body,o,this.excludeChecker,this.transformCollector,this.isEnabledContrast,this.colorConfig.darkBackgroundColor,this.colorConfig.darkFrontColor),l=t.body}else R(l=r,o,this.excludeChecker,this.transformCollector,this.isEnabledContrast,this.colorConfig.darkBackgroundColor,this.colorConfig.darkFrontColor);return{html:i="string"==typeof r?l.innerHTML:l,costTime:(new Date).getTime()-e}}lighten(t){const e=(new Date).getTime(),{html:r,isCopying:o}=t;let n,l;if("string"==typeof r){const t=m(r);for(_(t.body,this.excludeChecker,!o,this.transformCollector,this.colorConfig),n=document.createElement("div");t.body.firstChild;)n.append(t.body.firstChild)}else _(n=r,this.excludeChecker,!o,this.transformCollector,this.colorConfig);return{html:l="string"==typeof r?n.innerHTML:n,costTime:(new Date).getTime()-e}}darkenColor(e,r){const n=o(e);if(n){let e;switch(r){case t.color:e=x(n);break;case t.backgroundColor:case t.backgroundImage:e=$(n);break;case t.border:e=S(n)}if(e){const t=l(e);if(t)return this.transformCollector.collectColor(n,e,r),t}}return e}lightenColor(t,e){const r=o(t);if(r){const t=this.transformCollector.getLightColor(r,e);if(t)return l(t)}return t}}exports.Darken=O;const z=t=>t.nodeType!==Node.ELEMENT_NODE||"svg"===t.tagName,W=t=>{let e=z;if(t&&t.length){const r=t.join(",");e=(t=>!!z(t)||t.matches(r))}return e};
},{}],"Nr45":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleContentDM=d,exports.isDarkMode=void 0,exports.makeDarkItem=m,exports.makeLightItem=u,exports.observeCopy=k,exports.observeDarkMode=s;var e,t=require("@mail-editor/dark-mode"),o=require("./utils"),r=require("./commands"),n="data-content-dark-ignore",a=exports.isDarkMode=!1;function s(){try{e=new t.Darken({darkFrontColor:"rgb(235, 235, 235)",darkBackgroundColor:"rgb(26, 26, 26)",lightFrontColor:"rgb(31, 35, 41)",lightBackgroundColor:"rgb(255, 255, 255)"});var o=document.querySelector(":root.dark");exports.isDarkMode=a=!!o;var n=window.matchMedia("(prefers-color-scheme: dark)");"function"==typeof n.addEventListener?n.addEventListener("change",function(e){i(e)}):n.addListener(function(e){i(e)})}catch(s){r.Commands.log("[Dark Mode] observe Dark Mode failed: ".concat(s))}}function i(e){e.matches?(document.querySelector(":root").classList.add("dark"),exports.isDarkMode=a=!0):(document.querySelector(":root").classList.remove("dark"),exports.isDarkMode=a=!1);c()}function c(){for(var e=document.body.querySelectorAll(".message-item"),t=(0,o.checkIsTrue)(window.isContentAlwaysLight),r=a&&!t,n=0;n<e.length;n++)for(var s=e[n].querySelectorAll(".message-content"),i=0;i<s.length;i++)d(s[i],r);var c=document.body.querySelector(".translate-popover");c&&(d(c.querySelector(".popover-editor"),r),l(c,r))}function d(e,t){t?e.classList.contains("dark")||m(e):e.classList.contains("light")||u(e,!1);var o=e.closest(".item-content");o?l(o,t):r.Commands.log("[Dark Mode] item-content Not Found"),l(e,t)}function l(e,t){t?(e.classList.contains("light")&&e.classList.remove("light"),e.classList.add("dark")):(e.classList.contains("dark")&&e.classList.remove("dark"),e.classList.add("light"))}function m(t){if(t)try{if(!e)return;var o=e.darken({html:t,selectorPrependInStyle:".dark",excludeSelectors:["[".concat(n,"=true]")]}).costTime;t.classList.remove("invisible-for-dark"),console.log("Time cost is ".concat(o))}catch(a){r.Commands.log("[Dark Mode] makeDarkItem error ".concat(a))}}function u(t,o){if(t)try{if(!e)return;var n=e.lighten({html:t,isCopying:o}).costTime;console.log("Time cost is ".concat(n))}catch(a){r.Commands.log("[Dark Mode] makeLightItem error ".concat(a))}}function k(e){var t=window.getSelection(),o=e.clipboardData;if(t){e.preventDefault();var r=t.getRangeAt(0).cloneContents(),n=document.createElement("div");n.append(r),a&&u(n,!0),o.setData("text/html",n.innerHTML),o.setData("text/plain",t.toString()),o.setData("text/rtf",n.innerHTML),console.log(n)}}window.updateContentStyle=function(e){window.isContentAlwaysLight=e,c()};
},{"@mail-editor/dark-mode":"WX4Q","./utils":"FOZT","./commands":"TnH5"}],"BRBp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Popover=void 0;var e=require("./utils"),t=require("./commands"),i=require("./darkMode"),o=exports.Popover=function(){var o=.5;function n(e){this.popoverNodeStr='<div class="translate-popover"><div class="drag-view"><div class="drag-view-body auto-scroll"><div class="drag-view-title">'.concat(e,'</div><div class="popover-editor"><div class="innerbody"></div></div></div></div></div>'),this.popoverTitle=e}function l(t,n,l,c){var s=(0,e.$)(".translate-popover");s?s.querySelector(".drag-view-title").textContent=c:(s=(0,e.convertToNodeFirstElementByStr)(n),document.body.appendChild(s),function(e){e.querySelector(".drag-view").addEventListener("click",function(e){var t=e.target.classList.contains("drag-view");if(t)for(var i=document.elementsFromPoint(e.clientX,e.clientY),o=0;o<i.length;o++){var n=i[o],l=n.closest(".selected-translation");if(l){for(var c=l.querySelectorAll("a"),s=0;s<c.length;s++){var d=c[s],a=d.getBoundingClientRect();if(e.clientX>=a.left&&e.clientX<=a.right&&e.clientY>=a.top&&e.clientY<=a.bottom){d.click(),t=!1;break}}if(!t)break}}t&&r()});var t=e.querySelector(".drag-view-title"),i=e.querySelector(".drag-view-body");t.addEventListener("touchstart",function(e){var n=e.touches[0].clientY||e.changedTouches[0].clientY,l=i.getBoundingClientRect().height;t.addEventListener("touchmove",function(e){i.classList.remove("auto-scroll");var t=e.touches[0]||e.changedTouches[0],o=t.clientY,r=l+(n-o);i.style.height="".concat(r,"px"),e.preventDefault()}),t.addEventListener("touchend",function(e){var t=e.touches[0]||e.changedTouches[0],n=t.clientY;i.classList.add("auto-scroll");var l=window.innerHeight,c=n/l*100;c<=50?i.style.height="".concat(.8*document.documentElement.clientHeight,"px"):c<=70?i.style.height="".concat(document.documentElement.clientHeight*o,"px"):c>70&&r()})})}(s));var d=s.querySelector(".drag-view");if("visible"!=d.style.visibility){var a=s.querySelector(".drag-view-body");d.style.visibility="visible",a.style.height="".concat(l,"px");for(var v=s.querySelector(".innerbody");v.lastChild;)v.removeChild(v.lastChild);return v.appendChild(t),(0,e.checkIsTrue)(window.darkModeFG)&&(!(0,e.checkIsTrue)(window.isContentAlwaysLight)&&i.isDarkMode?s.classList.add("dark"):s.classList.add("light")),s}}function r(){var i=(0,e.$)(".drag-view"),o=i?i.querySelector(".drag-view-body"):null;if(o){o.addEventListener("transitionend",function e(){i.style.visibility="hidden",o.removeEventListener("transitionend",e)}),o.classList.add("auto-scroll"),o.style.height="0px"}(0,e.stopWindowScroll)(),(0,e.setContentScrollable)(!0);var n=(0,e.$)(".selected-translation");n&&n.classList.remove("selected-translation"),t.Commands.popoverDidClose()}return n.prototype.close=function(){r()},n.prototype.showWithBody=function(t){l((0,e.convertToNodeFirstElementByStr)('<div style="font-size: 20px; white-space: pre-line;">'.concat(t,"</div>")),this.popoverNodeStr,document.documentElement.clientHeight*o,this.popoverTitle),(0,e.setContentScrollable)(!1)},n.prototype.show=function(t,i){t.classList.add("selected-translation");var n=i.cloneNode(!0);n.style.display="";var r=document.documentElement.clientHeight*o;l(n,this.popoverNodeStr,r,this.popoverTitle);var c=(0,e.$)("html"),s=c.getBoundingClientRect(),d=t.getBoundingClientRect().bottom,a=document.documentElement.clientHeight-r;if(d>a){var v=d-a,u=-(s.top-v-10);if(u>=c.scrollHeight-document.documentElement.clientHeight){var h=Math.ceil(u+document.documentElement.clientHeight);document.body.style.height="".concat(h,"px")}(0,e.windowScrollTo)(u,function(){(0,e.setContentScrollable)(!1)})}else(0,e.setContentScrollable)(!1)},n}();
},{"./utils":"FOZT","./commands":"TnH5","./darkMode":"Nr45"}],"zfSF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Search=void 0;var e=require("./commands"),t=exports.Search=function(){var t,s,o="larkmail-mark";function n(o,n,r){try{o=Array.from(o).filter(function(e){return!!e});this.contexts=o,this.matches=0,this.matchNodes=[],this.fakeEllipsisNodeRecord=[],t=n,s=r,e.Commands.log("contexts size: "+o.length+" contexts: "+o,e.LogLevel.info)}catch(i){e.Commands.log("Search init error:"+i,!0)}}function r(e){var t="",o=[];return function(e,t){!function e(t,o){if(s&&s(t))return;o(t);var n=t.childNodes;var r=Array.from(n);for(var i=0,a=r.length;i<a;i++)e(r[i],o)}(e,function(e){3==e.nodeType?t(e,!1):0==e.childNodes.length&&e.offsetWidth>0&&t(e,!0)})}(e,function(e,s){o.push({start:t.length,end:(t+=s?"\n":e.textContent).length,node:e})}),{value:t,nodes:o}}function i(e,s,n,r){var i=!0;e.nodes.every(function(a,l){var c=e.nodes[l+1];if(void 0===c||c.start>s){var d,u=s-a.start,h=(n>a.end?a.end:n)-a.start,p=e.value.substr(0,a.start),f=e.value.substr(h+a.start);if(a.node.parentNode&&a.node.parentNode.textContent==a.node.textContent&&a.node.parentNode.classList&&a.node.parentNode.classList.contains(t)?d=a.node.parentNode:(a.node=function(e,s,n){var r=t?"span":"mark",i=e.splitText(s),a=i.splitText(n-s),l=document.createElement(r);l.setAttribute(o,"true"),t&&l.classList.add(t);return l.textContent=i.textContent,i.parentNode.replaceChild(l,i),a}(a.node,u,h),d=a.node.previousSibling),e.value=p+f,e.nodes.forEach(function(t,s){s>=l&&(e.nodes[s].start>0&&s!==l&&(e.nodes[s].start-=h),e.nodes[s].end-=h)}),n-=h,r(d,a.start,i),i=!1,!(n>a.end))return!1;s=a.end}return!0})}return n.prototype.mark=function(e){if(this.matches=0,e&&e.trim().length&&e&&e.length>0&&this.contexts&&this.contexts.length>0)for(var t=0;t<this.contexts.length;t++){var s=r(this.contexts[t]);this.wrapMatches(e,s,this.contexts[t])}},n.prototype.unmark=function(){var e;if(e=t?document.querySelectorAll(".".concat(t)):document.querySelectorAll("[".concat(o,"]")))for(var s=0;s<e.length;s++){var n=e[s];this.unwrapMatches(n)}this.matches=0,this.removeFakeCustomEllipsis()},n.prototype.unwrapMatches=function(e){for(var t=e.parentNode,s=document.createDocumentFragment();e.firstChild;)s.appendChild(e.removeChild(e.firstChild));t.replaceChild(s,e),t.normalize()},n.prototype.wrapMatches=function(e,t,s){var o,n=this,r=new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gim");console.log('ContentSearch with "'+r+'"');for(var a=!1,l=[],c=[];null!==(o=r.exec(t.value));){var d=o.index,u=d+o[0].length,h=this;l=[],i(t,d,u,function(e,t,o){r.lastIndex=t,o&&h.matches++,e&&s&&s.classList.contains("disable-scroll-horizontal")&&e.classList.add("disable-scroll-horizontal"),l.push(e),c.push(e)}),this.matchNodes.push(l),l.length>0&&(a=!0)}if(a&&s&&s.classList.contains("search-need-fake-custom-ellipsis")&&c.length>0){var p=s.closest(".message-item"),f=!0;p&&!p.classList.contains("expand")&&(f=!1,p.classList.add("expand")),c.forEach(function(e){n.addFakeCustomEllipsisIfNeeded(s,e)}),f||p.classList.remove("expand")}},n.prototype.updateFakeEllipsis=function(e){var t=e.closest(".fake-custom-ellipsis");if(e&&t){var s=t.getBoundingClientRect(),o=s.left,n=s.right,r=e.getBoundingClientRect(),i=r.left,a=r.right;i>=o&&a<n||t.style.setProperty("--custom-ellipsis-color",getComputedStyle(e,null).backgroundColor)}},n.prototype.addFakeCustomEllipsisIfNeeded=function(e,t){var s=e.getBoundingClientRect(),o=s.left,n=s.right,r=t.getBoundingClientRect(),i=r.left,a=r.right;if(!(i>=o&&a<n)){var l=!e.classList.contains("fake-custom-ellipsis");e.classList.add("fake-custom-ellipsis");var c=e.style.getPropertyValue("--custom-ellipsis-color"),d=getComputedStyle(t,null).backgroundColor;e.style.setProperty("--custom-ellipsis-color",d),this.fakeEllipsisNodeRecord.push({node:e,oldColor:c,firstTimeAdd:l,needResumeColor:d!=c})}},n.prototype.removeFakeCustomEllipsis=function(){this.fakeEllipsisNodeRecord.forEach(function(e){var t=e.node,s=e.oldColor,o=e.firstTimeAdd,n=e.needResumeColor;o&&t.classList.remove("fake-custom-ellipsis"),n&&t.style.setProperty("--custom-ellipsis-color",s)}),this.fakeEllipsisNodeRecord=[]},n}();
},{"./commands":"TnH5"}],"N3t7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TranslateRecommend=void 0;var e=require("./utils"),t=require("./commands"),n=exports.TranslateRecommend=function(){function n(e){this.recommendNodeStr='<div class="recommend-translate"><div class="translation-button recommend-translate-button"></div><span class="recommend-translate-border-line">|</span><svg class="recommend-translate-close" fill="none" height="18" viewBox="0 0 18 18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="m9.0001 7.58579 6.7175-6.717511c.1953-.195262.5119-.195262.7071 0l.7071.707111c.1953.19526.1953.51184 0 .7071l-6.7175 6.71752 6.7175 6.71749c.1953.1953.1953.5119 0 .7071l-.7071.7071c-.1952.1953-.5118.1953-.7071 0l-6.7175-6.7175-6.71752 6.7175c-.19526.1953-.51184.1953-.7071 0l-.70711-.7071c-.195262-.1952-.195262-.5118 0-.7071l6.71752-6.71749-6.71752-6.71752c-.195262-.19526-.195262-.51184 0-.7071l.70711-.707111c.19526-.195262.51184-.195262.7071 0z" fill="#3370FF"/></svg></div>',this.buttonTitle=e}function r(t,n){if(!(0,e.isNull)(t)){var r=(0,e.$)('.message-item[message-id="'.concat(t,'"]')),a=r.querySelector(".translation-operation-bar");if(!(0,e.isNull)(a)){var o=r.querySelector(".translation-language");o&&o.classList.remove("showRecommend");var s=a.querySelector(".recommend-translate");s&&a.removeChild(s),n&&(0,e.hideDomElement)(a)}}}return n.prototype.show=function(t,n){if(!(0,e.isNull)(t)){var r=(0,e.$)('.message-item[message-id="'.concat(t,'"]')),a=r.querySelector(".translation-operation-bar");if(!(0,e.isNull)(a)){var o=a.querySelector(".recommend-translate");if(o||(o=(0,e.convertToNodeFirstElementByStr)(this.recommendNodeStr),a.appendChild(o)),o.querySelector(".recommend-translate-button").innerText=this.buttonTitle,(0,e.showDomElement)(a),n){var s=r.querySelector(".translation-language");(0,e.isNull)(s)||(s.classList.add("showRecommend"),s.innerText=n)}var i=a.querySelector(".translation-view-translation-button"),l=a.querySelector(".translation-view-original-button"),m=a.querySelector(".language-drop-down-icon");(0,e.hideDomElement)(i),(0,e.hideDomElement)(l),(0,e.hideDomElement)(m)}}},n.prototype.handleTranslateRecommendClick=function(e){var n=e.target;if(n.classList.contains("recommend-translate-button")){var a=n.closest(".message-item").getAttribute("message-id");return t.Commands.track("mail_translation_recommend_btn",{thread_id:window.t_id,message_id:a,banner_action:"accept"}),t.Commands.translate(a),!0}if(n.closest(".recommend-translate-close")){var o=n.closest(".message-item").getAttribute("message-id");return r(o,!0),t.Commands.track("mail_translation_recommend_btn",{thread_id:window.t_id,message_id:o,banner_action:"ignore"}),!0}return!1},n.prototype.remove=r,n}();
},{"./utils":"FOZT","./commands":"TnH5"}],"vpJJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SafetyBanner=void 0;var e=require("./utils"),t=require("./commands"),a=exports.SafetyBanner=function(){var a=0,n=1,s=2,o=3;function r(){}return r.handleSafatyBannerClick=function(e){var a;if(e.target&&(e.target.matches(".safety-tip-banner .safety-button.safety-report")?(console.log("tap on safety report"),a=t.Commands.reportMessage):e.target.matches(".safety-tip-banner .safety-button.safety-normal")?(console.log("tap on safety unmark"),a=t.Commands.trustMessage):e.target.matches(".safety-tip-banner .safety-banner-icon.close-btn")&&(console.log("tap on safety close"),a=t.Commands.closeSafetyBanner),a))return a(e.target.closest(".message-item").getAttribute("message-id")),!0;return!1},r.update=function(r,c,i){t.Commands.log("SafetyBanner ".concat(r,", isSuspect ").concat(c,", reportType ").concat(i));i=parseInt(i);if(r&&!isNaN(i)){var m=(0,e.$)('.message-item[message-id="'.concat(r,'"] .safety-tip-banner'));if(m)if(c)switch(i){case a:(0,e.showDomElement)(m);break;case n:(0,e.showDomElement)(m);var f=m.querySelector(".safety-buttons-container");f&&(0,e.hideDomElement)(f);break;case o:case s:(0,e.hideDomElement)(m)}else(0,e.hideDomElement)(m)}},r}();
},{"./utils":"FOZT","./commands":"TnH5"}],"w5qj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InterceptBanner=void 0;var e=require("./commands"),t=exports.InterceptBanner=function(){function t(){}return t.handleShowInterceptedImageClick=function(t){if(t.target){if(t.target.matches(".intercept-tip-banner .intercept-button.show-images")){console.log("tap on show intercepted image");var n=t.target.closest(".message-item").getAttribute("message-id");return e.Commands.clickShowInterceptedImages(n),!0}return!1}return!1},t.handleInterceptBannerClick=function(t){if(t.target){if(t.target.matches(".intercept-tip-banner .intercept-button.intercept-more")){console.log("tap on intercept more button");var n=t.target.closest(".message-item").getAttribute("message-id"),r=t.target.getBoundingClientRect();return r?e.Commands.interceptedMoreAction(n,r.left,r.top,r.width-8,r.height):e.Commands.interceptedMoreAction(n,0,0,0,0),!0}return!1}return!1},t}();
},{"./commands":"TnH5"}],"Kw1T":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReadReceiptBanner=void 0;var e=require("./commands"),t=require("./utils"),r=exports.ReadReceiptBanner=function(){function t(){}return t.handleDontSendReceiptClick=function(t){if(t.target){if(t.target.matches(".read-receipt-banner .read-receipt-button.dont-send-button")){console.log("[read receipt] tap on dont send.");var r=t.target.closest(".message-item").getAttribute("message-id");return e.Commands.clickDontSendReceipt(r),!0}return!1}return!1},t.handleSendReceiptClick=function(t){if(t.target){if(t.target.matches(".read-receipt-banner .read-receipt-button.send-button")){console.log("[read receipt] tap on send.");var r=t.target.closest(".message-item").getAttribute("message-id");return e.Commands.clickSendReceipt(r),!0}return!1}return!1},t}();window.hideReadReceiptBanner=function(e){var r=(0,t.findMessageItem)(e);if(r){var n=r.querySelector(".read-receipt-banner");n&&(n.style.display="none")}},window.readReceiptBannerShowLoading=function(e){var r=(0,t.findMessageItem)(e);if(r){var n=r.querySelector(".read-receipt-banner");if(n)for(var a=n.querySelectorAll(".read-receipt-button"),i=0;i<a.length;i++)(0,t.addClass)(a[i],"loading")}},window.readReceiptBannerHideLoading=function(e){var r=(0,t.findMessageItem)(e);if(r){var n=r.querySelector(".read-receipt-banner");if(n)for(var a=n.querySelectorAll(".read-receipt-button"),i=0;i<a.length;i++)(0,t.removeClass)(a[i],"loading")}};
},{"./commands":"TnH5","./utils":"FOZT"}],"nfYH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MESSAGE_ITEM_CONTENT_CLASS_NAME=void 0;var e=exports.MESSAGE_ITEM_CONTENT_CLASS_NAME="item-content";
},{}],"Z8UI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleHyperLink=c;var e=require("../common/const"),t=/((?:https?|ftp):\/\/[\$\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\$\-A-Z0-9+\u0026@#\/%=~()_|])/gim,r=/(^(?:https?|ftp):\/\/[\$\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\$\-A-Z0-9+\u0026@#\/%=~()_|]$)/gim,n=/(^|[\s\n]|<[A-Za-z]*\/?>)*.((?:https?|ftp):\/\/[\$\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\$\-A-Z0-9+\u0026@#\/%=~()_|])(^|[\s\n]|<[A-Za-z]*\/?>)*./gim,a=3,o=1,i=9,u=11;function c(e){if(e){var t=!1;return p(e,function(e,r){var n=e.nodeValue;if(l(n)||d(n)&&!s(r)){var a=f(n);a&&(t=!0,r.replaceChild(a,e))}}),t}}function l(e){return!!e&&Boolean(e.match(n))}function d(e){return!!e&&Boolean(e.match(r))}function f(e){if(!e)return"";var r=e.match(t),n=e.split(t);if(r){var a=document.createElement("span");return n.forEach(function(e){if(r.includes(e)){var t=e,n=document.createTextNode(t),o=document.createElement("a");o.setAttribute("style","word-break: break-word;"),o.href=t,o.target="_blank",o.rel="noopener noreferrer",o.appendChild(n),a.appendChild(o)}else{var i=document.createTextNode(e);a.appendChild(i)}}),a}return null}function p(e,t){if(e)for(var r=e.childNodes,n=r.length;n--;){var c=r[n],l=c.nodeType,d=c.nodeName;l===a&&t?t(c,e):l!==o&&l!==i&&l!==u||"STYLE"===d.toUpperCase()||p(c,t)}}function s(t){for(var r=t,n=!1;;){if("A"===r.nodeName.toUpperCase()){n=!0;break}if(!r.parentElement)break;if(r.classList.contains(e.MESSAGE_ITEM_CONTENT_CLASS_NAME))break;if(r.childNodes.length>1)break;r=r.parentElement}return n}
},{"../common/const":"nfYH"}],"ao0o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.listenAllNodeScroll=c;var e,t,o=require("./commands"),l=require("./mailScale"),n=require("./utils"),r=!1;window.ontouchstart=function(e){2===e.touches.length?(o.Commands.log("touch start with 2"),r=!0):r=!1},window.ontouchend=function(){r&&(r=!1,f())},window.ontouchcancel=function(){r&&(r=!1,f())},window.ongestureend=function(){r&&(r=!1,f())},window.trackForScroll=function(r,i,a){var c={intX:parseInt(r),width:i};null==e&&(e=null!=(0,n.$)("table")?1:0),null==t&&(t=e&&null!=(0,n.$)("table img")?1:0),c.hasTable=e,c.hasTableImg=t,c.applyScaleOps=window.applyScaleOps,c.optimizeFeat=(0,l.scaleOptimizeFeat)(),c.isJSTrigger=a?1:0,o.Commands.track("email_read_scroll_content_dev",c)};var i=!1,a={node:void 0,startOffetLeft:void 0,timer:void 0};function c(){try{if(i)return;i=!0;for(var e=document.querySelectorAll(".message-content"),t=0;t<e.length;t++){var l=e[t],n=l.querySelectorAll("*");s(l.closest(".outer-content-container")),s(l);for(var r=0;r<n.length;r++)s(n[r])}}catch(a){o.Commands.log("listenAllNodeScroll error ".concat(a))}}function s(e){e&&(e.removeEventListener("scroll",u),e.addEventListener("scroll",u))}function u(e){var t=e.target;a||(a={}),a&&a.node!=t&&null==a.startOffetLeft&&(a.node=t,a.startOffetLeft=t.scrollLeft),clearTimeout(a.timer);a.timer=setTimeout(function(){d(e)},300)}function d(e){if(a){if(clearTimeout(a.timer),!(0,n.isNullOrNaN)(a.startOffetLeft)){var t=e.target,o=t.scrollLeft-a.startOffetLeft,l=t.scrollWidth;window.trackForScroll(o,l,!0)}a={}}}function f(){var e;window.visualViewport?(o.Commands.log("visulScale support"),e=window.visualViewport.scale):(0,n.isIOS)()&&(e=window.outerWidth/window.innerWidth);var t=null!=(0,n.$)("table")?1:0,r=t&&null!=(0,n.$)("table img")?1:0,i={optimizeFeat:(0,l.scaleOptimizeFeat)(),hasTable:t,hasTableImg:r,applyScaleOps:window.applyScaleOps};if(void 0!==e){e=e<=1?1:e>=2?2:e,i.scale=e.toFixed(2)}o.Commands.track("email_read_scale_content_dev",i)}
},{"./commands":"TnH5","./mailScale":"WwWL","./utils":"FOZT"}],"XLy4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateMessageListDivider=c;var e=require("./utils"),t=require("./commands"),i="message-item-divider",s="hide",a=0,r=1,n=2;function c(e,s){if(e){var a=e.querySelector(".".concat(i));if(a){var c=u(a,s);t.Commands.log("updateMessageListDivider ".concat(c)),c===r||c===n?(d(a,c===r),l(a)):o(a)}}}function u(t,i){var s=function(e){return e.matches(".message-item[isread=false]")&&!e.hasAttribute("reply-message-id")},c=(0,e.findSiblingElementMatchFn)(t,s,i);return c?(0,e.findSiblingElementMatchFn)(c,s,i)?n:r:a}function d(e,t){var i=t?"data-singular":"data-plural";if(e.hasAttribute(i)){var s=e.querySelector(".message-item-divider-title"),a=e.getAttribute(i);s&&a&&(s.innerText=a)}}function l(e){e.classList.contains(s)&&e.classList.remove(s)}function o(e){e.classList.contains(s)||e.classList.add(s)}
},{"./utils":"FOZT","./commands":"TnH5"}],"M3ZB":[function(require,module,exports) {
"use strict";function t(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=n(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,h=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){h=!0,s=t},f:function(){try{a||null==r.return||r.return()}finally{if(h)throw s}}}}function n(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}function e(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function r(t,n){this.firstInterval=t,this.lastInterval=n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.computeImpactedArea=f;var i="kStart",o="kEnd";function s(t,n,e){this.x=t,this.type=n,this.ySegment=e}function a(){this.endpoints=[],this.endpointToIndex=new Map}function h(t){this.intervals=t,this.nodes=new Array(this.computeCapacity(t.numIntervals())),this.nodes.fill(new u(0,0))}function u(t,n){this.refCount=t,this.activeLength=n}function f(n){if(1==n.length)return n[0].width*n[0].height;var e,r=new a,u=t(n);try{for(u.s();!(e=u.n()).done;){var f=e.value;r.addEndpoint(f.y),r.addEndpoint(f.bottom)}}catch(b){u.e(b)}finally{u.f()}r.createIndex();var p,c=new Array,l=new h(r),d=t(n);try{for(d.s();!(p=d.n()).done;){var v=p.value,y=new s(v.x,i,r.segmentFromEndpoints(v.y,v.bottom)),g=new s(v.right,o,r.segmentFromEndpoints(v.y,v.bottom));c.push(y),c.push(g)}}catch(b){d.e(b)}finally{d.f()}c.sort(function(t,n){return t.x-n.x});for(var m=0,I=c[0].x,w=0,x=c;w<x.length;w++){var S=x[w];S.x>I&&(m+=(S.x-I)*l.activeLength(),I=S.x),S.type==i?l.refSegment(S.ySegment):l.derefSegment(S.ySegment)}return m}a.prototype.addEndpoint=function(t){this.endpointToIndex.has(t)||(this.endpointToIndex.set(t,0),this.endpoints.push(t))},a.prototype.createIndex=function(){this.endpoints.sort(function(t,n){return t-n});var n,e=0,r=t(this.endpoints);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.endpointToIndex.set(i,e++)}}catch(o){r.e(o)}finally{r.f()}},a.prototype.numIntervals=function(){return this.endpoints.length-1},a.prototype.segmentFromEndpoints=function(t,n){return new r(this.endpointToIndex.get(t),this.endpointToIndex.get(n)-1)},a.prototype.segmentLength=function(t){return this.endpoints[t.lastInterval+1]-this.endpoints[t.firstInterval]},h.prototype.computeCapacity=function(t){for(var n=1;n<t;)n<<=1;return(n<<1)-1},h.prototype.leftChild=function(t){return 1+(t<<1)},h.prototype.rightChild=function(t){return 2+(t<<1)},h.prototype.rootSegment=function(){return new r(0,this.intervals.numIntervals()-1)},h.prototype.computeActiveLength=function(t,n){return this.nodes[t].refCount>0?this.intervals.segmentLength(n):n.lastInterval>n.firstInterval?this.nodes[this.leftChild(t)].activeLength+this.nodes[this.rightChild(t)].activeLength:0},h.prototype.refSegment=function(t){this.visit(0,this.rootSegment(),t,1)},h.prototype.derefSegment=function(t){this.visit(0,this.rootSegment(),t,-1)},h.prototype.visit=function(t,n,e,i){var o=this.nodes[t],s=n.firstInterval,a=n.lastInterval,h=e.firstInterval,u=e.lastInterval;if(s===h&&a===u)o.refCount+=i;else{var f=s+a>>1,p=f+1;if(h<=f){var c=new r(s,f),l=new r(h,Math.min(u,f));this.visit(this.leftChild(t),c,l,i)}if(u>=p){var d=new r(p,a),v=new r(Math.max(h,p),u);this.visit(this.rightChild(t),d,v,i)}}o.activeLength=this.computeActiveLength(t,n)},h.prototype.activeLength=function(){return this.nodes[0].activeLength};
},{}],"zWOE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.oberverAllNodes=L,exports.reportCLSScore=C;var e=require("./sweepLineAlgo"),t=require("./commands"),r=require("./mailScale");function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw i}}}}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}try{if(ResizeObserver)var i=new ResizeObserver(function(e){I(e)})}catch(E){t.Commands.log("ResizeObserver not available:"+E,t.LogLevel.error)}var c,s,l=0,h=new Map,u=!1,m=0,g=0,f=0,d=0,v=0,p=0,S=0,w=0,b=0,y=0,M=0,x=0;function C(e){if(!u||m>0){u=!0;var a=0;e&&c&&(a=c-e);var n=(0,r.scaleOptimizeFeat)();t.Commands.track("email_message_cls_score_dev",{clsScore:m,shiftInterval:a,unexpectedCLSScore:f,scaleCLSScore:v,imageCLSScore:S,featCLSScore:M,userCLSScore:b,optimizeFeat:n})}m=0,g=0,f=0,d=0,v=0,p=0,S=0,w=0,b=0,y=0,M=0,x=0,s=null}function L(){if(i){var e,t=a(document.querySelectorAll("*"));try{for(t.s();!(e=t.n()).done;){var r=e.value;null==r.observeID&&(r.observeID=l,l+=1),i.observe(r),h.set(r.observeID,r.getBoundingClientRect())}}catch(n){t.e(n)}finally{t.f()}}}function I(e){var t=0,r=[],n=0,o=[],i=0,c=[],l=0,u=[],C=0,L=[],I=0,E=[],N=window.scrollX,O=window.scrollY,_=document.documentElement.clientWidth,R=document.documentElement.clientHeight,z=[],F=[],j=[],q=!1;window.lastUserInputTime&&Date.now()-window.lastUserInputTime<500&&(q=!0);var T,U=a(e);try{for(U.s();!(T=U.n()).done;){var k=T.value;if(!k.target.classList.contains("loading_container")&&"img"!==k.target.nodeName.toLowerCase()){var B,H=h.get(k.target.observeID),W=k.target.getBoundingClientRect(),P=k.target.ignoreScaleCLS,X=k.target.ignoreImageCLS,Y=k.target.ignoreFeatCLS;if(k.target.classList.contains("banner-container")&&(q=!0),X||P||Y)B=k.target;else for(var $=k.target.parentNode;$;){if($.ignoreScaleCLS){P=!0,B=$;break}$=$.parentNode}if(H&&(H.x!==W.x||H.y!==W.y||H.width!==W.width||H.height!==W.height)){var G=D(H,_,R,N,O),J=D(W,_,R,N,O);if(0!==G.width&&0!==G.height&&(r.push(G),P?c.push(G):X?u.push(G):Y?E.push(G):o.push(G)),0!==J.width&&0!==J.height&&(r.push(J),P?c.push(J):X?u.push(J):Y?E.push(J):o.push(J)),!(0===G.width&&0===J.width||0===G.height&&0===J.height)){var K=Math.max(Math.abs(J.y-G.y),Math.abs(J.x-G.x)),Q=Math.max(Math.abs(J.width-G.width),Math.abs(J.height-G.height));t=Math.max(t,Math.max(K,Q));var V=Math.max(K,Q);P?i=Math.max(i,V):X?l=Math.max(l,V):Y?I=Math.max(I,V):n=Math.max(n,V),B&&(K>0||Q>0)&&(X?F.push(B):P?z.push(B):Y&&j.push(B))}}h.set(k.target.observeID,W)}}}catch(ie){U.e(ie)}finally{U.f()}q?(L=r,C=t,o=[],n=0,c=[],i=0,u=[],l=0,E=[],I=0):(z.forEach(function(e){e.ignoreScaleCLS=!1}),F.forEach(function(e){e.ignoreImageCLS=!1;for(var t=e.parentNode;t;)t.ignoreImageCLS=!1,t=t.parentNode}),j.forEach(function(e){e.ignoreFeatCLS=!1;for(var t=e.parentNode;t;)t.ignoreFeatCLS=!1,t=t.parentNode}));var Z=A(r,t);if(Z>0){console.log("score",Z);var ee=A(o,n);console.log("unexpected score",ee);var te=A(c,i);console.log("scale score",te);var re=A(u,l);console.log("image score",re);var ae=A(L,C);console.log("user score",ae);var ne=A(E,I);console.log("feature score",ne);var oe=Date.now();!s||oe-s>5e3?(s=oe,g=Z,d=ee,p=te,w=re,y=ae,x=ne):(g+=Z,d+=ee,p+=te,w+=re,y+=ae,x+=ne),g>m&&(m=g),d>f&&(f=d),p>v&&(v=p),w>S&&(S=w),y>b&&(b=y),x>M&&(M=x)}}function A(t,r){if(t.length>0&&r>0){var a=document.documentElement.clientWidth,n=document.documentElement.clientHeight,o=(0,e.computeImpactedArea)(t)/(n*a);console.log("impact fraction",o);var i=Math.max(n,a),s=o*Math.min(r/i,1);return c=Date.now(),s}return 0}function D(e,t,r,a,n){var o=Math.min(Math.max(e.x+a,0),t),i=Math.min(Math.max(e.y+n,0),r),c=Math.max(Math.min(o+e.width,t)-o,0),s=Math.max(Math.min(i+e.height,r)-i);return new DOMRect(o,i,c,s)}
},{"./sweepLineAlgo":"M3ZB","./commands":"TnH5","./mailScale":"WwWL"}],"pWjn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadInterceptedImages=u,exports.updateInterceptedImage=l;var e=require("./commands"),t=require("./utils"),r=require("./imagePlaceholder");function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw i}}}}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=new Map,o=new Map,c=new Map;function l(r,n){var a,s;if(r){var i=r.closest(".message-item");a=i.getAttribute("message-id"),s=i.querySelector(".intercept-tip-banner");var l="style, [intercepted-data-src], [intercepted-table-background], [style*= background], [style*= content]",u=r.querySelectorAll(l),d=u,g=r.querySelectorAll("div[id^=large-file-area]");if(g&&g.length>0){var m=Array.from(g).map(function(e){return e.querySelectorAll(l)}),y=Array.from(u),v=Array.from(m[0]);d=y.filter(function(e){return!v.includes(e)}),v.forEach(function(e){p(e,!1,"",!1)})}for(var b=a&&(window.interceptMessageIDs.includes(a)||window.spamMessageIDs.includes(a)),w=!1,h=0;h<d.length;h++){var I=d[h];if("STYLE"===I.tagName){var S=f(I.sheet.cssRules,b);I.textContent=S}var A=p(I,b,void 0,n);w=w||A,A&&!window.spamMessageIDs.includes(a)&&(c.get(a)&&s?s.classList.remove("display-none"):o.set(a,!0))}a&&s&&o.get(a)&&e.Commands.showInterceptedBanner(a),(0,t.checkIsTrue)(window.optimizeWebImageBlocking)&&a&&s&&w&&!window.spamMessageIDs.includes(a)&&s.classList.remove("display-none")}}function u(e,t){for(var r=document.getElementsByClassName("message-item"),a=0;a<r.length;a++){var s=r[a],i=s.getAttribute("message-id");if((""===e||e.includes(i))&&!window.spamMessageIDs.includes(i)){var c=s.querySelector(".intercept-tip-banner");c&&(o.set(i,null),c.classList.add("display-none"));var l,u=n(s.getElementsByTagName("STYLE"));try{for(u.s();!(l=u.n()).done;){var d=l.value,g=f(d.sheet.cssRules,!1);d.textContent=g}}catch(I){u.e(I)}finally{u.f()}var m,y=s.getElementsByClassName("intercepted-img"),v=n(y);try{for(v.s();!(m=v.n()).done;){p(m.value,!1,void 0,t)}}catch(I){v.e(I)}finally{v.f()}var b,w=n(y);try{for(w.s();!(b=w.n()).done;){b.value.classList.remove("intercepted-img")}}catch(I){w.e(I)}finally{w.f()}}}if(""===e)window.interceptMessageIDs="";else{var h=window.interceptMessageIDs;e.split(",").forEach(function(e){h.includes(e)&&(h=h.replace(e,""))}),window.interceptMessageIDs=h}}function d(e){for(var t=document.getElementsByClassName("message-item"),r=0;r<t.length;r++){var n=t[r],a=n.getAttribute("message-id"),s=n.querySelector(".intercept-tip-banner");a&&e.includes(a)&&(o.get(a)&&s?(s.classList.remove("display-none"),o.set(a,null)):c.set(a,!0))}}function p(e,t,n,a){var s=!1;if(e.getAttribute("intercepted-data-src"))t?((0,r.showImgPlaceholder)(e,!1,!0),s=!0):window.setInterceptImageLoading(e,e.getAttribute("intercepted-data-src"),n,a);else if(e.getAttribute("intercepted-table-background"))if(t)e.setAttribute("background","url()"),s=!0;else{var i=e.getAttribute("intercepted-table-background");e.setAttribute("background",i)}else e.getAttribute("style")&&["background","background-image","content"].forEach(function(r){var n=e.style.getPropertyValue(r);if(n){var a=e.interceptImgs;if(t){if(n.includes("intercepted-data-url")){var i=n.replace("intercepted-data-url",""),o={propName:r,src:i};a?(a.push(o),e.interceptImgs=a):e.interceptImgs=[o],e.style.setProperty(r,"url()"),s=!0}}else if(a)a.forEach(function(t){t.propName&&t.src&&t.propName===r&&e.style.setProperty(r,t.src)});else if(n.includes("intercepted-data-url")){var c=n.replace("intercepted-data-url","");e.style.setProperty(r,c)}}});return!(!s||!t)&&(e.classList.add("intercepted-img"),!0)}function f(e,t){if(e){for(var r=[],n=["background","background-image","content"],a=function(){var a=e[s];(a instanceof CSSStyleRule||a instanceof CSSKeyframeRule||a instanceof CSSPageRule)&&n.forEach(function(e){var r=a.style.getPropertyValue(e);if(r){var n=a.style.getPropertyPriority(e),s=i.get(a.selectorText);if(t){if(r.includes("intercepted-data-url")){var o=r.replace("intercepted-data-url",""),c={propName:e,src:o};s?(s.push(c),i.set(a.selectorText,s)):i.set(a.selectorText,[c]),a.style.setProperty(e,"url()",n)}}else if(s)s.forEach(function(t){t.propName&&t.src&&(t.propName===e||"background-image"===e)&&(t.propName===e?a.style.setProperty(e,t.src,n):"background"===t.propName&&(a.style.removeProperty("background-image"),a.style.setProperty(t.propName,t.src,n)))});else if(r.includes("intercepted-data-url")){var l=r.replace("intercepted-data-url","");a.style.setProperty(e,l,n)}}}),(a instanceof CSSSupportsRule||a instanceof CSSMediaRule||a instanceof CSSKeyframesRule||a instanceof CSSPageRule)&&f(a.cssRules),r.push(a.cssText)},s=e.length-1;s>=0;s--)a();return r.reverse().join("")}}window.showInterceptedImages=function(e,t){u(e,"true"===t)},window.delayShowInterceptedBanner=function(e){d(e)},window.checkMessageHasWebImageBanner=function(e){var r=(0,t.findMessageItem)(e);if(r&&!r.querySelector(".intercept-tip-banner").classList.contains("display-none"))return"true";return"false"},window.isMessageIntercepted=function(e){return window.interceptMessageIDs.split(",").includes(e)?"true":"false"};
},{"./commands":"TnH5","./utils":"FOZT","./imagePlaceholder":"cxKd"}],"eTQb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Trace=exports.Metric=exports.Index=void 0;var t=exports.Index={js_start:0,dom_content_loaded:1,init_start:2,init_ui_end:3,first_scale_end:4,init_end:5,dom_ready:6,first_content_rendered:7,stats_count:8},e=exports.Metric={webview_parse_html:0,init_delay:1,init_ui:2,first_scale:3,init_other:4,time_js:5,time_total:6,time_first_frame:7,metric_count:8},i=exports.Trace=function(){var i=[],_=[t.js_start,t.dom_content_loaded,t.dom_content_loaded,t.init_start,t.init_start,t.init_ui_end,t.init_ui_end,t.first_scale_end,t.first_scale_end,t.init_end,t.js_start,t.dom_ready,t.js_start,t.init_end,t.js_start,t.first_content_rendered],n=-1;function r(e){var _=e===t.js_start?window.js_start:i[e];return _||0}function s(t){if(t<e.webview_parse_html||t>=e.metric_count)return n;var i=2*t,s=r(_[i+1]),a=r(_[i]);return a<=0||s<a?n:s-a}return{arriveTo:function(e){e<=t.js_start||e>=t.stats_count||(i[e]=Date.now())},getTiming:r,getMetric:s,getTimings:function(){return{js_start:r(t.js_start),dom_content_loaded:r(t.dom_content_loaded),init_start:r(t.init_start),init_ui_end:r(t.init_ui_end),first_scale_end:r(t.first_scale_end),init_end:r(t.init_end),dom_ready:r(t.dom_ready),first_content_rendered:r(t.first_content_rendered)}},getMetrics:function(){return{webview_parse_html:s(e.webview_parse_html),init_delay:s(e.init_delay),init_ui:s(e.init_ui),first_scale:s(e.first_scale),init_other:s(e.init_other),time_js:s(e.time_js),time_total:s(e.time_total),time_first_frame:s(e.time_first_frame)}}}}();
},{}],"vc6A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addHandlerToMessageAction=c,exports.doVisualMessageCheck=L,exports.handleFowllowClick=m,exports.handleMessageDraftClick=q,exports.listenToScrollLoadMore=h,exports.triggerNativeAvatarUpdate=A,exports.updateDraftHeaderDetail=T,exports.updateIpadStyleIfNeeded=M;var e=require("./commands"),t=require("./avatar"),r=require("./utils");function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,l=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){i=!0,n=e},f:function(){try{l||null==r.return||r.return()}finally{if(i)throw n}}}}function a(e,t){return d(e)||i(e,t)||s(e,t)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function i(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var o,a,n,s,l=[],i=!0,d=!1;try{if(n=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(o=n.call(r)).done)&&(l.push(o.value),l.length!==t);i=!0);}catch(e){d=!0,a=e}finally{try{if(!i&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(d)throw a}}return l}}function d(e){if(Array.isArray(e))return e}function c(t,r){var o=t.getAttribute("message-id"),a=r.querySelector("#message-action-reply");a&&a.addEventListener("click",function(t){e.Commands.replyAction(o)});var n=r.querySelector("#message-action-replyall");n&&n.addEventListener("click",function(t){e.Commands.replyAllAction(o)});var s=r.querySelector("#message-action-forward");s&&s.addEventListener("click",function(t){e.Commands.forwardAction(o)});var l=r.querySelector("#message-action-sendtochat");l&&l.addEventListener("click",function(t){e.Commands.sendToChatAction(o)})}function m(t,r){e.Commands.log("handle fowllow click",e.LogLevel.info);var o=t.target.closest(".show-follow-btn"),a=r.querySelector(".avatar"),n=a.getAttribute("user-address")||"",s=a.getAttribute("user-name")||"";if(o){var l=o.getAttribute("follow-type");return"follow"==l?(e.Commands.log("handle fowllow click - unfollow"+n+s,e.LogLevel.info),t.stopPropagation(),e.Commands.followBtnClickMethod(n,s,"unfollow")):"unfollow"==l&&(e.Commands.log("handle fowllow click - follow"+n+s,e.LogLevel.info),t.stopPropagation(),e.Commands.followBtnClickMethod(n,s,"follow")),!0}return e.Commands.log("handle fowllow click faild",e.LogLevel.error),!1}window.updateFollowType=function(t,o){try{e.Commands.log("updateFollowType success:"+t+o,e.LogLevel.info,!0);var a=(0,r.findMessageItemsByAddress)(t);if((0,r.isNull)(a))return;for(var n=0;n<a.length;n++){var s=a[n];if(s){var l=s.querySelector(".header-content");if(l){var i=l.querySelector(".from").querySelector(".show-follow-btn");i&&(i.setAttribute("follow-type",o),e.Commands.log("follow-type"+o,e.LogLevel.info,o))}var d=s.querySelector(".important-contact-banner-wrapper");d&&d.parentNode.removeChild(d)}}}catch(c){e.Commands.log("updateFollowType error:"+c,e.LogLevel.error,!0)}},window.stopLoadMore=function(t){var r="true"==t;if(e.Commands.log("stopLoadMore isUp:"+r),r){var o=document.querySelector("#message_loadmore_up");o&&(o.style.display="none",g=!1)}else{var a=document.querySelector("#message_loadmore_down");a&&(a.style.display="none",p=!1)}},window.loadMoreEnable=function(t,r){var o="true"==t,a="true"==r,n=o&&window.isNewMessageAtTop||!o&&!window.isNewMessageAtTop;(e.Commands.log("loadMoreEnable isUp:"+n+" isNewer:"+o+" isEnable:"+a),n)?document.querySelector("#message_loadmore_up")&&(u=a):document.querySelector("#message_loadmore_down")&&(f=a);if(a){var s=document.querySelector(".message-list");s&&(s.clientHeight+s.offsetTop<window.innerHeight||!n&&s.clientHeight+s.offsetTop-document.documentElement.scrollTop<window.innerHeight-10||n&&document.documentElement.scrollTop<10)&&(e.Commands.log("trigger auto load more for enable isUp:"+n,e.LogLevel.info),b(n,!0))}};var u=!0,f=!0,g=!1,p=!1,y=-1,v="",w=!1;function h(){var t=document.querySelector("#message_loadmore_up"),r=document.querySelector("#message_loadmore_down"),o=document.querySelector(".message-list");null!=t&&null!=r?(w=!0,window.addEventListener("scroll",function(){if(null!=o){var t=document.documentElement.scrollTop,r=o.offsetTop,a=o.clientHeight,n=window.innerHeight,s=y>=0&&t<y,l=y>=0&&t>y;e.Commands.log("scrollUp:"+s+" scrollDown:"+l+" current:"+t+" last:"+y),y=t,L(o),s&&t-r<0&&u&&!g&&(e.Commands.log("trigger load more up can:"+u+" looading:"+g,e.LogLevel.info),b(!0,!0)),l&&a+r-t-n<20&&f&&!p&&(e.Commands.log("trigger load more down can:"+f+" laoding:"+p,e.LogLevel.info),b(!1,!0))}}),L(o),o.offsetTop+o.clientHeight<window.innerHeight&&S()):e.Commands.log("can't listenScrollToLoadMore",e.LogLevel.info)}function S(){e.Commands.log("autoLoadMoreNotEnoughScreen",e.LogLevel.info),b(!1,!1),b(!0,!1)}function L(t){if(w&&t){for(var r=t.querySelectorAll(".message-item[message-id]"),o=window.innerHeight,a=new Array,n="",s=0;s<r.length;s++){var l=r[s],i=l.offsetTop-document.documentElement.scrollTop,d=i+l.clientHeight;if(e.Commands.log("scroll message headerIndex:"+i),i>=0&&i<o||d>=0&&d<o){var c=l.getAttribute("message-id"),m=l.getAttribute("timestamp"),u=l.classList.contains("expand");n+=c+(u?"e":"h"),a.push({messageId:c,timestamp:m,isExpand:u})}if(d>o)break}n!=v&&(v=n,e.Commands.currentVisualMessage(a))}}function b(t,r){var o=document.querySelector(".message-list").querySelectorAll(".message-item[message-id]");if(t){if(g=!0,r)document.querySelector("#message_loadmore_up").style.display="flex";if(o.length>0){var a=o[0].getAttribute("message-id"),n=o[0].getAttribute("timestamp");e.Commands.triggerLoadMore(!0,window.isNewMessageAtTop,a,n)}}else{if(p=!0,r)document.querySelector("#message_loadmore_down").style.display="flex";if(o.length>0){var s=o[o.length-1].getAttribute("message-id"),l=o[o.length-1].getAttribute("timestamp");e.Commands.triggerLoadMore(!1,window.isNewMessageAtTop,s,l)}}}function C(t,o){e.Commands.log("updateFeedSubjectLabel "+o);var a=function(e){return null!=e},n=(0,r.$)('.message-item[message-id="'.concat(o,'"] .feed-card-hit-content'));if(e.Commands.log("feedCardHeader: "+n),a(n)){e.Commands.log("feedCardHeader: "+n);var s=n.cloneNode(),l=(0,r.$)('.message-item[message-id="'.concat(o,'"] .message-external-item')),i=(0,r.$)('.message-item[message-id="'.concat(o,'"] .message-subject')),d=(0,r.$)('.message-item[message-id="'.concat(o,'"] .subject-translation')),c=(0,r.$)('.message-item[message-id="'.concat(o,'"] .feed-card-header-separator'));if(a(n)){e.Commands.log("messageExternalItem: "+l),e.Commands.log("messageSubject: "+i),e.Commands.log("subjectTranslation: "+d),s.innerHTML=t;var m=s.firstChild;if(a(l))a(m)?s.insertBefore(l,m):s.appendChild(l);else{var u=document.createElement("span");u.innerHTML="&nbsp;",a(m)?s.insertBefore(u,m):s.appendChild(u)}m=s.firstChild,a(d)&&(a(m)?s.insertBefore(d,m):s.appendChild(d)),m=s.firstChild,a(i)&&(a(m)?s.insertBefore(i,m):s.appendChild(i)),s.appendChild(c)}n.parentNode.replaceChild(s,n),(0,r.modifyLabelsRTL)()}}function q(t){var r=t.target;if(r.closest(".message-draft-container")){var o=r.closest(".message-item").getAttribute("message-id");return e.Commands.clickMessageDraft(o),!0}return!1}function A(e,t){var r=e.querySelector(".message-draft-container");if(r&&!r.classList.contains("empty-draft")){var o=r.querySelector(".native-avatar");o&&(!t&&o.manuallyInserToNative?o.manuallyInserToNative():t&&o.manuallyRemoveToNative&&o.manuallyRemoveToNative())}}function T(e){var t=e.querySelector(".message-draft-container");if(t){var r=e.querySelector(".header-detail-text"),o=e.querySelector(".draft-header-container");if(t.classList.contains("empty-draft"))r.classList.remove("display-none"),o.classList.add("display-none");else{var a=t.querySelector(".message-draft-summary").innerText;r.classList.add("display-none"),o.classList.remove("display-none"),o.querySelector(".draft-header-detail").innerText=a}}}function M(e){if((0,r.isPad)()&&e){var t=e.querySelector(".message-draft-container"),o=e.querySelector(".item-content");t&&!t.classList.contains("empty-draft")&&o.classList.add("remove-border")}}window.updateFeedLabels=function(e,t){C(e,t)},window.updateMessagesDraftSummary=function(e){for(var o=JSON.parse(e),n=0,s=Object.entries(o);n<s.length;n++){var l=a(s[n],2),i=l[0],d=l[1],c=(0,r.findMessageItem)(i);if(c){var m=c.querySelector(".message-draft-container");if(m){m.classList.remove("empty-draft"),m.querySelector(".message-draft-summary").innerText=d.replace(/\n/g," ");var u=m.querySelector(".native-avatar");u&&u.manuallyInserToNative?u.manuallyInserToNative():(0,t.updateAvatar)(m,!1)}}}},window.removeMessagesDraftSummary=function(e){var t=JSON.parse(e);if(t){var a,n=o(t);try{for(n.s();!(a=n.n()).done;){var s=a.value,l=(0,r.findMessageItem)(s);if(l){var i=l.querySelector(".message-draft-container"),d=l.querySelector(".header-detail-text"),c=l.querySelector(".draft-header-container"),m=l.querySelector(".item-content");if(i)A(l,!0),i.classList.add("empty-draft"),m.classList.remove("remove-border"),i.querySelector(".message-draft-summary").innerText="",d.classList.remove("display-none"),c.classList.add("display-none")}}}catch(u){n.e(u)}finally{n.f()}}};
},{"./commands":"TnH5","./avatar":"IjMb","./utils":"FOZT"}],"KNVS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.handleImportantContactBannerClick=o,exports.updateImportantContactBannerStyle=c;var t=require("./commands"),e=require("./utils");function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,c=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw c}}}}function r(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(e){var n=e.target,r=n.closest(".important-contact-banner-wrapper");if(r){var a=n.closest(".message-item").querySelector(".avatar"),o=a.getAttribute("user-address")||"";if(n.matches(".important-contact-button.important-contact-follow")){var c=a.getAttribute("user-name")||"";return t.Commands.followRecommendContact(o,c),!0}if(n.matches(".important-contact-button.important-contact-recommend")){for(var i=document.querySelectorAll(".important-contact-banner-wrapper"),s=0;s<i.length;s++)i[s].parentNode.removeChild(i[s]);return t.Commands.stopRecommendContact(),!0}return!!n.closest(".important-contact-close")&&(r.parentNode.removeChild(r),t.Commands.closeContactRecommendBanner(o),!0)}return!1}function c(t){var e=t.querySelector(".important-contact-banner");if(e){var n=e.querySelector(".important-contact-button-container"),r=e.querySelector(".important-contact-description-container"),a=e.querySelector(".important-contact-description");r.offsetTop!==n.offsetTop?(n.classList.add("wrapped-line"),a.classList.add("wrapped-line")):(n.classList.remove("wrapped-line"),a.classList.remove("wrapped-line"))}}window.updateImportantContact=function(t){var r=JSON.parse(t);if(r){var a,o=n(r);try{var c=function(){var t=a.value,n=(0,e.findMessageItem)(t);if(n){var r=n.querySelector(".important-contact-banner-wrapper"),o=n.querySelector(".important-contact-banner");r&&r.classList.contains("banner-expand-start")&&(n.classList.contains("expand")?e.domReadyTime.value&&Date.now()-e.domReadyTime.value<200&&(r.style.height=o.scrollHeight+"px",r.addEventListener("transitionend",function(){r.style.height="auto"},{once:!0}),r.classList.remove("banner-expand-start")):r.classList.remove("banner-expand-start"))}};for(o.s();!(a=o.n()).done;)c()}catch(i){o.e(i)}finally{o.f()}}};
},{"./commands":"TnH5","./utils":"FOZT"}],"Q86i":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Lifecycle=void 0;var e=require("./trace"),n=require("./commands"),t=exports.Lifecycle={onDomContentLoaded:function(){n.Commands.callbackJsLifecycle("domContentLoaded",{js_start:e.Trace.getTiming(e.Index.js_start),dom_content_loaded:e.Trace.getTiming(e.Index.dom_content_loaded)})},onInitUIEnd:function(){n.Commands.callbackJsLifecycle("initUIEnd",{init_ui_end:e.Trace.getTiming(e.Index.init_ui_end)})},onInitEnd:function(){n.Commands.callbackJsLifecycle("initEnd",{init_end:e.Trace.getTiming(e.Index.init_end)})},onFirstContentRendered:function(){n.Commands.callbackJsLifecycle("firstContentRendered",{first_content_rendered:e.Trace.getTiming(e.Index.first_content_rendered)})}};
},{"./trace":"eTQb","./commands":"TnH5"}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.avatarLogger=Q,exports.scaleOnImgLoad=xa,require("./errorTracker");var e=require("./avatar"),t=require("./utils"),a=require("./mailScale"),n=require("./commands"),r=require("./renderQuote"),o=require("./popover"),i=require("./search"),s=require("./translateRecommend"),l=require("./safetyBanner"),c=require("./interceptBanner"),d=require("./readReceiptBanner"),m=require("./htmlRules/hyperLinkRule"),u=require("./touchHandler"),g=require("./messageListDivider"),f=require("./layoutShiftMonitor"),v=require("./darkMode"),h=require("./contentBlocker"),p=require("./imagePlaceholder"),y=require("./trace"),w=require("./feed"),S=require("./contentImage"),b=require("./importantContactBanner"),L=require("./lifecycle");function C(e){return T(e)||k(e)||x(e)||A()}function A(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function T(e){if(Array.isArray(e))return I(e)}function q(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=x(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw o}}}}function x(e,t){if(e){if("string"==typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}n.Commands.log("after import",n.LogLevel.info);var N,E,M,_,$={normal:0,search:1},D={none:"0",request:"1",recalling:"2",completed:"3",allSuccess:"4",allFail:"5",someFail:"6"},O={ready:"0",needDownload:"1",downloading:"2"},B={accept:"0",refuse:"1",pending:"2"},R=[],H=null,F={},P={},W=new Set,z=new Map,j=!1;function U(e){e&&(n.Commands.log("apply scale op ".concat(e)),window.applyScaleOps=window.applyScaleOps|e)}function V(){return E=E||new t.WebTimeLogHelper}function Q(){return M=M||new t.AvatarLogHelper}function J(){return _=_||new t.ImageDownloadLogHelper}function Y(e){for(var t=e.querySelectorAll(".banner-container"),a=0;a<t.length;a++){var n=t[a];new(MutationObserver||WebKitMutationObserver)(function(e){var t,a=q(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(n.target.classList.contains("banner")&&n.target.parentElement.classList.contains("banner-container"))X(n.target.parentElement)}}catch(r){a.e(r)}finally{a.f()}}).observe(n,{attributes:!0,childList:!0,subtree:!0})}}function X(e){for(var a=e.querySelectorAll(".banner, .send-banner, .priority-banner, .statistics-banner"),n=!1,r=0;r<a.length;r++){if(n=!getComputedStyle(a[r]).display.includes("none"))break}n?(0,t.showDomElement)(e):(0,t.hideDomElement)(e)}function G(){var e=[];if((0,t.isNull)(H))H=[],(0,t.$$)(".message-item.expand").forEach(function(a){(0,t.isInViewport)(a)?e.push(a):H.push(a.getAttribute("message-id"))});else if(H.length>0){e=[];var a=[];H.forEach(function(n){var r=(0,t.$)('.message-item.expand[message-id="'.concat(n,'"]'));(0,t.isInViewport)(r)?e.push(r):a.push(n)}),H=a}K(e)}function K(e){try{if(e&&e.length>0){var t=[];e.forEach(function(e){var a=e.getAttribute("message-id");n.Commands.log("handleMessagesFirstVisible ".concat(a," ").concat(window.t_id)),a&&(R.includes(a)||(R.push(a),t.push(a)),Z(e))}),t.length>0&&n.Commands.expandMessagesFirstVisible(t)}}catch(a){n.Commands.log("handleMessagesFirstVisible error:"+a,n.LogLevel.error)}}function Z(e){(e.querySelector(".calendar-loading")||e.querySelector(".card-event-detail"))&&n.Commands.calendarNeedUpdate(window.t_id,e.getAttribute("message-id"))}function ee(e){if(e){var t=e.querySelector(".recall_message_banner");if(t){var a=e.querySelector(".recallIcon"),n=t.getAttribute("recall_state");yt(t,a,n)}}}function te(){var e=(0,t.$)(".message-flag-button");e&&e.addEventListener("click",function(t){e.classList.contains("is-flagged")?e.classList.remove("is-flagged"):e.classList.add("is-flagged"),n.Commands.clickFlag(),t.stopPropagation()})}function ae(e){e.removeEventListener("touchstart",oe),e.removeEventListener("click",ie),e.addEventListener("touchstart",oe),e.addEventListener("click",ie);var t=e.querySelector(".item-content");t&&Ue(t);var a=e.querySelector(".item-header-container");a&&(fe(a),Je(a));var n=e.querySelector("#message-action-bar-container");n&&(0,w.addHandlerToMessageAction)(e,n);var r=e.querySelector(".show-follow-btn");r&&r.addEventListener("click",function(t){(0,w.handleFowllowClick)(t,e)})}window.applyScaleOps=a.ScaleOperation.none,window.userRevertedMessageIDs=[];var ne=!1,re=!0;function oe(e){ne&&!(0,t.isIOS)()?re=!1:(re=!0,Ee(e))}function ie(e){if(de(e)&&(n.Commands.log("messageItemClick prevent open hyperlink when click on image loading container"),e.preventDefault()),window.lastUserInputTime=Date.now(),!re)return n.Commands.log("messageItemClick blocked by scrolling"),void(re=!0);var t=Me(e);if(!t&&!((t=_e(e))||(t=$e(e))||(Ce(e),Ne(e),De(e),We(e),se(e),me(e),Oe(e),(0,w.handleMessageDraftClick)(e)||(0,b.handleImportantContactBannerClick)(e)||Be(e)||Pe(e)||ja&&ja.handleTranslateRecommendClick(e)||Ie(e)||ce(e)||l.SafetyBanner.handleSafatyBannerClick(e)||le(e))))if(c.InterceptBanner.handleShowInterceptedImageClick(e)){var a=e.target.closest(".message-item").getAttribute("message-id");(0,h.loadInterceptedImages)(a,!0)}else c.InterceptBanner.handleInterceptBannerClick(e)||d.ReadReceiptBanner.handleDontSendReceiptClick(e)||d.ReadReceiptBanner.handleSendReceiptClick(e)}function se(e){var t=e.target.closest("a");if(t&&t.closest(".message-content")){var a=t.closest(".message-item").getAttribute("message-id"),r=t.href;r&&a&&n.Commands.clickOnLink(a,r)}}function le(e){if(e.target&&(e.target.classList.contains("lk-redirect-btn")||e.target.matches(".lk-redirect-btn *"))){var t=e.target.closest(".lk-redirect-banner");if(t)return t.classList.contains("expand")?t.classList.remove("expand"):t.classList.add("expand"),!0}return!1}function ce(e){if(e.target&&(e.target.matches(".loading_container.show_error")||e.target.matches(".loading_container.show_error *"))){n.Commands.log("tap on error img");var a=e.target.closest(".loading_container.show_error");if(a){n.Commands.log("handleErrorImgRetry");var r=a.querySelector("img");return(0,t.checkEnableImageQueue)()?(0,S.addForceLoadingImage)(r,!0):Aa(r),!0}}return!1}function de(e){return e.target&&e.target.closest(".loading_container")}function me(e){window.lastUserInputTime=Date.now();var t=e.target,a=ue(t);if(null!=a&&a){var n=t.closest(".message-item");if(n)La(n.getAttribute("message-id"))}}function ue(e){var a;if((e=e).parentNode&&"true"==e.parentNode.getAttribute("larkmailquote")&&(e=e.parentNode),e&&"true"==e.getAttribute("larkmailquote")){var n="collapse"+(0,t.getQuoteClassPostfix)(e),r=e.closest(".quoteControlRoot"),o=e.closest(".message-item"),i=o.querySelector(".is_body_clipped");if(r){var s=window.scrollY;r.classList.contains(n)?(a=!0,r.classList.remove(n)):(a=!1,r.classList.add(n)),rn(o),s!=window.scrollY&&window.scrollTo(0,s)}return i&&(r.classList.contains(n)?i.style.display="none":i.style.display="flex"),a}}function ge(e){e.addEventListener("touchstart",function(e){Ee(e)}),e.addEventListener("click",function(e){var t=je(e);t||(t=_e(e))||(t=Se(e))})}function fe(e){for(var t=e.querySelectorAll(".address-list"),a=0;a<t.length;a++)for(var r=t[a].querySelectorAll(".address-item"),o=0;o<r.length;o++){var i=r[o];if(i.classList.contains("delegate-address-item"))if(!i.classList.contains("address-enable-click")){n.Commands.log("addHandlerToAddressLists unable to click",n.LogLevel.info);continue}i.addEventListener("click",function(e){ze(e)})}}function ve(e){var t=e.getAttribute("message-id");n.Commands.log("detect sendStatusBanner addEventListener in ".concat(t));for(var a=e.querySelectorAll(".send-status-bar"),r=0;r<a.length;r++){var o=a[r];o.removeEventListener("click",he),o.addEventListener("click",he)}}function he(e){n.Commands.log("handleSendStatusBannerClick",n.LogLevel.info);var t=e.target.closest(".message-item");if(t){var a=t.getAttribute("message-id");n.Commands.sendStatusClick(a)}}function pe(e){for(var t=e.querySelectorAll(".calender-action"),a=0;a<t.length;a++){t[a].addEventListener("click",function(e){ye(e),e.stopPropagation()})}var r=e.querySelectorAll(".card-event-detail");for(a=0;a<r.length;a++){r[a].addEventListener("click",function(e){var t=e.target.closest(".message-item");if(t){var a=t.getAttribute("message-id");n.Commands.showCalendarDetail(a),n.Commands.log("showCalendarDetail"+a,n.LogLevel.info)}})}}function ye(e){var t=e.target.closest(".calender-action");if(!t.classList.contains("active")){var a=t.closest(".message-item");if(a){var r=a.getAttribute("message-id"),o=t.getAttribute("data-action");switch(n.Commands.log("handleCalendarAction | "+o+" | "+r,n.LogLevel.info),o){case"accept":n.Commands.acceptCalendar(r,window.t_id);break;case"refuse":n.Commands.refuseCalendar(r,window.t_id);break;case"pending":n.Commands.pendingCalendar(r,window.t_id);break;case"accepted":case"refused":case"pended":n.Commands.updateCalendarAction(r,window.t_id,o)}}}}function we(e){var t=e.closest(".fold-draft-item");if(void 0!==t){var a=t.getAttribute("draft-id"),r=t.getAttribute("reply-message-id");n.Commands.clickDraft(a,r)}return!0}function Se(e){if(!e.target.closest(".fold-draft-item"))return!1;we(e.target)}window.updateCalendarBtnOld=function(e,a){var r=(0,t.findMessageItem)(e),o=String(a);if(r&&o){for(var i,s=r.querySelector(".action-card-actions"),l=s.querySelectorAll(".calender-action.active"),c=0;c<l.length;c++){l[c].classList.remove("active")}switch(o){case B.accept:i="accept";break;case B.refuse:i="refuse";break;case B.pending:i="pending";break;default:n.Commands.log("calendar state is wrong ".concat(e,", ").concat(a))}if(i){var d=s.querySelector('[data-action="'.concat(i,'"]'));d&&d.classList.add("active")}}},window.updateCalendarBtn=function(e,a){var r=(0,t.findMessageItem)(e),o=String(a);if(r&&o){var i;switch(o){case B.accept:i="accepted";break;case B.refuse:i="refused";break;case B.pending:i="pended";break;default:n.Commands.log("calendar state is wrong ".concat(e,", ").concat(a))}if(i){var s=r.querySelector(".action-card-rsvp");s&&s.setAttribute("data-action",i);var l=r.querySelector(".action-card-rsvp-done");l&&l.setAttribute("data-action",i)}}};var be={},Le={};function Ce(e){if(!(e.target.closest(".fold-draft-item")||e.target.closest(".recipients_container")||e.target.closest(".context-menu")||e.target.closest(".show-follow-btn"))){var a=e.target.closest(".message-item");if(a.classList.contains("expand")&&(a.classList.contains("stranger_card")||a.classList.contains("feed_card"))?e.target.classList.contains("item-header")||e.target.classList.contains("stranger-card-header")||e.target.classList.contains("feed-card-header")||e.target.classList.contains("stranger-card-hit-content")||e.target.classList.contains("feed-card-hit-content"):e.target.closest(".header-content")||e.target.classList.contains("item-header")){var r=a.getAttribute("message-id");Le[r]&&(Le[r].disconnect(),Le[r]=null),window.lastUserInputTime=Date.now();var o=a.querySelector(".attachment-tag"),i={x:e.clientX,y:e.clientY},s=o&&(0,t.pointInsideRect)(o.getBoundingClientRect(),i,{top:-4,right:-4,bottom:-4,left:-4});if(a.classList.contains("expand")){if((0,w.triggerNativeAvatarUpdate)(a,!0),(0,w.updateDraftHeaderDetail)(a),s)qe(a);else if("isforward"===window.isforward||!Ge(a)){a.classList.remove("expand"),a.classList.remove("half-expand");r=a.getAttribute("message-id");(0,w.doVisualMessageCheck)(document.querySelector(".message-list")),n.Commands.messageclick(r,!1,!1),Qe(a.querySelector(".message-attachments-wrapper.expand"))}}else Ae(a,s),(0,w.doVisualMessageCheck)(document.querySelector(".message-list"))}}}function Ae(e,a){var r=e.getAttribute("message-id");n.Commands.log("expandMessageItem ".concat(r));var o=(0,t.isNull)(e.querySelector(".item-content"));e.classList.add("expand"),n.Commands.messageclick(r,!0,o),(0,w.triggerNativeAvatarUpdate)(e,!1),(0,b.updateImportantContactBannerStyle)(e),o?(a&&e.classList.add("scrollToAttachment"),ke(e,r)):(Xa&&!en[r]&&rn(e),K([e]),a&&qe(e))}function ke(e,t){be[t]=Date.now();var a=new MutationObserver(function(){var r=e.querySelector(".item-content"),o=be[t];if(o){if(r&&e.classList.contains("expand")&&"none"!=getComputedStyle(r).display){var i=Date.now()-o;n.Commands.track("email_additemcontent_delay",{delay:i}),n.Commands.log("email_additemcontent_delay ".concat(i,"ms"),n.LogLevel.info),be[t]=null,Le[t]=null,a.disconnect(),Xa&&!en[t]&&rn(e),e.classList.contains("scrollToAttachment")&&(e.classList.remove("scrollToAttachment"),setTimeout(function(){qe(e)},0))}}else a.disconnect()});a.observe(e,{attributes:!0,childList:!0,characterData:!1,subtree:!0}),Le[t]=a}function Te(e,a,n){var r=(0,t.findMessageItem)(e);if(r){if(r.querySelector(".item-content"))return;var o=(0,t.convertToNodeFirstElementByStr)(a),i=r.querySelector(".message-draft-container");i?r.insertBefore(o,i):r.appendChild(o),tt(r,void 0,!1,!0),Ra(r,!1,!0),K([r]),n&&n(o)}}function qe(e){var t=e.querySelector(".item-footer-card.attachments");if(t){n.Commands.track("email_attachment_anchor_point_click"),Ve(e.querySelector(".message-attachments-wrapper"));xe(t,140,!0)}}function xe(e,a,r){if(e){a=(a||0)+(parseFloat((0,t.$)(".message-header").style.paddingTop)||0);var o=e.getBoundingClientRect(),i=o.top>a&&o.bottom>window.innerHeight,s=o.top<a,l=o.left<16,c=o.right>window.screen.width-16;if(!l&&!c||r)if(s||i){var d=o.top-a,m=parseInt(Math.min(window.pageYOffset+d,document.documentElement.scrollHeight-window.innerHeight));m=Math.max(0,m),n.Commands.log("scroll to targetY ".concat(m,", outOfBottom ").concat(i,", outOfTop ").concat(s,", rectTop ").concat(o.top,", topOffset ").concat(a),!0),n.Commands.scrollTo(m)}else n.Commands.log("dont scroll to targetY, outOfBottom ".concat(i,", outOfTop ").concat(s),!0);else{var u=(0,t.getChromeVer)();u&&u<=60?(e.scrollIntoViewIfNeeded(),n.Commands.log("scrollIntoViewIfNeeded outOfLeft ".concat(l,", outOfRight ").concat(c),!0)):(e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),n.Commands.log("scrollIntoView outOfLeft ".concat(l,", outOfRight ").concat(c),!0))}}}function Ie(e){var t=e.target;if(t.classList.contains("schedule-view-original-button")){var a=t.closest(".message-item").getAttribute("message-id");return n.Commands.track("mail_schedule_send_cancel_btn",{thread_id:window.t_id,message_id:a,banner_action:"accept"}),n.Commands.cancelScheduleSendClick(a),!0}return!1}function Ne(e){var a=e.target.closest(".context-menu");if(a){var r,o=e.target.closest(".message-item"),i=o.getAttribute("message-id"),s=o.querySelector(".translation-operation-bar"),l=(r=(0,t.shouldOptimizeAvatar)()?o.querySelector(".avatar-text"):o.querySelector(".avatar")).style.background,c=r.innerText;if(l&&c&&"none"!==r.style.display&&(l=l.substring(4,l.length-1).replace(/ /g,"").split(",").map(function(e){return parseFloat(e)})).length>=3)var d={rgb:l,initial:c};var m=!1;s&&(0,t.isNull)(s.querySelector(".showRecommend"))&&"none"!=getComputedStyle(s).display&&(m=!0);var u=(0,t.isPad)()?(0,t.getElementFrame)(a):void 0;tn(),n.Commands.contextMenuClick(window.t_id,i,m,d,u)}}function Ee(e){var t=e.target.closest(".recipients");return!!t&&(t.classList.add("touchstart"),!0)}function Me(e){var t=e.target,a=t.closest(".recipients"),r=t.closest(".message-item"),o="";if(r&&(o=r.getAttribute("message-id")),a){if(a.classList.remove("touchstart"),a.classList.contains("expand")){a.classList.remove("expand");var i=t.closest(".message-item").querySelector(".recipients-expand");return i&&i.classList.remove("show"),a.querySelector(".address-icon-fold").classList.remove("show"),a.querySelector(".address-icon-fold").classList.add("hide"),a.querySelector(".address-icon-unfold").classList.remove("hide"),a.querySelector(".address-icon-unfold").classList.add("show"),a.closest(".item-header").classList.remove("expand"),e.stopPropagation(),n.Commands.receiverClick(o,!1),!0}a.classList.add("expand");var s=t.closest(".message-item").querySelector(".recipients-expand");return s&&s.classList.add("show"),a.querySelector(".address-icon-fold").classList.remove("hide"),a.querySelector(".address-icon-fold").classList.add("show"),a.querySelector(".address-icon-unfold").classList.remove("show"),a.querySelector(".address-icon-unfold").classList.add("hide"),a.closest(".item-header").classList.add("expand"),e.stopPropagation(),n.Commands.receiverClick(o,!0),!0}return!1}function _e(e){var a=e.target,r=a.closest(".avatar"),o=a.closest(".message-draft-container");if(r&&!o){var i=r.getAttribute("user-id"),s=r.getAttribute("user-type")||"1",l=r.getAttribute("tenant-id")||"",c=r.getAttribute("user-address")||"",d=r.getAttribute("user-name");(void 0===i||null==i||"0"==i||i.length<1)&&(i=""),tn();var m=(0,t.isPad)()?(0,t.getElementFrame)(r):void 0;return n.Commands.avatarimageclick(i,c,d,s,l,m),!0}return!1}function $e(e){n.Commands.log("handle read more button",n.LogLevel.info);var t=e.target,a=t.closest(".message-item");if(t&&a){var r=t.getAttribute("data-action");r||((t=t.closest(".read_more_button"))?r=t.getAttribute("data-action"):n.Commands.log("handleReadMoreButton read_more_button target not found"));var o=a.getAttribute("message-id");switch(n.Commands.log("action:"+r+"|messageId:"+o,n.LogLevel.info),r){case"readmore":return n.Commands.readmoreMessage(o),!0}}else t||n.Commands.log("handleReadMoreButton target error",n.LogLevel.error),a||n.Commands.log("handleReadMoreButton messageItem error",n.LogLevel.error);return!1}function De(e){var t=e.target;if(t.closest(".attachment")){var a=t.closest(".attachment");if(a){var r=a.getAttribute("file-token"),o=a.getAttribute("file-url"),i=a.closest(".message-item").getAttribute("message-id");if(t.closest(".attachment-button"))a.getAttribute("attachment-state")==O.downloading?n.Commands.cancelAttachmentDownload(i,r):n.Commands.downloadAttachment(i,r);else tn(),n.Commands.openAttachment(i,r,o)}}}function Oe(e){e.target.closest(".swiper-slide")&&n.Commands.clickDocPreview()}function Be(e){var t=e.target,a=t.closest("a");if(!("img"!==t.tagName.toLowerCase()||t.closest(".swiper-slide")||a&&a.getAttribute("href"))){var r=t.getAttribute("src"),o=t.closest(".message-item"),i=o.getAttribute("message-id");if(0===t.src.indexOf("cid:")){for(var s={src:t.src.replace("cid:","")},l=o.querySelectorAll(".message-content img"),c=[],d=0,m=l.length;d<m;d++){var u=l[d];0===u.src.indexOf("cid:")&&c.push({src:u.src.replace("cid:","")})}return tn(),n.Commands.clickImage(s,c,i),!0}if(0===t.src.indexOf("http")){if(!Re(t))return tn(),n.Commands.clickImage({httpSrc:t.src},void 0,i),!0}else if(null!=r&&0===r.indexOf("file:")){tn();var g={localPath:t.src},f=[g];return n.Commands.clickImage(g,f,i),!0}}return!1}function Re(e){return"body"!=e.tagName.toLowerCase()&&("a"==e.tagName.toLowerCase()?e.href.length>0:Re(e.parentNode))}function He(){if(Vt!=Ut.none){var e=(0,t.$)(".message-cover"),a=e.querySelector(".subject-translation"),n=e.querySelector(".message-subject"),r=window.translatePopoverTitle,i="";return Vt==Ut.original?i=n.innerText:Vt==Ut.subjectDetail?(i=n.innerText,r=window.translatePopoverSubjectDetail):Vt==Ut.originalAndTranslated?(i=n.innerText+"\n"+a.innerText,r=window.translatePopoverSubjectDetail):Vt==Ut.translatedAndOriginal&&(i=a.innerText+"\n"+n.innerText,r=window.translatePopoverSubjectDetailAndOrigin),(Fe=new o.Popover(r)).showWithBody(i),!0}}window.addItemContent=function(e){var t=JSON.parse(e);if(t)for(var a in t){if(a)Te(a,t[a])}},window.togglePopover=function(e,t,a){var n=parseInt(e),r=window.translatePopoverTitle;a&&a.length>0&&(r=a),Fe=new o.Popover(r),!isNaN(n)&&n?t&&Fe.showWithBody(t):Fe.close()};var Fe=null;function Pe(e){var t,a,n=e.target;if(n.classList.contains("subject-translation")){var r=n.parentNode.querySelector(".message-subject");r&&(t=n,(a=r.cloneNode(!0)).style.color="")}else{var i=n.closest(".translated-message-content");if(i&&i.classList.contains("showPopover")){var s=n.closest('[data-translate-type="0"]')||n.querySelector('[data-translate-type="0"]');if(s){var l=i.closest(".message-item"),c=s.getAttribute("data-translate-id");a=l.querySelector('[data-translate-id="'.concat(c,'"]')),t=s,"a"==n.tagName.toLowerCase()&&null==n.closest(".selected-translation")&&e.preventDefault()}}}var d=n.classList.contains("subject-translation")&&n.parentNode.classList.contains("stranger-card-hit-content")&&"none"!=n.parentNode.querySelector(".message-subject").style.display;return!(!t||!a||d)&&((Fe=Fe||new o.Popover(window.translatePopoverTitle)).show(t,a),!0)}function We(e){var t=e.target;if(t.closest(".recall-message-detail")){var a=t.closest(".message-item");if(a){var r=a.getAttribute("message-id");n.Commands.recallDetail(r),n.Commands.track("email_mail_recall_result_banner_click",{click:"check_detail",target:"none"})}}}function ze(e){n.Commands.log("handleAddressList",n.LogLevel.info);var a=e.target.closest(".address-item");if(a){var r=a.getAttribute("user-id"),o=a.getAttribute("user-type")||"1",i=a.getAttribute("tenant-id")||"";(void 0===r||null==r||"0"==r||r.length<1)&&(r="");var s=a.querySelector(".address"),l=a.querySelector(".name");if(s){var c=(0,t.isPad)()?(0,t.getElementFrame)(a):void 0;n.Commands.addressclick(s.innerText,r,c,l.innerText,o,i)}else n.Commands.log("handleAddressList .address not found",n.LogLevel.info)}else n.Commands.log("handleAddressList .address-item not found",n.LogLevel.info)}function je(e){var t=e.target.closest(".draft-delete");if(t){var a=t.getAttribute("draft-id"),r=t.getAttribute("thread-id");return n.Commands.deleteDraft(a,r),e.stopPropagation(),!0}return!1}function Ue(e){if(e){var t=e.querySelector("._3+.attachments-show-more");t&&t.addEventListener("click",function(e){Ve(e.target.closest(".message-attachments-wrapper"))})}}function Ve(e){e&&(e.classList.add("expand"),ht(e.closest(".message-item")))}function Qe(e){e&&(e.classList.remove("expand"),ht(e.closest(".message-item")))}function Je(e){if(!(0,t.isNull)(e)){var a=e.querySelector(".translation-operation-bar");if(!(0,t.isNull)(a)){var r=e.closest(".message-item").getAttribute("message-id");if(!(0,t.isNull)(r)){var o=a.querySelector(".language-container");(0,t.isNull)(o)||o.addEventListener("click",function(e){e.target.closest(".showRecommend")||(n.Commands.log("addHandlerToTranslation translationLanguageButton",n.LogLevel.info),n.Commands.selectTranslationLanguageClick(r))});var i=a.querySelector(".translation-view-original-button");(0,t.isNull)(i)||i.addEventListener("click",function(){n.Commands.log("addHandlerToTranslation viewOriginalButton",n.LogLevel.info),n.Commands.viewOriginalClick(r)});var s=a.querySelector(".translation-view-translation-button");(0,t.isNull)(s)||s.addEventListener("click",function(){n.Commands.log("addHandlerToTranslation viewTranslationButton",n.LogLevel.info),n.Commands.viewTranslationClick(r)})}}}}function Ye(e){return!!e&&!(0,t.findSiblingElement)(e,".message-item",!0)}function Xe(e){return!!e&&!(0,t.findSiblingElement)(e,".message-item",!1)}function Ge(e){return!!e&&Ye(e)&&Xe(e)}function Ke(){return(0,t.$)(".message-item")}function Ze(){var e=Array.from((0,t.$$)(".message-item"));return e.length>0?e[e.length-1]:null}function et(e,a){var r=(0,t.isNull)(e.querySelector(".item-content"));e.classList.add("expand"),r&&a&&n.Commands.needContents([a],$.normal)}function tt(a,r,o,i){try{if(a.classList.contains("message-item")){(0,e.updateAvatar)(a,i),a.getAttribute("reply-message-id")?ge(a):ae(a);var s=a.querySelector(".item-header");da(s);var l=s.querySelector(".time");if(l){var c=l.innerText.trim();(0,t.shouldOptimizeLargeMail)()&&c===l.innerText||(l.innerText=c)}da(a.querySelector(".recipients-expand")),Y(a),ve(a),pe(a),ee(a);var d=a.querySelector(".original-message-content"),m=a.querySelector(".message-attachments-wrapper");n.Commands.log("from simple search, attachment node: "+m),at(d,m,r,o,i),Sa(a),ua(a),ht(a),(0,b.updateImportantContactBannerStyle)(a),a.classList.contains("expand")||(0,w.updateDraftHeaderDetail)(a)}}catch(u){n.Commands.log("initMessageNode error:"+u,n.LogLevel.info)}}function at(e,a,o,i,s){try{if(!o)o=document.querySelector(".message-list").children;if(e&&o){for(var l=0,c=0;c<o.length;c++){o[c].getAttribute("message-id")&&l++}var d=1!==l;if((0,r.renderContentAndQuoteForMessage)(e,d),(0,t.checkIsTrue)(window.darkModeFG)&&v.isDarkMode){var u=!(0,t.checkIsTrue)(window.isContentAlwaysLight);(0,v.handleContentDM)(e,u)}i||((0,m.handleHyperLink)(e),da(e),Wa(e,!1)),a&&void 0!==window.keyword&&window.keyword.length>0&&(hn(a,window.keyword),da(a)),ba(e),"true"===window.shouldInterceptImage&&(0,h.updateInterceptedImage)(e,s),fa(e)}}catch(g){n.Commands.log("initMessageContent error:"+g,n.LogLevel.info)}}function nt(e){var a=function(e){return null!=e},r=(0,t.$)(".message-title");if(r){var o=r.cloneNode(),i=(0,t.$)("#message-subject-container"),s=(0,t.$)(".message-external-item");if(a(r)){o.innerHTML=e;var l=o.firstChild;a(s)&&(a(l)?o.insertBefore(s,l):o.appendChild(s)),l=o.firstChild,a(i)&&(a(l)?o.insertBefore(i,l):o.appendChild(i))}r.parentNode.replaceChild(o,r);for(var c=(0,t.$$)(".message-label-item"),d=function(){var e=c[m];e.addEventListener("click",function(){n.Commands.clickLabel(e.innerText)})},m=0;m<c.length;m++)d();(0,t.modifyLabelsRTL)()}}function rt(e){var a=function(e){return null!=e},r=(0,t.$)(".message-labels-under-cover");if(r){var o=r.cloneNode(),i=(0,t.$)(".message-external-item");if(a(r)){o.innerHTML=e;var s=o.firstChild;a(i)&&(a(s)?o.insertBefore(i,s):o.appendChild(i))}r.parentNode.replaceChild(o,r);for(var l=(0,t.$$)(".message-label-item"),c=function(){var e=l[d];e.addEventListener("click",function(){n.Commands.clickLabel(e.innerText)})},d=0;d<l.length;d++)c();var m=(0,t.$)(".message-labels-under-cover");if(m){var u=m.querySelector(".message-label-item");m.style.display=u?"block":"none"}(0,t.modifyLabelsRTL)()}}window.updateMenuItem=function(e,a){var n=(0,t.findMessageItem)(e),r=(0,t.convertToNodeFirstElementByStr)(a),o=n.getElementsByClassName("menu");1==o.length&&o[0].replaceWith(r)},window.updateFlagged=function(e,a){var n=(0,t.$)(".message-flag-button");n&&((0,t.checkIsTrue)(a)?n.classList.add("is-hidden"):(n.classList.contains("is-hidden")&&n.classList.remove("is-hidden"),(0,t.checkIsTrue)(e)?n.classList.add("is-flagged"):n.classList.contains("is-flagged")&&n.classList.remove("is-flagged")))},window.updateDraft=function(a,r){for(var o=wt(a),i=0;i<o.length;i++)o[i].remove();var s,l=(0,t.findMessageItem)(a);l&&(s=l.closest(".message-list"));var c=(0,t.convertToNodeFirstElementByStr)(r);(0,e.updateAvatar)(c,!0),n.Commands.checkUserids((0,e.getAvatarUserids)()),n.Commands.log("updateDraft "+a+", "+window.isNewMessageAtTop),s&&(window.isNewMessageAtTop?s.insertBefore(c,l):s.insertBefore(c,l.nextElementSibling)),c.querySelector("a.show-hightlight").addEventListener("click",function(e){n.Commands.log("needShowHightLightItem click",n.LogLevel.info),je(e)||we(e.target)})},window.deleteDraft=function(e){try{var t=St(e);if(null==t)return void n.Commands.log("draftItem null",n.LogLevel.error);var a=t.closest(".message-list"),r=t.closest(".message-item");a.removeChild(r)}catch(o){n.Commands.log("deleteDraft error:"+o,n.LogLevel.error)}},window.deleteMessage=function(e){if(e){var a=(0,t.$)('[message-id="'.concat(e,'"]'));a&&a.parentNode.removeChild(a)}},window.updateMessage=function(a){try{n.Commands.log("updateMessage",n.LogLevel.info);var r=document.querySelector(".message-list");if(r){n.Commands.log("updateMessage run",n.LogLevel.info);var o=(0,t.convertToNodeFirstElementByStr)(a);window.isNewMessageAtTop?r.prepend(o):r.appendChild(o),tt(o,r.children),Ra(o),rn(o),n.Commands.checkUserids((0,e.getAvatarUserids)())}}catch(i){n.Commands.log("updateMessage error:"+i,n.LogLevel.info)}},window.updateMessageItems=function(a,r){var o="true"==r,i=null;try{n.Commands.log("updateMessage needRelocate:"+o,n.LogLevel.info);var s=(0,t.$)(".message-list");if(s){n.Commands.log("updateMessage run",n.LogLevel.info);var l=(0,t.convertToNodeByStr)(a),c=Array.from(l.querySelectorAll(".message-item[message-id]")),d=s.querySelectorAll(".message-item[message-id]"),m=Array.from(d).concat(c);m.sort(function(e,t){return(parseInt(e.getAttribute("timestamp"))||0)>=(parseInt(t.getAttribute("timestamp"))||0)?window.isNewMessageAtTop?-1:1:window.isNewMessageAtTop?1:-1});var u,g=Array.from(l.querySelectorAll(".message-item[reply-message-id]")),f=q(Array.from(s.querySelectorAll(".message-item[reply-message-id]")).concat(g));try{var v=function(){var e=u.value,t=e.getAttribute("reply-message-id");if(t){var a=m.findIndex(function(e){return e.getAttribute("message-id")===t});a>=0&&(window.isNewMessageAtTop?m.splice(a,0,e):m.splice(a+1,0,e))}};for(f.s();!(u=f.n()).done;)v()}catch(R){f.e(R)}finally{f.f()}var h=0;if(o){o=!1;for(var p=(0,t.getOutsideScreenHeight)(),y=0;y<d.length;y++){var S=d[y];if(!i){var b=S.offsetTop-s.offsetTop-document.documentElement.scrollTop,L=b+S.clientHeight;if(b>=0&&b<p||L>=0&&L<p){o=!0,i=S,h=S.offsetTop,n.Commands.log("updateMessageItems needRelocate beforeTop:"+h,n.LogLevel.info);break}}}}for(y=0;y<m.length;y++){var C=m[y],A=s.querySelectorAll(".message-item");if(y>=A.length)s.append(C);else{var k=C.getAttribute("message-id"),T=A[y];if(k){var x=T.getAttribute("message-id");x&&x!==k&&s.insertBefore(C,T)}else{var I=C.getAttribute("reply-message-id"),N=T.getAttribute("reply-message-id");I&&N&&N!==I&&s.insertBefore(C,T)}}}for(var E=0,M=c;E<M.length;E++){var _=M[E];if(tt(_,s.children,!1,!0),Ra(_,!1,!0),rn(_),_.classList.contains("expand")){var $=_.getAttribute("message-id");$&&H.push($)}}for(var D=0,O=g;D<O.length;D++){ge(O[D])}if(n.Commands.checkUserids((0,e.getAvatarUserids)()),o&&i){var B=i.offsetTop;n.Commands.log("updateMessageItems needRelocate afterTop:"+B,n.LogLevel.info),document.documentElement.scrollTop=document.documentElement.scrollTop+(B-h)}else G();setTimeout(function(){var e=document.querySelector(".message-list");(0,w.doVisualMessageCheck)(e)},0)}}catch(F){n.Commands.log("updateMessage error:"+F,n.LogLevel.info)}},window.replaceAllAddressNames=function(e){try{var t,a=JSON.parse(e),r=a.addressPatches,o=a.keyFrom,i=a.keyTo,s=a.keyCc,l=a.keyBcc,c=q(r);try{for(c.s();!(t=c.n()).done;){var d=t.value,m=d.msgId;if(m){var u=d.headerFrom,g=d.headerTo,f=d.addressFrom,v=d.addressTo,h=d.addressCc,p=d.addressBcc,y=d.atUserName;u&&ya(m,u),g&&wa(m,g),f&&o&&pa(m,f,o),v&&i&&pa(m,v,i),h&&s&&pa(m,h,s),p&&l&&pa(m,p,l),y&&ha(m,y)}}}catch(w){c.e(w)}finally{c.f()}}catch(S){n.Commands.log("replaceAllAddressNames error:"+S,n.LogLevel.error,!0)}},window.replaceAtName=function(e,t){try{ha(e,JSON.parse(t))}catch(a){n.Commands.log("replaceAtName error:"+a,n.LogLevel.error,!0)}},window.replaceAddressName=function(e,t,a){try{pa(e,JSON.parse(t),a)}catch(r){n.Commands.log("replaceAddressName error:"+r,n.LogLevel.error,!0)}},window.replaceHeaderFrom=function(e,t){ya(e,t)},window.replaceHeaderTo=function(e,t){wa(e,t)},window.updateReplyTagType=function(e,a){try{var r=(0,t.findMessageItem)(e);if(r){var o=r.querySelector(".header-content");if(o){var i=o.querySelector(".from");if(i){var s=i.querySelector(".reply-tag");s&&s.setAttribute("type",a)}}}}catch(l){n.Commands.log("updateReplyTagType error:"+l,n.LogLevel.error,!0)}},window.updateCalendarCard=function(e,a){try{n.Commands.log("updateCalendar "+e,n.LogLevel.info,!0);var r=(0,t.findMessageItem)(e);if(r){var o=r.querySelector(".item-content");if(o){var i=o.querySelector(".calendar-container")||o.querySelector(".calendar-loading");if(i){var s=(0,t.convertToNodeByStr)(a);o.replaceChild(s,i),pe(s)}else n.Commands.log("updateCalendar no container "+e,n.LogLevel.info,!0)}else n.Commands.log("updateCalendar no itemContent "+e,n.LogLevel.info,!0)}else n.Commands.log("updateCalendar no messageNode "+e,n.LogLevel.info,!0)}catch(l){n.Commands.log("updateCalendar error:"+l,n.LogLevel.error,!0)}},window.updateAttachmentWarning=function(e){try{var a=JSON.parse(e),r=(0,t.$)(".message-list");if(r){var o,i=q(a);try{for(i.s();!(o=i.n()).done;){var s=o.value,l=s.fileToken,c=s.warningType,d=s.warningTip;n.Commands.log("updateAttachmentWarning",n.LogLevel.info,!0);var m,u=q(r.querySelectorAll(".attachment[file-token='".concat(l,"'] .attachment-info")));try{for(u.s();!(m=u.n()).done;){var g=m.value;g.setAttribute("show-warning",c),g.querySelector(".attachment-warning-tip").innerText=d}}catch(f){u.e(f)}finally{u.f()}}}catch(f){i.e(f)}finally{i.f()}}}catch(v){n.Commands.log("updateAttachmentWarning error:"+v,n.LogLevel.error,!0)}},window.updateAttachmentStatus=function(e){try{var a=JSON.parse(e),r=(0,t.$)(".message-list");if(r){var o,i=q(a);try{for(i.s();!(o=i.n()).done;){var s=o.value,l=s.fileToken,c=s.statusType,d=s.statusText;n.Commands.log("updateAttachmentStatus",n.LogLevel.info,!0);var m,u=q(r.querySelectorAll(".attachment.attach_size_2[file-token='".concat(l,"'] .attachment-sub-info")));try{for(u.s();!(m=u.n()).done;){var g=m.value;g.setAttribute("attachment-status",c),g.querySelector(".attachment-status-text").innerText=d}}catch(f){u.e(f)}finally{u.f()}}}catch(f){i.e(f)}finally{i.f()}}}catch(v){n.Commands.log("updateAttachmentStatus error:"+v,n.LogLevel.error,!0)}},window.updateAttachmentState=function(e,a,r,o,i){try{var s=(0,t.findMessageItem)(e);o=parseFloat(o),i=parseFloat(i);if(s){var l=s.querySelector(".message-attachments .attachment[file-token='".concat(a,"']")),c=String(r);if(l&&null!=c){var d=l.querySelector(".attachment-type-received");switch(c){case O.ready:l.setAttribute("attachment-state",O.ready);break;case O.needDownload:l.setAttribute("attachment-state",O.needDownload);break;case O.downloading:l.setAttribute("attachment-state",O.downloading);var m=l.querySelector(".attachment-type-size.dim-text"),u=parseFloat(m.innerText),g=0==i?0:o/i;g=Math.min(Math.max(0,g),1);var f=l.querySelector(".progress-bar .active"),v=parseFloat(f.style.width);if(isNaN(v)||100*g>=v){n.Commands.log("attach percentage from ".concat(v," to ").concat(100*g)),f.style.width="".concat(100*g,"%");var h=Math.ceil(g*u*100)/100;h=Math.min(h,u);var p=m.innerText.replace("".concat(u),"".concat(h))+"&nbsp;/&nbsp;";d.innerHTML=p}else n.Commands.log("error update percentage from ".concat(v," to ").concat(100*g))}}}}catch(y){n.Commands.log("updateAttachmentState error:"+y,n.LogLevel.info)}},window.removeMessage=function(e,a){try{n.Commands.log("RemoveMessage ".concat(e,", expandNext ").concat(a));var r=(0,t.findMessageItem)(e);if(r&&r.parentElement)if(window.isNewMessageAtTop?Ye(r):Xe(r)){n.Commands.log("RemoveMessage newest");var o=(0,t.findSiblingElement)(r,".message-item",window.isNewMessageAtTop);r.parentElement.removeChild(r),o&&et(o,o.getAttribute("message-id"))}else if(a){n.Commands.log("RemoveMessage expandNext");var i=(0,t.findSiblingElement)(r,".message-item",window.isNewMessageAtTop);r.parentElement.removeChild(r);var s=i;s||(s=window.isNewMessageAtTop?Ke():Ze()),s&&!s.classList.contains("expand")&&et(s,s.getAttribute("message-id"))}else n.Commands.log("RemoveMessage just delete"),r.parentElement.removeChild(r)}catch(l){n.Commands.log("removeMessage error:"+l,n.LogLevel.info,!0)}},window.updateLabels=function(e){nt(e),rt(e)},window.updateDocsColor=function(e){(0,t.$$)(".message-content").forEach(function(t){for(var a=t.querySelectorAll("a"),n=Array.from(a).filter(function(e){return Array.from(e.classList).some(function(e){return e.startsWith("lark-doclink-href")})}),r=0;r<n.length;r++){var o=n[r],i=o.getAttribute("href");i&&e.includes(i)&&o.classList.add("no-perm")}})};var ot=[];function it(e){if(e){var t=Math.min(e.clientWidth||document.body.clientWidth-32,450)/(343/257),a=parseFloat(e.style.height);t>0&&(!a||a!=t)&&document.querySelectorAll(".swiper-container").forEach(function(e){e.style.height="".concat(t,"px")})}}function st(e,n){if(e){e.classList.add(dt),n&&(e.classList.add(mt),e.classList.add(n));var r=e.closest(".mTableArea.hasFixed");if(r&&r.childNodes.length>0){var o=r.childNodes[0].getAttribute("lark-scale");o&&(0,t.isNumeric)(o)&&(0,a.updateScaledTableHeight)(r,o)}}}function lt(e,t){for(var a=e.querySelectorAll("a"),n=0;n<a.length;n++){for(var r=a[n],o=r.getAttribute("href"),i=!1,s=0;s<t.length;s++){var l=t[s];if(o==l.url&&r.innerText.trim().length>0&&!r.classList.contains(ut))if(i=!0,st(r,ct[l.type]),o.trim()==r.innerText.trim()){r.innerText=l.name;break}}i||r.classList.contains(mt)||r.classList.remove(dt)}}window.updateDocsItem=function(e){var n=JSON.parse(e),r=[];for(var o in n){var i=n[o];if(!(i.length<1))for(var s=(0,t.$$)("section[message-id]"),l=0;l<s.length;l++){var c=s[l];if(c.getAttribute("message-id")==o){r.push(c),ot.includes(o)||ot.push(o);var d="swipe"+ot.indexOf(o);c.querySelectorAll(".message-content").forEach(function(e){lt(e,i)});var m=c.querySelector(".item-content"),u=m.querySelector(".content-footer-card");if(null==m.querySelector(".swiper-container#".concat(d))){pn(u);var g=gt(i,d);u.insertBefore(g,u.firstChild);var f=c,v=!1;if(f.className.indexOf(" expand")<0&&(f.className+=" expand",v=!0),new Swiper({el:"#"+d,initialSlide:0,spaceBetween:5,slidesPerView:1,scrollbar:{el:"#"+d+" .swiper-scrollbar"},loop:!1,pagination:{el:"#"+d+" .swiper-pagination"},lazy:{enabled:!0,loadPrevNext:!0,loadOnTransitionStart:!0}}),v){var h=f.className.replace(" expand"," ");f.className=h}}}}}(0,a.shouldOptimizeScalePerformance)()&&r.length>0&&xt(C(new Set(r)))};var ct=["lk-unknown","lk-doc","lk-sheet","lk-bitable","lk-mindnote","lk-file","lk-slide","lk-wiki","lk-docx"],dt="lk-docs-icon",mt="lk-docs-icon-typed",ut="not-doclink";function gt(e,a){for(var n='<div class="swiper-container swiper-container-initialized swiper-container-horizontal item-footer-card" id="'+a+'"><div class="swiper-wrapper">',r=new Set,o=0;o<e.length;o++){null!=(i=e[o]).key&&r.has(i.key)||(r.add(i.key),n=(n=(n=(n=(n+='\n      <div class="swiper-slide" onclick="window.location=\''.concat(i.url,'\'">\n        <div class="swiper-docs-container">\n          <div class="swiper-docs-top $icon_type$">\n            <span class="swiper-docs-title">$name$</span>\n          </div>\n          <div class="swiper-docs-preview">\n            <img class="swiper-lazy" data-src="$abstract$"/>\n          </div>\n          <div class="swiper-docs-owner">\n            ').concat(window.ownerwording,"$ownerName$\n          </div>\n        </div>\n      </div>\n    ")).replace("$icon_type$",ct[i.type])).replace("$name$",i.name)).replace("$abstract$",i.abstract)).replace("$ownerName$",i.ownerName))}n+="</div>",n+='<div class="swiper-pagination swiper-pagination-bullets">';for(o=0;o<e.length;o++){var i=e[o];n+='<span class="swiper-pagination-bullet"></span>'}n+="</div>",n+="</div>";var s=(0,t.convertToNodeFirstElementByStr)(n);return new(MutationObserver||WebKitMutationObserver)(function(){it(s)}).observe(s,{attributes:!0,childList:!1,subtree:!0}),s}function ft(e){It(null,null),e&&e.forEach(function(e){La(e)})}window.updateUserid=function(a){try{for(var r=JSON.parse(a),o=(0,t.$$)("div.avatar"),i=0;i<o.length;i++){var s=o[i],l=s.getAttribute("user-id"),c=s.getAttribute("user-type");if(!(void 0===l||null==l||"0"==l||l.length<1||c==e.UserType.group||c==e.UserType.enterpriseMailGroup)&&r.userid==l){var d=s.getElementsByTagName("img");if(void 0===d||d.length<1){var m=r.avatarurl;void 0===m||null==m||m.length<1?(0,e.updateAvatar)(s.parentNode,!1,!0):(Q().onAvatarLoad(t.AvatarType.IMG,0),s.innerHTML='<img src="'+r.avatarurl+'" height="40" width="40" />')}}}}catch(u){n.Commands.log("updateUserid error:"+u,n.LogLevel.info)}},window.unfoldallmessage=function(){for(var e=(0,t.$$)("div.message-list section.message-item"),a=0;a<e.length;a++){e[a].classList.add("expand")}},window.foldallmessage=function(){for(var e=(0,t.$$)("div.message-list section.message-item"),a=0;a<e.length;a++){e[a].classList.remove("expand")}},window.updateRecallState=function(e,a,n){if(e){var r=(0,t.$)('[message-id="'.concat(e,'"]'));if(r)yt(r.querySelector(".recall_message_banner"),r.querySelector("#recall-tag"),a,n)}},window.updateSendState=function(e,a){if(e){var n=(0,t.$)('[message-id="'.concat(e,'"]'));if(n){var r=n.querySelector(".send-status-bar");if(r){var o=(0,t.convertToNodeFirstElementByStr)(a);r.style.display="flex",r.innerHTML=o.innerHTML}}}},window.hideSendStatus=function(e){if(e){var a=(0,t.$)('[message-id="'.concat(e,'"]'));if(a){var n=a.querySelector(".send-status-bar");n&&(n.style.display="none")}}},window.onresize=function(){try{var e=[];(0,t.$$)(".message-item").forEach(function(t){ht(t),(0,b.updateImportantContactBannerStyle)(t);var a=t.getAttribute("message-id");a&&e.push(a)}),(0,a.rescaleOnResize)()&&ft(e)}catch(r){n.Commands.log("onresize error:"+r,n.LogLevel.error)}},window.userRevertScale=function(e){if(e){window.userRevertedMessageIDs.push(e);var t={};It(e,t),n.Commands.track("email_revert_scale_click_dev",t)}};var vt=3;function ht(e){try{if(e.querySelector(".top-attachment-wrapper"))return;var t=e.querySelector(".message-attachments-wrapper");if(t){var a=document.body.clientWidth-32,r=Math.floor((a+8)/233),o=t.querySelectorAll(".attachment-item-wrapper"),i=Math.min(o.length,r);if(i>0){var s=a-8*(i-1),l=Math.floor(s/i);i>1&&(l-=4),l=Math.min(358,l);for(var c=0;c<o.length;c++){var d=o[c];d.style.width="".concat(l,"px"),d.style.marginRight=(c+1)%i!=0?"8px":""}}vt=i>1?2:3,console.log("attRow ".concat(i,", hideMoreRow ").concat(vt)),pt(t,i)}}catch(m){n.Commands.log("adjustAttachmentCardWidth error:"+m,n.LogLevel.info)}}function pt(e,t){if(e){var a=e.querySelectorAll(".attachment-item-wrapper"),n=e.classList.contains("expand");if(t)var r=Math.max(t*vt-1,1);for(var o=r&&a.length>r+1,i=0;i<a.length;i++){var s=o&&!n&&r&&i>r;a[i].style.display=s?"none":"flex"}var l=e.querySelector(".attachments-show-more");l&&(l.style.display=o&&!n?"flex":"none")}}function yt(e,a,r,o){var i=String(r);if(n.Commands.log("UpdateRecall: state ".concat(r)),e&&null!=i){var s=e.getAttribute("recall_state");e.setAttribute("recall_state",i);var l="none",c="none",d="none",m="",u=e.querySelector("#recall-icon"),g=e.querySelector(".recall-message-detail"),f=getComputedStyle(g).height;switch(f&&(u.style.height=f),i){case D.none:e.style.display="none",l="none",c="none",d="none",m=0==m.length?"unknown":m;break;case D.request:e.style.display="flex",l="flex",c="inline-block",d="none",e.querySelector(".storybook-spinner").style.display="flex",g.style.display="none",u.style.display="none";break;case D.recalling:e.style.display="flex",l="flex",c="inline-block",d="none",e.querySelector(".storybook-spinner").style.display="flex",g.style.display="inline-block",u.style.display="none";break;case D.allFail:m=0==m.length?"all_failed":m;case D.allSuccess:m=0==m.length?"all_success":m;case D.someFail:m=0==m.length?"partial_success":m;case D.completed:e.style.display="flex",l="flex",c="none",d="inline-block",e.querySelector(".storybook-spinner").style.display="none",g.style.display="inline-block",u.style.display="block"}!(0,t.isNull)(s)&&(i!=s||!e.hasInitLog&&i!=D.none)&&m.length>0&&(n.Commands.track("email_mail_recall_result_banner_view",{result:m}),e.hasInitLog=!0),a&&(a.style.display=l);var v=e.querySelector("#recalling-banner");v?(v.style.display=c,o&&"none"!=c&&(v.innerText=o)):n.Commands.log("Updating recall state UI recalling-banner not found ",n.LogLevel.info);var h=e.querySelector("#completed-banner");h?(h.style.display=d,o&&"none"!=d&&(h.innerText=o)):n.Commands.log("Updating recall state UI completed-banner not found ",n.LogLevel.info)}}function wt(e){for(var t=new Array,a=document.getElementsByClassName("message-item"),n=0;n<a.length;n++){var r=a[n];e===r.getAttribute("reply-message-id")&&t.push(r)}return t}function St(e){for(var t=document.getElementsByClassName("fold-draft-item"),a=0;a<t.length;a++){var n=t[a];if(e==n.getAttribute("draft-id"))return n}}for(var bt=(0,t.$$)("message-header-container .message-label-item"),Lt=function(){var e=bt[Ct];e.addEventListener("click",function(){n.Commands.clickLabel(e.innerText)})},Ct=0;Ct<bt.length;Ct++)Lt();(0,t.modifyLabelsRTL)();for(var At,kt=(0,t.$$)(".show-hightlight"),Tt=0;Tt<kt.length;Tt++){var qt=kt[Tt];qt.addEventListener("click",function(){n.Commands.log("needShowHightLightItem click",n.LogLevel.info)})}function xt(e){window.checkContentBefore&&window.checkContentBefore();var r=Array.from(e).filter(function(e){var t=e.getAttribute("message-id");return!t||!window.userRevertedMessageIDs.includes(t)});if(0!==r.length){var o={},i=Date.now();if((0,a.shouldOptimizeScale)()&&r)(0,a.setNeedsScale)(r);else{Et(),o.hardcodeCost=Date.now()-i,i=Date.now();var s=(0,t.$)("table img");s&&$t(),o.hasTableImg=s?1:0;for(var l=document.getElementsByTagName("table"),c=0;c<=l.length-1;c++)l[c].style.maxWidth="none";o.fixTableCost=Date.now()-i,o.hasTable=l.length>0?1:0}if(o.applyScaleOps=window.applyScaleOps,setTimeout(function(){n.Commands.fixScaleFinish()},1),!At&&window.pageStartLoadTime&&(At=Date.now()-window.pageStartLoadTime,o.firstScaleTime=At,y.Trace.arriveTo(y.Index.first_scale_end)),o.optimizeFeat=(0,a.scaleOptimizeFeat)(),o.scaleCost=Date.now()-i,n.Commands.track("email_read_fix_scale_dev",o),window.checkContentAfter){var d=window.checkContentAfter();n.Commands.track("template_check_content_layout_dev",d)}(0,u.listenAllNodeScroll)(),jt||Ht()}}function It(e,t){Nt(e,t),(0,a.revertNodeStyles)(e,t),(0,a.removeAutoTableTD)(e,t),(0,a.removeScaleBreakWord)(e,t),window.applyScaleOps=a.ScaleOperation.none}function Nt(e,n){for(var r,o=e?(0,t.findMessageItem)(e):null,i=0,s=(r=o?o.querySelectorAll(".mTableArea.".concat(_t)):(0,t.$$)(".mTableArea.".concat(_t))).length;i<s;i++)r[i].classList.remove(_t);(0,a.shouldOptimizeScale)()&&(0,a.removeTableWrapperIfNeed)(e,n)}function Et(){var e=(0,t.getContentPageWidth)();(0,t.$$)(".message-content").forEach(function(t){t.querySelectorAll("*[style]").forEach(function(t){if(t.style.width||t.style.minWidth){var n=parseInt(t.style.width),r=parseInt(t.style.minWidth),o=!isNaN(n)&&n>e,i=!isNaN(r)&&r>e,s=t.closest("div[id^=large-file-area]"),l=t.closest(".mTableArea"),c=parseInt(t.clientHeight);if((o||i)&&!s&&(!l||c>0&&c<=1)){var d;if(o&&U(a.ScaleOperation.fixHardCodeWidth),i&&U(a.ScaleOperation.fixHardCodeMinWidth),t.classList.contains("loading_container")){var m=getComputedStyle(t),u=parseFloat(m.height);u>0&&(d=parseFloat(m.width)/u)}if((0,a.rescaleOnResize)())(0,a.setHardCodeStyle)(t,o,i,d);else if(o&&(t.style.maxWidth=t.style.width),i&&(t.style.maxWidth=t.style.minWidth,t.style.minWidth=""),t.style.width="100%",d){var g=getComputedStyle(t),f=parseFloat(g.width)/d;(0,a.setRevertableStyle)(t,"height","".concat(f,"px"))}else t.style.height="auto"}}t.style.height&&t.scrollHeight>t.clientHeight&&"scroll"!==getComputedStyle(t).overflowY&&(U(a.ScaleOperation.fixHardCodeScrollHeight),(0,a.rescaleOnResize)()?(0,a.setRevertableStyle)(t,"height","auto"):t.style.height="auto")})})}var Mt=0,_t="hasFixed";function $t(){for(var e=(0,t.$$)(".mTableArea"),r=0,o=e.length;r<o;r++){var i=e[r];if(!i.matches(".mTableArea .mTableArea")){var s=getComputedStyle(i);if(i.closest(".message-item").classList.contains("expand")&&!i.classList.contains(_t)&&(null!=i.offsetParent||"fixed"===s.position)&&"none"!==s.display){var l="TABLE"==i.firstChild.tagName,c=i.querySelector("table"),d=c.scrollWidth,m=c.querySelectorAll("tr"),u=i.clientWidth/d;if(0==i.clientWidth&&Mt<4){var g=100;return 4===(Mt+=1)&&(g=2e3,n.Commands.track("email_message_table_scale_delay")),void setTimeout(function(){$t()},g)}var f=0;if(!l){(f=i.clientHeight-c.clientHeight)>30&&(f=30)}var v=u<1;if(v&&null!=m&&m.length>0){var h=Array.from(m[0].querySelectorAll("td")).filter(function(e){return e.parentNode===m[0]});null!=h&&h.length>4&&(v=!1)}if(v)if(U(a.ScaleOperation.fixTableScale),(0,a.rescaleOnResize)())(0,a.setTableScale)(c,i,u);else{for(var p=c.querySelectorAll("td"),y=0,w=p.length;y<w;y++){var S=p[y],b=parseFloat(S.style.fontSize);if(b){var L=S.style.fontSize.replace("".concat(b),"".concat(b/u));S.style.setProperty("font-size",L,"important");var C=parseFloat(S.style.lineHeight);if(C){var A=S.style.lineHeight.replace("".concat(C),"".concat(C/u));S.style.setProperty("line-height",A,"important")}S.querySelectorAll("*").forEach(function(e){e.style.lineHeight="",e.style.fontSize=""}),S.style.height&&(S.style.minHeight=S.style.height,S.style.height="");var k=S.closest("tr");k.style.height&&(k.style.minHeight=k.style.height,k.style.height="")}}var T=100*(1-u)/(2*u);c.style.webkitTransform="scale("+u+") translate(-"+T+"%,-"+T+"%)",c.style.marginLeft="0",c.style.marginRight="0",c.style.borderCollapse="separate",c.style.borderSpacing="0";for(var q=c.scrollHeight*u+(0,t.getBorderHeight)(c),x=i.children,I=0;I<x.length;I++)x[I]!==c&&(q+=x[I].scrollHeight+(0,t.getBorderHeight)(c));i.style.cssText=q>0?"height:"+(q+f)+"px !important;overflow:visible;":"overflow:visible;"}i.classList.add(_t)}}}}"loading"!=document.readyState?(n.Commands.log("document.readyState != 'loading'",n.LogLevel.info),Bt()):window.addEventListener("DOMContentLoaded",function(){y.Trace.arriveTo(y.Index.dom_content_loaded),L.Lifecycle.onDomContentLoaded(),(0,t.checkEnableImageQueue)()||Ha(document),V().startDelay(),setTimeout(function(){n.Commands.log("DOMContentLoaded",n.LogLevel.info),Bt()},1)}),window.onWebViewDisappear=function(){try{V().reportWebTime()}catch(e){n.Commands.log("reportWebTime ".concat(e))}(0,f.reportCLSScore)(t.domReadyTime.value)};try{PerformanceObserver&&new PerformanceObserver(function(e){if(e&&e.getEntries()){var t,a=q(e.getEntries());try{for(a.s();!(t=a.n()).done;){"first-contentful-paint"===t.value.name&&(0,f.oberverAllNodes)()}}catch(n){a.e(n)}finally{a.f()}}}).observe({type:"paint",buffered:!0})}catch(yn){n.Commands.log("PerformanceObserver not available:"+yn,n.LogLevel.error)}function Dt(){var e;y.Trace.arriveTo(y.Index.init_start),V().startInit(),(0,t.shouldOptimizeLargeMail)()&&setTimeout(function(){(0,n.notifyContentRendered)()},5e3),n.Commands.log("document.readyState:"+document.readyState,n.LogLevel.info);try{Ft(),(0,t.checkIsTrue)(window.darkModeFG)&&(0,v.observeDarkMode)(),e=Jt()}catch(yn){n.Commands.log("init error"+yn,n.LogLevel.error)}return y.Trace.arriveTo(y.Index.init_ui_end),L.Lifecycle.onInitUIEnd(),e}function Ot(e){ra(),Ba&&(j?requestAnimationFrame(function(){xt(e)}):xt(e)),(0,t.shouldOptimizeLargeMail)()?Kt():Gt();var a=e?e.length:0;V().endInit(a),Rt(),requestAnimationFrame(function(){y.Trace.arriveTo(y.Index.first_content_rendered),setTimeout(function(){L.Lifecycle.onFirstContentRendered(),n.Commands.log(">>>>  render end  >>>>, metrics: ".concat(JSON.stringify(y.Trace.getMetrics())),!0),(0,t.shouldOptimizeLargeMail)()&&(Zt(),(0,n.notifyContentRendered)())},0)})}function Bt(){var e=Dt();(0,t.checkEnableImageQueue)()?setTimeout(function(){Ot(e)}):Ot(e)}function Rt(){y.Trace.arriveTo(y.Index.init_end),t.domReadyTime?L.Lifecycle.onInitEnd():setTimeout(function(){L.Lifecycle.onInitEnd()},0)}function Ht(){if(window.initAnchorPoint.length>1&&!window.initAnchorPoint.includes("init_anchor_point")){var e=window.initAnchorPoint.replace("#",""),t=document.querySelector("[name=".concat(e,"]"));if(t)try{t.scrollIntoView({block:"nearest"})}catch(a){n.Commands.log("Failed to call scrollIntoView function")}else window.location.hash=window.initAnchorPoint;return!0}return!1}function Ft(){var e=!!(0,t.$)(".stranger_card"),a=!!(0,t.$)(".feed_card"),r=e||a?parseInt((0,t.$)(".body-content").style.marginTop):parseInt((0,t.$)(".message-header").style.paddingTop),o=e||a?-14:32;if(!Ht()&&"true"==window.enableLocateToExpand){for(var i=document.querySelectorAll(".message-item"),s=-1,l=0;l<i.length;l++){var c=i[l];if(c.classList.contains("locate")){s=l;break}c.classList.contains("expand")&&s<0&&(s=l)}if(n.Commands.log("initPosition choose index ".concat(s),n.LogLevel.info),s>0&&s<i.length){var d=i[s],m=r||0;N=d.offsetTop-m-o,document.body.scrollTop=N,document.documentElement.scrollTop=N,n.Commands.log("initPosition ".concat(document.documentElement.scrollTop),!0)}}(0,t.$)("div.message-cover")&&(Pt(),mn())}function Pt(){var e=(0,t.$)("div.message-cover");if(e){var a=(0,t.getOutsideScreenHeight)(),n=parseFloat(getComputedStyle(e).paddingTop)||0;e.style.minHeight="".concat(.16*a-2*n,"px"),Wt()}var r=(0,t.$)(".message-labels-under-cover");if(r){var o=r.querySelector(".message-label-item");r.style.display=o?"block":"none"}var i=(0,t.$)("#message-subject-container");i&&(i.offsetHeight>22?(0,t.removeClass)(e,"center"):(0,t.addClass)(e,"center"))}function Wt(){var e=(0,t.$)("div.message-cover");if(e){var a=parseFloat(getComputedStyle(e).paddingTop)||0;Qt(.3*(0,t.getOutsideScreenHeight)()-2*a)}}window.scrollToBottomMessage=function(){var e=document.querySelector(".message-list");if(e){var a=e.querySelectorAll(".message-item[message-id]");if(a&&a.length>0){var n=a[a.length-1],r=!!(0,t.$)(".stranger_card"),o=!!(0,t.$)(".feed_card"),i=r||o?-14:32,s=(r||o?parseInt((0,t.$)(".body-content").style.marginTop):parseInt((0,t.$)(".message-header").style.paddingTop))||0;N=n.offsetTop-s-i,document.body.scrollTop=N,document.documentElement.scrollTop=N}}};var zt,jt,Ut={none:0,original:1,originalAndTranslated:2,translatedAndOriginal:3,subjectDetail:4},Vt=Ut.none;function Qt(e){var a=(0,t.$)("div.message-cover"),n=(0,t.$)(".message-cover-title .message-subject"),r=(0,t.$)(".message-cover-title .subject-translation");if(a&&n){var o="none"==getComputedStyle(n).display,i=!0;o||(n.style.webkitLineClamp="initial");var s=0;r&&(n.style.webkitLineClamp="initial",i="none"==getComputedStyle(r).display,s=r.getBoundingClientRect().height||0),Vt=Ut.none;var l=parseFloat(getComputedStyle(n).lineHeight),c=parseInt(e/l),d=n.getBoundingClientRect().height||0;if(d>0&&d<1.5*l||0==d&&s>0&&s<1.5*l?(n.style.textAlign="center",r&&(r.style.textAlign="center")):(n.style.textAlign="initial",r&&(r.style.textAlign="initial")),o){if(!i){var m=r.getBoundingClientRect().height||0;Vt=m>e?Ut.translatedAndOriginal:Ut.original,r.style.display="-webkit-box",r.style.webkitLineClamp="".concat(c)}}else if(i)n.style.display="-webkit-box",n.style.webkitLineClamp="".concat(c),d>e&&(Vt=Ut.subjectDetail);else{var u=r.getBoundingClientRect().height||0;if(d+u>e){var g=Math.round(c*u/(d+u)),f=c-g;n.style.display="-webkit-box",n.style.webkitLineClamp="".concat(f),r&&(r.style.display="-webkit-box",r.style.webkitLineClamp="".concat(g),Vt=Ut.originalAndTranslated)}else r&&(r.style.display="-webkit-box"),n.style.display="-webkit-box"}}}function Jt(){var e=(0,t.$$)(".message-item");e.forEach(function(t){tt(t,e,!0)}),Ra(document,!0),da(document.body.querySelector(".message-header"));try{(0,t.$)("div.message-cover")&&Fa()}catch(yn){n.Commands.log("initOptimizeCover error:"+yn,n.LogLevel.info)}return Xt(),e}function Yt(){var e=document.querySelector(".top-message-attachments-scroll-list");e&&(e.addEventListener("touchstart",function(t){e.startTouchX=t.targetTouches[0].clientX,e.startScrollLeft=e.scrollLeft},{passive:!1}),e.addEventListener("touchmove",function(t){var a=t.targetTouches[0].clientX-e.startTouchX;(a>0&&0===e.startScrollLeft||a<0&&e.scrollWidth-e.clientWidth<=e.startScrollLeft+1)&&t.preventDefault()},{passive:!1}))}function Xt(){var e=(0,t.$)(".recipients-expand");if(e){var a=e.querySelectorAll(".recipients-type"),n=0;if(a.length>0)for(var r=getComputedStyle(a[0]).font,o=0;o<a.length;o++){var i=a[o],s=(0,t.getTextWidth)(i.innerText,r);s>n&&(n=Math.ceil(s))}if(n>0){var l=document.querySelector("style")||document.createElement("style");if(l){var c=".recipients-type {width: ".concat(n,"px;}"),d=l.innerHTML+c;l.innerHTML=d}}}}function Gt(){ea();var e=[];document.querySelectorAll(".message-content").forEach(function(t){var a=(0,m.handleHyperLink)(t),n=t.closest(".message-item");a&&n&&e.push(n),da(t),(0,w.updateIpadStyleIfNeeded)(n)}),e.length>0&&xt(e),Wa(document)}function Kt(){var e=[];document.querySelectorAll(".message-content").forEach(function(t){var a=(0,m.handleHyperLink)(t),n=t.closest(".message-item");a&&n&&e.push(n),da(t),(0,w.updateIpadStyleIfNeeded)(n)}),e.length>0&&xt(e),Wa(document,!0)}function Zt(){ea(),Wa(document,!1)}function ea(){n.Commands.checkUserids((0,e.getAvatarUserids)()),te(),za(),sa(!0),(0,w.listenToScrollLoadMore)(),na(),aa(0),ta(),Yt()}function ta(){document.addEventListener("copy",function(e){v.isDarkMode&&(0,v.observeCopy)(e);var a=window.getSelection();if(a.rangeCount>0){var r=a.getRangeAt(0),o=r.cloneContents(),i=document.createElement("div");i.appendChild(o);var s=[],l=i.querySelectorAll(".message-item");if(l.length>0)for(var c=0;c<l.length;c++){var d=l[c].getAttribute("message-id");d&&s.push(d)}else{var m=r.startContainer.parentNode.closest(".message-item");if(m){var u=m.getAttribute("message-id");u&&s.push(u)}else{if(r.startContainer.parentNode.closest(".message-header")){var g=(0,t.$$)(".message-item[message-id]");if(g.length>0){var f=g[window.isNewMessageAtTop?g.length-1:0].getAttribute("message-id");f&&s.push(f)}}}}s.length>0?n.Commands.copyContents(s):n.Commands.log("copy without message content")}})}function aa(e){window.innerHeight<=0&&e<3?(n.Commands.log("window.innerHeight not init ".concat(window.innerHeight),!0),setTimeout(function(){n.Commands.log("setTimeout handle ".concat(e,", ").concat(window.innerHeight),!0),aa(e+1)},0)):(n.Commands.log("window.innerHeight ok ".concat(window.innerHeight,", tryCount ").concat(e),!0),G())}function na(){var e=(0,t.$)(".message-list");if(e){new(MutationObserver||WebKitMutationObserver)(function(){var t=Array.from(e.children);window.isNewMessageAtTop||(t=t.reverse()),t.every(function(e){return!!e.classList.contains("message-item-divider")||(!!e.getAttribute("reply-message-id")||(e.classList.contains("expand")||e.classList.contains("feed_card")||(n.Commands.log("observeautoexpand"),Ae(e,!1)),!1))}),(0,g.updateMessageListDivider)(e,window.isNewMessageAtTop)}).observe(e,{attributes:!1,childList:!0,subtree:!1})}}function ra(){try{if("true"==window.enableLocateToExpand&&N){var e=Date.now();document.body.scrollTop=N,document.documentElement.scrollTop=N,n.Commands.log("domReady ".concat(document.documentElement.scrollTop),!0),setTimeout(function(){var a=Date.now()-e;t.domReadyTime.value=Date.now(),y.Trace.arriveTo(y.Index.dom_ready),n.Commands.domReady(),n.Commands.track("email_domready_delay",{delay:a})},0)}else t.domReadyTime.value=Date.now(),y.Trace.arriveTo(y.Index.dom_ready),n.Commands.domReady()}catch(yn){t.domReadyTime.value=Date.now(),n.Commands.log("domready error "+yn,n.LogLevel.error),y.Trace.arriveTo(y.Index.dom_ready),n.Commands.domReady()}}var oa=0;function ia(){var e=document.documentElement.scrollTop;jt=!0,ne=!0,zt&&clearTimeout(zt),zt=setTimeout(function(){e===oa?la():(oa=e,zt=setTimeout(ia,100))},100)}function sa(e){e?window.addEventListener("scroll",ia):(clearTimeout(zt),window.removeEventListener("scroll",ia))}function la(){ne=!1,G(),ca()}function ca(){if((0,t.checkEnableImageQueue)()&&W.size>0){var e,a=new Set,n=q(W);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.loaded?a.add(r):ka(r)&&a.add(r)}}catch(l){n.e(l)}finally{n.f()}var o,i=q(a);try{for(i.s();!(o=i.n()).done;){var s=o.value;W.delete(s)}}catch(l){i.e(l)}finally{i.f()}console.log("finishHandleImgsOnScreen ".concat(W.size))}}function da(e){if(!(void 0===window.keyword||window.keyword.length<1)){var t=".lk-search-highlight";ma(e.matches(t)?[e]:e.querySelectorAll(t),window.keyword)}}function ma(e,t){if(t&&t.trim().length)for(var a=t.trim().split(/\s+/),n=0;n<a.length;n++){var r=a[n];new i.Search(e,"lk-big-search",nn(!1)).mark(r)}}function ua(e){for(var t=e.querySelectorAll(".attachment-item-wrapper .progress-bar .active"),a=0;a<t.length;a++){var n=t[a],r=parseFloat(n.style.width);if(!isNaN(r)&&n.style.width.endsWith("%")){var o=n.closest(".attachment");if(o){var i=o.querySelector(".attachment-type-size.dim-text"),s=parseFloat(i.innerText),l=o.querySelector(".attachment-type-received"),c=Math.floor(r*s)/100,d=i.innerText.replace("".concat(s),"".concat(c))+"&nbsp;/&nbsp;";l.innerHTML=d}}}}function ga(e,t){for(var a=e.querySelectorAll("div[id^=large-file-area]"),n=0;n<a.length;n++){var r=a[n];if(r&&r.id){var o=t.querySelector("div[id=".concat(r.id,"]"));o&&(o.style.display=r.style.display)}}}function fa(e){if(!(0,t.isNull)(e)){var a,n=e.querySelectorAll("div[id^=large-file-area]"),r=e.closest(".message-item");r&&(a=r.querySelectorAll(".attachment-item-wrapper .attach_size_2,.attachment-item-wrapper .attach_size_1"));var o=[];if(a)for(var i=0;i<a.length;i++)a[i]&&a[i].getAttribute("file-token")&&(o[o.length]=a[i].getAttribute("file-token"));if(n)for(i=0;i<n.length;i++){var s=n[i];if(s){var l=s.querySelectorAll("#large-file-item > a"),c=0;for(i=0;i<l.length;i++){var d=l[i],m=d.getAttribute("href");va(m,o)?d.parentNode.style.display="none":m&&(m.endsWith("?source=larkmail_largefile")||(d.href=d.href+"?source=larkmail_largefile"),c++)}c>0&&(s.style.display="block",j=(0,t.isIOS)())}}}}function va(e,t){if(t&&e)for(var a=0;a<t.length;a++)if(t[a]&&e.indexOf(t[a])>-1)return!0;return!1}function ha(e,n){var r=(0,t.findMessageItem)(e),o=!1;if(r){for(var i=r.querySelectorAll('a[id^="at-user"]'),s=0;s<i.length;s++){var l=i[s],c=l.getAttribute("href");if(c&&c.startsWith("mailto:")){var d=c.substring(7);-1!=d.indexOf("?")&&(d=d.substring(0,d.indexOf("?")));var m=n[d];m&&m!=l.innerText&&(l.innerText="@"+m,o=!0,pn(l))}}if(o)r.querySelectorAll(".message-content").forEach(function(e){da(e)});o&&(0,a.shouldOptimizeScale)()&&xt([r])}}function pa(e,a,n){var r=(0,t.findMessageItem)(e),o=!1;r&&(r.querySelectorAll(".recipients-item").forEach(function(e){var t=e.querySelector(".recipients-type");if(t&&t.innerText==n){var r=e.querySelector(".address-list");if(r)r.querySelectorAll(".address-item").forEach(function(e){if(e){var t=e.querySelector(".address"),n=e.querySelector(".item_name");if(t&&n){var r=a[t.innerText];if(r&&r!=n.innerText){var i=e.querySelector(".name");i&&i.matches(".no-name-content")&&i.classList.remove("no-name-content"),n.innerText=r,o=!0}}}})}}),o&&da(r.querySelector(".recipients-expand")))}function ya(e,a){var n=(0,t.findMessageItem)(e),r=!1;if(n){var o=n.querySelector(".header-content");if(o){var i=o.querySelector(".from");if(i){var s=i.querySelector(".from-name-container");if(s){var l=s.querySelector(".omit-overflow-text-name");l&&l.innerText&&(l.innerHTML=a,r=!0)}}}if(r)da(n.querySelector(".item-header"))}}function wa(e,a){var n=(0,t.findMessageItem)(e),r=!1;if(n){var o=n.querySelector(".recipients_container");if(o){var i=o.querySelector(".recipients-list-wrapper");if(i){var s=i.querySelector(".recipients-list");s&&(r=!0,s.innerHTML=a)}}if(r)da(n.querySelector(".item-header"))}}function Sa(e){if(!(0,t.isNull)(e)){for(var a=e.getAttribute("message-id"),r=e.querySelectorAll('a[id^="at-user"]'),o=window.myAddress.split(","),i=[],s=[],l=0;l<r.length;l++){var c=r[l],d=c.getAttribute("href"),m=c.innerText.substr(1);if(d){for(var u=0;u<o.length;u++){var g=o[u];if(g.length>0&&d.indexOf(g)>-1){c.removeAttribute("style"),c.classList.add("atme");break}}if(!s.includes(m)&&d.startsWith("mailto:")){var f=d.substring(7);-1!=f.indexOf("?")&&(f=f.substring(0,f.indexOf("?"))),i.push({name:m,address:f,messageId:a}),s.push(m)}d=d+"?"+m+"?source=larkmail_at",c.setAttribute("href",d)}}(0,t.shouldOptimizeLargeMail)()?i.length>0&&n.Commands.atUserInfos(i):n.Commands.atUserInfos(i)}}function ba(e){for(var t=e.querySelectorAll("a"),a=0;a<t.length;a++){var n=t[a],r=n.getAttribute("data-microurl");void 0!==r&&null!=r&&r.length>0&&n.setAttribute("href",r)}}function La(e,r){try{if((0,a.shouldOptimizeScale)()){if(n.Commands.log("fixContentScale _scaleOnImgAllLoaded",!0),r)xa(r);else if(e){var o=(0,t.findMessageItem)(e);o&&xt([o])}}else e?P[e]==F[e]&&(0,t.findMessageItem)(e)&&xt():window.imagesloadedcount==window.imagescount&&xt()}catch(yn){n.Commands.log("fixScale error:"+yn,n.LogLevel.error)}}function Ca(e,t,n,r,o){r?P[r]++:window.imagesloadedcount++,(0,p.adjustImgPlaceholder)(e,t,n,o),(0,a.shouldOptimizeScale)()||La(r,t)}function Aa(e){var t=e.getAttribute("loading"),a=e.getAttribute("cid-data-src");null!=a&&a.length>0&&a.startsWith("cid")&&(t=a),t&&Ia(e,t,null,!0,!1)}function ka(e){var a,r=e.getAttribute("loading");a=e.parentNode.classList.contains("loading_container")?e.parentNode:e;var o=(0,t.isInViewport)(a)&&r;return o&&(n.Commands.imageLoadingOnScreen(r),console.log("imageLoadingOnScreen ".concat(r)),console.log(e)),o}window.updateSenderDelegation=function(e,a,r,o){try{n.Commands.log("updateSenderDelegation "+e,n.LogLevel.info,!0);var i=(0,t.findMessageItem)(e);if(i){var s=i.querySelector(".delegate-from");s&&(s.classList.remove("hide"),s.innerHTML=a);var l=i.querySelector(".avatar");l&&l.setAttribute("enable-click","0"),i.querySelectorAll(".recipients-item").forEach(function(e){var t=e.querySelector(".recipients-type");if(t&&t.innerText===r){var a=e.querySelector(".address-list");a.querySelector(".address-item").setAttribute("enable-click","0"),a.insertAdjacentHTML("beforeend",o)}})}else n.Commands.log("updateSenderDelegation no messageNode "+e,n.LogLevel.info,!0)}catch(yn){n.Commands.log("updateSenderDelegation error:"+yn,n.LogLevel.error,!0)}};var Ta=6e4;function qa(e,t,a,n){e.getAttribute("loading")||(a?F[a]++:window.imagescount++,W.add(e),e.setAttribute("loading",t),Ia(e,t,a,!1,n))}function xa(e){if(e){var t=e.closest(".message-item");t&&(j?requestAnimationFrame(function(){xt([t])}):xt([t]))}}function Ia(e,a,r,o,i){var s=e;o&&(s.loaded=!1,s.errored=!1);setTimeout(function(){s.loaded||s.errored||((0,t.setImageCls)(e),(0,p.showImgPlaceholder)(e,!1,!1))},150),s.onload=function(e){return function(){s.loaded=!0,J().onLoad(a),o?((0,p.adjustImgPlaceholder)(s,e,a,!1),La(r,e)):(Ca(s,e,a,r,!1),La(r,e))}}(e),s.onerror=function(e){return function(){J().onError(a),z.set(a,null),s.errored=!0,n.Commands.imageOnError(a,Date.now()),o?(0,p.adjustImgPlaceholder)(s,e,a,!0):Ca(s,e,a,r,!0)}}(e);var l=window.supportedSchemes,c=new URL(a).protocol.slice(0,-1);if(l.includes(c)){var d=z.get(a),m={image:s,originImg:e,msgId:r};d?(d.push(m),z.set(a,d)):z.set(a,[m])}else setTimeout(function(e){return function(){Na(r,s,e,a,o)}}(e),Ta);c=new URL(a).protocol.slice(0,-1);if(o)J().startRetry(a,c);else{try{var u=performance.timing.domContentLoadedEventEnd;n.Commands.imageStartLoad(a,Date.now(),i,u)}catch(yn){n.Commands.log("get timing error ".concat(yn)),n.Commands.imageStartLoad(a,Date.now())}J().startDownload(a,c)}s.loaded&&(J().onLoad(a),Ca(s,e,a,r,!1)),s.src=a}function Na(e,t,a,n,r){t.loaded||(J().onTimeout(n),t.loaded=!1,r?(0,p.adjustImgPlaceholder)(t,a,n,!0):Ca(t,a,n,e,!0))}window.onImageStartDownloading=function(e){var t=z.get(e);J().inFlight(e),t&&(t.forEach(function(t){var a=t.image,n=t.originImg,r=t.msgId;setTimeout(function(t){return function(){Na(r,a,t,e,!1)}}(n),Ta)}),z.set(e,null))};var Ea={none:0,loading:1,loadingWithThumbnail:2,success:3,failure:4},Ma=Ea.none;function _a(){Ma=Ea.none;var e=(0,t.$)(".message-cover-image.cover-thumbnail"),a="mail-cover-thumbnail:"+e.getAttribute("lk-cover-token");e.style.backgroundImage="";var n=(0,t.$)(".message-cover-image.cover-full"),r="mail-cover-full:"+e.getAttribute("lk-cover-token");n.style.backgroundImage="";var o=new Image,i=new Image;o.onload=function(e){return function(){o.loaded=!0,(0,t.showDomElement)(o),e.style.backgroundImage="url("+a+")",Ma<Ea.success&&(Ma=Ea.loadingWithThumbnail),$a(Ma)}}(e),o.onerror=function(){Ma!==Ea.success&&(Ma=Ea.failure),$a(Ma)},i.onload=function(e){return function(){i.loaded=!0,(0,t.showDomElement)(i),e.style.backgroundImage="url("+r+")",Ma!=Ea.failure&&(Ma=Ea.success),$a(Ma)}}(n),i.onerror=function(){$a(Ma)},Ma=Ea.loading,o.src=a,i.src=r,$a(Ma)}function $a(e){function a(){var e=(0,t.$)(".message-cover-loading");if(e){(0,t.removeClass)(e,"retry");var a=e.querySelector(".message-cover-retry-icon");if((0,t.isNull)(a)||a.remove(),e.removeEventListener("click",Da),!e.querySelector(".message-cover-loading-icon")){var n=(0,t.convertToNodeByStr)('<svg width="45"  height="45"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling message-cover-loading-icon" style="background: rgba(1, 0, 0, 0);"><circle cx="50" cy="50" fill="none" ng-attr-stroke="{{config.color}}" ng-attr-stroke-width="{{config.width}}" ng-attr-r="{{config.radius}}" ng-attr-stroke-dasharray="{{config.dasharray}}" stroke="#8f959e" stroke-width="9" r="43" stroke-dasharray="150, 70" transform="rotate(305.873 50 50)"></circle></svg>');n.setAttribute("id","message-cover-loading-icon"),n.style.display="flex",e.insertBefore(n,e.firstElementChild)}e&&(e.style.color=""),(0,t.showDomElement)(e)}}var n,r,o,i=(0,t.$)(".message-cover-title .message-subject");function s(){if(i){var e=i.getAttribute("lk-default-color");e&&(i.style.color=e)}}e==Ea.loading?(a(),i&&(i.style.color="")):e==Ea.loadingWithThumbnail?(a(),s()):e==Ea.success?(n=(0,t.$)(".message-cover-loading"),r=n.querySelector(".message-cover-loading-icon"),o=n.querySelector(".message-cover-retry-icon"),(0,t.isNull)(r)||r.remove(),(0,t.isNull)(o)||o.remove(),(0,t.hideDomElement)(n),s()):e==Ea.failed&&(i&&(i.style.color=""),function(){var e=(0,t.$)(".message-cover-loading");if(e){(0,t.addClass)(e,"retry");var a=e.querySelector(".message-cover-loading-icon"),n=e.querySelector(".message-cover-retry-icon");if((0,t.isNull)(a)||a.remove(),!n){var r=(0,t.convertToNodeByStr)('<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="message-cover-retry-icon"><path d="M9.83021 3.33333C8.98691 2.12434 7.58583 1.33333 6 1.33333C3.42267 1.33333 1.33333 3.42267 1.33333 6C1.33333 8.57733 3.42267 10.6667 6 10.6667C8.11401 10.6667 9.89972 9.26099 10.4734 7.33333H11.8513C11.245 10.0053 8.85545 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C7.88484 0 9.5667 0.869111 10.6667 2.22844V0.666666C10.6667 0.298477 10.9651 0 11.3333 0C11.7015 0 12 0.298477 12 0.666667V4C12 4.36819 11.7015 4.66667 11.3333 4.66667H8C7.63181 4.66667 7.33333 4.36819 7.33333 4C7.33333 3.63181 7.63181 3.33333 8 3.33333H9.83021Z" fill="#3370FF"/></svg>');r.setAttribute("id","message-cover-retry-icon"),r.style.display="flex",e.insertBefore(r,e.firstElementChild)}e&&(e.style.color="#3370ff"),e.removeEventListener("click",Da),e.addEventListener("click",Da),(0,t.showDomElement)(e)}}())}function Da(){_a()}var Oa,Ba=!1;function Ra(e,n,r){var o,i,s;if(e.closest&&(o=e.closest(".message-item")),(0,t.checkEnableImageQueue)()){var l,c=(0,S.initImageQueue)(e,r);return(0,a.shouldOptimizeScale)()&&(l=o?[o]:(0,t.$$)(".message-item")),void((l||c)&&(n?Ba=!0:xt(l)))}if(o){i=o.getAttribute("message-id");var d=o.querySelectorAll("div.message-content img");F[i]=0,P[i]=0}else{d=(0,t.$$)("div.message-content img");window.imagescount=0,window.imagesloadedcount=0}0!==d.length&&(0,S.setHasImage)();for(var m=0;m<d.length;m++){var u,g=d[m].src;null!=(u=d[m].getAttribute("cid-data-src"))&&u.length>0&&u.startsWith("cid")&&(g=u),g.length>0&&(qa(d[m],g,i,r),(0,a.isInProtectedMode)()?d[m].src=g:qa(d[m],g,i,r))}(0,a.shouldOptimizeScale)()&&(s=o?[o]:(0,t.$$)(".message-item")),(s||0==d.length)&&(n?Ba=!0:xt(s)),ca()}function Ha(e){var n,r,o;e.closest&&(o=e.closest(".message-item")),n=o?o.querySelectorAll("div.message-content img"):(0,t.$$)("div.message-content img");for(var i=0;i<n.length;i++){var s=n[i],l=s.getAttribute("cid-data-src"),c=s.getAttribute("intercepted-data-src"),d=s.src;if(r=!!(d.length>0&&d.startsWith("data")),!s.loaded&&(l||c||d.length>0)){for(var m=s;m;)m.ignoreImageCLS=!0,m=m.parentNode;r||(0,p.showImgPlaceholder)(s,!1,!1,!0),(0,a.shouldOptimizeScale)()&&r&&xa(s)}}}function Fa(){_a()}function Pa(e){try{var t=e.classList;if(t.contains("lark-doclink-href-1")||t.contains("lark-doclink-href-16")||t.contains("lark-doclink-href-22"))st(e,"lk-doc");else if(t.contains("lark-doclink-href-3"))st(e,"lk-sheet");else if(t.contains("lark-doclink-href-8"))st(e,"lk-bitable");else if(t.contains("lark-doclink-href-11"))st(e,"lk-mindnote");else if(t.contains("lark-doclink-href-12"))st(e,"lk-file");else if(t.contains("lark-doclink-href-15"))st(e,"lk-slide");else{var a=e.getAttribute("href"),r=new URL(a);Oa=Oa||new RegExp(atob("Ynl0ZWRhbmNlXC4uK1wuZmVpc2h1XC4="));var o=r.hostname.match(Oa);if(o&&o.length>0){var i=r.pathname.split("/")[1];["docx","docs","sheets","wiki","mindnotes","base","file"].includes(i)&&st(e)}}}catch(yn){n.Commands.log("prePaddingDocItem error failed to parsed doc url",n.LogLevel.error)}}function Wa(e,t){var a;if(e.closest&&(a=e.closest(".message-item")),a)var r=[a];else r=e.querySelectorAll(".message-item");for(var o={},i=0;i<r.length;i++){for(var s=r[i],l=s.getAttribute("message-id"),c=s.querySelectorAll("a"),d=new Set,m=0;m<c.length;m++){var u=c[m];if(!u.classList.contains(ut)&&!u.closest("[id^=large-file-area]")){var g=u.getAttribute("href");g&&g.length>0&&(d.add(g),Pa(u))}}o[l]=Array.from(d)}t||n.Commands.checkUrls(o)}function za(){var e=!1;function t(a){a.target.classList.contains("drag-view-title")||a.stopPropagation(),window.removeEventListener("touchend",t,!0),e=!1}window.addEventListener("touchmove",function(a){a.target.closest(".swiper-container")||e||(e=!0,window.addEventListener("touchend",t,!0))},!0)}var ja=null;function Ua(e,t,a){ja||(ja=new s.TranslateRecommend(window.translateRecommendTitle)),e?ja.show(t,a):ja.remove(t,!0)}function Va(e){var t,a,n=e.closest(".outer-content-container");if(n)for(var r=n.children,o=0;o<r.length;o++){var i=r[o];i.classList.contains("translated-quote-wrapper")?a=i:i.classList.contains("original-quote-wrapper")&&(t=i)}return t||a?{originalQuote:t,translatedQuote:a}:void 0}function Qa(e){var t=e.querySelector(".original-message-content"),a=e.querySelector(".translated-message-content");a.classList.contains("dark")||at(a);for(var n=e.querySelectorAll("a"),r=t.querySelectorAll("a"),o=0;o<n.length;o++)for(var i=n[o],s=i.getAttribute("href"),l=0;l<r.length;l++){var c=r[l],d=c.getAttribute("href");if(s&&d&&s==d&&s.trim()==i.innerText.trim()){i.innerText=c.innerText;break}}}function Ja(e,t){try{var a=e.querySelectorAll(".".concat(dt));if(a.length>0){for(var r={},o=0;o<a.length;o++){var i=a[o];r[i.href]=i.classList}var s=t.querySelectorAll("a");for(o=0;o<s.length;o++){var l=s[o],c=r[l.href];c&&(l.classList=c)}}}catch(yn){n.Commands.log("syncTranslateDocsIconState error:"+yn,n.LogLevel.error)}}function Ya(e,a){var n=e.querySelector(".original-message-content"),r=e.querySelector(".translated-message-content");(0,t.isNull)(n)||(0,t.isNull)(r)||(n.style.display=a?"none":"",r.style.display=a?"":"none");var o=Va(n);o&&o.originalQuote&&(o.originalQuote.style.display=a?"none":""),o&&o.translatedQuote&&(o.translatedQuote.style.display=a?"":"none")}window.setInterceptImageLoading=function(e,a,n,r){(0,t.checkEnableImageQueue)()?(0,S.addForceLoadingImage)(e,r):qa(e,a,n,r)},window.toggleTranslationLoading=function(e,a){n.Commands.log("toggleTranslationLoading",n.LogLevel.info);var r=(0,t.findMessageItem)(e);if(!(0,t.isNull)(r)){var o=r.querySelector(".translation-loading-bar");if(!(0,t.isNull)(o))if("true"===a){gn(o);var i=r.querySelector(".translation-operation-bar");(0,t.hideDomElement)(i),ln(!1,r)}else fn(o)}},window.showTranslateRecommend=function(e){for(var t=JSON.parse(e),a=0;a<t.length;a++){var n=t[a];Ua(n.show,n.messageID,n.displayText)}},window.updateTranslation=function(e,o,i,s,l,c,d,m){n.Commands.log("updateTranslation",n.LogLevel.info);var u=(0,t.findMessageItem)(e);if(!(0,t.isNull)(u)){fn(u.querySelector(".translation-loading-bar"));var g=u.querySelector(".original-message-content"),f=u.querySelector(".translated-message-content");if(f||(f=(0,t.convertToNodeFirstElementByStr)('<div class="message-content translated-message-content lk-search-highlight"><div class="message-inner-content"></div></div>'),(0,a.shouldOptimizeScale)()?g.parentNode.appendChild(f):g.parentNode.insertBefore(f,g.nextSibling)),!(0,t.isNull)(g)&&!(0,t.isNull)(f)){if(o){var v=f.querySelector(".message-inner-content");v?v.innerHTML=c:f.innerHTML=c,f.classList.remove("dark"),(0,r.formatContent)(f),m&&f.classList.add("showPopover"),Qa(u),Ja(g,f),ga(g,f)}else f.classList.remove("showPopover");Ya(u,o),o?Ra(u):xt([u])}var h=u.querySelector(".translation-language");!(0,t.isNull)(h)&&d&&d.length>0&&(h.innerText=d);var p=u.querySelector(".translation-operation-bar");(0,t.isNull)(p)||(ja&&ja.remove(e,!1),(0,t.showDomElement)(p.querySelector(".language-drop-down-icon")),(0,t.showDomElement)(p));var y=u.querySelector(".translation-view-original-button"),w=u.querySelector(".translation-view-translation-button");(0,t.isNull)(y)||(0,t.isNull)(w)||(o?((0,t.showDomElement)(y),(0,t.hideDomElement)(w)):((0,t.hideDomElement)(y),(0,t.showDomElement)(w))),cn(!1,u),ln(!0,u),dn(u,o,i,s,m),un(u,o,l),rn(u)}},window.updateHeaderTop=function(e){if(e){var t=document.body.querySelector(".body-content");t&&(t.style.marginTop="".concat(e,"px"))}},window.updateHeaderHeight=function(e){var a=parseFloat(e);if(!isNaN(a)){var n=(0,t.$)("lk-native-title");n&&(n.style.height="".concat(a,"px"))}},window.dismissTranslation=function(e){n.Commands.log("dismissTranslation",n.LogLevel.info);var a=(0,t.findMessageItem)(e);if(!(0,t.isNull)(a)){fn(a.querySelector(".translation-loading-bar"));var r=a.querySelector(".translation-operation-bar");(0,t.hideDomElement)(r),Ya(a,!1),cn(!0,a),ln(!1,a),dn(a,!1,"",""),un(a,!1,"")}},window.updateSafetyBanner=function(e,t,a){l.SafetyBanner.update(e,t,a)},window.startSearch=function(){var e=[];(0,t.$$)(".message-item").forEach(function(t){if(null==t.querySelector(".item-content")){var a=t.getAttribute("message-id");a&&e.push(a)}}),n.Commands.needContents(e,$.search)};var Xa,Ga,Ka,Za="mail_title",en={};function tn(){sn(),n.Commands.exitSearch()}function an(e,a){n.Commands.log("testSearchABC locateSearchTo ".concat(e,", ").concat(a));var r=en[e];if(r&&r.matchNodes&&r.matchNodes[a]&&r.matchNodes[a][0]){var o=r.matchNodes,i=o[a=Math.min(Math.max(a,0),o.length-1)];if(Ga&&i!==Ga)for(var s=0;s<Ga.length;s++)Ga[s].classList.remove("lk-located"),Ka.updateFakeEllipsis(Ga[s]);var l=!1,c=!1,d=!1,m=(0,t.findMessageItem)(e);for(s=0;s<i.length;s++){var u=i[s];if(u.classList.add("lk-located"),r.updateFakeEllipsis(u),l||!m||m.classList.contains("expand")||(l=!0,m.classList.add("expand")),!c)if(u.closest(".quoteRendered")){var g=m.querySelector("[larkmailquote=true]");if(g){var f=(0,t.getQuoteClassPostfix)(g),v="collapse".concat(f);g.closest(".".concat(v))&&(c=!0,ue(g))}}!d&&u&&u.classList.contains("disable-scroll-horizontal")&&(d=!0)}console.log(i),Ga=i,Ka=r;d?xe(i[0],80,!0):xe(i[0],80)}}function nn(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(t){if(t instanceof HTMLElement){if(t.classList.contains("ignoreForSearch"))return!0;if(e){var a=getComputedStyle(t);return"none"===a.display||"hidden"===a.visibility}}}}function rn(e){var t=e.getAttribute("message-id");if(t&&e&&Xa){hn(e,Xa);var a=vn(e),r=e.querySelector(".message-content.original-message-content");if(r&&"none"===r.style.display&&(r=e.querySelector(".message-content.translated-message-content")),a&&a.length>0){n.Commands.jsSearchStart();var o=on([r],t);o&&Xa&&n.Commands.searchResults(Xa,1,[{messageId:t,count:0|o.matches}])}}}function on(e,t){if(Xa){var a=new i.Search(e,"lk-content-search",nn());return a.mark(Xa),en[t]=a,a}}function sn(){for(var e in en){en[e].unmark()}en={},Ga=void 0,Ka=void 0,Xa=void 0}function ln(e,a){if(a){var r=a.querySelector(".turn-off-translate");(0,t.isNull)(r)||(e?(0,t.showDomElement)(r):(0,t.hideDomElement)(r))}else n.Commands.log("toggleTurnOffTranslationButton no message item",n.LogLevel.error)}function cn(e,a){if(a){var r=a.querySelector(".translate");(0,t.isNull)(r)||(e?(0,t.showDomElement)(r):(0,t.hideDomElement)(r))}else n.Commands.log("toggleTranslateButton no message item",n.LogLevel.error)}function dn(e,a,n,r,o){var i=(0,t.$)(".message-title-and-labels"),s=!1;i||(i=(0,t.$)(".message-cover"),s=!0);var l=a&&!(0,t.isNull)(r)&&"string"==typeof r&&r.toString().length>0;if(!(0,t.isNull)(i)||l){var c=!s&&e.classList.contains("stranger_card"),d=!s&&e.classList.contains("feed_card"),m=void 0;m=c||d?c?e.querySelector(".stranger-card-header .subject-translation"):e.querySelector(".feed-card-header .subject-translation"):i.querySelector(".subject-translation");var u=c?e.querySelector(".stranger-card-header .message-subject"):e.querySelector(".feed-card-header .message-subject");if(!(0,t.isNull)(m)&&!(0,t.isNull)(u)){var g=a&&!(0,t.isNull)(n)&&"string"==typeof n&&n.toString().length>0,f=g?"-webkit-box":"none";m.style.display=f,m.innerText=n,(c||d)&&"string"==typeof r&&r.toString().length>0&&(u.style.display=g&&o?"none":"-webkit-box"),s||(a&&o?m.addEventListener("click",Pe):m.removeEventListener("click",Pe)),Wt()}}}function mn(){var e=(0,t.$)(".message-cover");if(e){var a=e.querySelector(".subject-translation"),n=e.querySelector(".message-subject");a.removeEventListener("click",He),n.removeEventListener("click",He),a.addEventListener("click",He),n.addEventListener("click",He)}}function un(e,a,r){if(e){var o=e.querySelector(".original-plain-text"),i=e.querySelector(".translation-plain-text");(0,t.isNull)(o)||(0,t.isNull)(i)||(a?((0,t.hideDomElement)(o),(0,t.showDomElement)(i),i.innerText=r):((0,t.showDomElement)(o),(0,t.hideDomElement)(i)))}else n.Commands.log("toggleTranslationSummary no message item",n.LogLevel.error)}function gn(e){if(!e.querySelector(".translation-loading-icon")){var a=(0,t.convertToNodeByStr)('<svg width="45"  height="45"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling translation-loading-icon" style="background: rgba(1, 0, 0, 0);"><circle cx="50" cy="50" fill="none" ng-attr-stroke="{{config.color}}" ng-attr-stroke-width="{{config.width}}" ng-attr-r="{{config.radius}}" ng-attr-stroke-dasharray="{{config.dasharray}}" stroke="#3370ff" stroke-width="9" r="43" stroke-dasharray="150, 70" transform="rotate(305.873 50 50)"></circle></svg>');a.setAttribute("id","translation-loading-svg"),a.style.display="flex",e.insertBefore(a,e.firstElementChild)}(0,t.showDomElement)(e)}function fn(e){var a=e.querySelector("#translation-loading-svg");(0,t.isNull)(a)||a.remove(),(0,t.hideDomElement)(e)}function vn(e){var t=e.querySelector(".message-content.original-message-content");t&&"none"===t.style.display&&(t=e.querySelector(".message-content.translated-message-content"));var a=[];t&&a.push(t);for(var r=e.querySelectorAll(".attachment-name"),o=0;o<r.length;o++)a.push(r[o]);return n.Commands.log("generateMessageContentDoms get "+a.length,n.LogLevel.info),a}function hn(e,t){var a=e?e.querySelectorAll(".attachment-name"):null;if(n.Commands.log("expandIfHitHiddenAttachment nodelist size: "+a.length,n.LogLevel.info),a&&!(a.length<4)){for(var r=[],o=3;o<a.length;o++)r.push(a[o]);var s,l=new i.Search(r,"check_if_need_expand",!1);if(l.mark(t),n.Commands.log("expandIfHitHiddenAttachment search matches size: "+l.matches.length,n.LogLevel.info),l.matches&&l.matches>0)(s=e.matches(".message-attachments-wrapper")?e:e.querySelector(".message-attachments-wrapper"))&&!s.classList.contains("expand")&&Ve(s);l.unmark()}}function pn(e){for(var t=e;t;)t.ignoreFeatCLS=!0,t=t.parentNode}window.search=function(e){n.Commands.log("testSearchABC search start ---\x3e ".concat(e),!0),n.Commands.jsSearchStart(),e!=Xa&&sn(),Xa=e;var a=(0,t.$$)(".message-item"),r=[];function o(t,a){if(n.Commands.log("searchDom: "+t,n.LogLevel.info),t&&a&&t.length>0){var o=new i.Search(t,"lk-content-search",nn());o.mark(e),r.push({messageId:a,count:o.matches||0}),en[a]=o}}var s=(0,t.$)(".message-subject");s&&o([s],Za);for(var l=0;l<a.length;l++){var c=a[l];hn(c,e),o(vn(c),c.getAttribute("message-id"))}var d="testSearchABC search finish ---\x3e ".concat(e," resultInfo ").concat(JSON.stringify(r));n.Commands.log(d,!0),n.Commands.searchResults(e,0,r)},window.locateSearch=function(e,a,r){if(n.Commands.log("testSearchABC locateSearch to "+e+" "+a,!0),en[e])an(e,a);else if(e!=Za||(0,t.$)(".message-subject")){var o=(0,t.$)('.message-item[message-id="${msgId}"] .message-content');if(n.Commands.log("testSearchABC locateSearch start search",!0),o||r&&r.length>0){function i(t){n.Commands.log("testSearchABC searchAndLocate to "+e+" "+a,!0),console.log(t),hn(t,Xa);var r=vn(t);n.Commands.jsSearchStart();var o=on(r,e);n.Commands.searchResults(Xa,1,[{messageId:e,count:0|o.matches}],a),an(e,a)}n.Commands.log("testSearchABC locateSearch start search messageContent",!0),o?(n.Commands.log("testSearchABC locateSearch hasContent",!0),i(o)):(n.Commands.log("testSearchABC locateSearch addMessageContent",!0),Te(e,r,function(e){i(e)}))}else n.Commands.needContentLocateSearch(e,a)}else if(Ga)for(var s=0;s<Ga.length;s++)Ga[s].classList.remove("lk-located")},window.exitSearch=function(){sn()},window.locateTo=an,window.hideScheduleSendBanner=function(e){if(e){var a=(0,t.$)('[message-id="'.concat(e,'"]'));if(a){var n=a.querySelector(".schedule-operation-bar");n&&(0,t.hideDomElement)(n)}}};
},{"./errorTracker":"HrG0","./avatar":"IjMb","./utils":"FOZT","./mailScale":"WwWL","./commands":"TnH5","./renderQuote":"dnLp","./popover":"BRBp","./search":"zfSF","./translateRecommend":"N3t7","./safetyBanner":"vpJJ","./interceptBanner":"w5qj","./readReceiptBanner":"Kw1T","./htmlRules/hyperLinkRule":"Z8UI","./touchHandler":"ao0o","./messageListDivider":"XLy4","./layoutShiftMonitor":"zWOE","./darkMode":"Nr45","./contentBlocker":"pWjn","./imagePlaceholder":"cxKd","./trace":"eTQb","./feed":"vc6A","./contentImage":"KACJ","./importantContactBanner":"KNVS","./lifecycle":"Q86i"}]},{},["Focm"], null)
//# sourceMappingURL=/index.js.map