//
//  PKMMetaAccessorTests.swift
//  TTMicroApp-Unit-Tests
//
//  Created by Nicholas Tau on 2022/11/25.
//
import Foundation
import XCTest
@testable import TTMicroApp
import OPSDK

final class PKMMetaAccessorTests: XCTestCase {
    private var metaAccessor = PKMMetaAccessor(type: .gadget)
    private var provider = GadgetMetaProvider(type: .gadget)

    override func tearDownWithError() throws {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
        //移除所有数据
        self.metaAccessor.removeAllMetas()
    }
    
    func test_dbInitialized() {
        self.metaAccessor.closeDBQueue()
    }
    
    func test_db_insert() {
        let identifier = "identifier_test_mock_id"
        let bizType = "gadget"
        let metaFrom = 0
        let appID = "cli_a0f543c81b7a900b"
        let appVersion = "1.1.50"
        let packageName = "lauhznuv_vwaen3ztjid"
        
        let _ = self.metaAccessor.saveMetaWith(identifier,
                                               bizType: bizType,
                                               meta: self.mockJSONStringA_v0,
                                               metaFrom: metaFrom,
                                               appID: appID,
                                               appVersion: appVersion,
                                               packageName: packageName,
                                               isPreview: false)
        let localMetaString = self.metaAccessor.getLocalMetaBy(appID)
        XCTAssertEqual(self.mockJSONStringA_v0, localMetaString)
        
    }
    
    func test_db_insert_with_sepreatd_arguements() {
        let identifier = "identifier_test_mock_id"
        let bizType = "gadget"
        let metaFrom = 0
        let appID = "cli_a0f543c81b7a900b"
        let appVersion = "1.1.50"
        let packageName = "lauhznuv_vwaen3ztjid"
        
        let _ = self.metaAccessor.saveMetaWith(identifier,
                                               bizType: bizType,
                                               meta: self.mockJSONStringA_v0,
                                               metaFrom: metaFrom,
                                               appID: appID,
                                               appVersion: appVersion,
                                               packageName: packageName,
                                               isPreview: false)
        let localMetaString = self.metaAccessor.getLocalMetaBy(appID)
        XCTAssertEqual(self.mockJSONStringA_v0, localMetaString)
    }

    func test_db_insert_meta_check_properties() {
        
        let appID = "cli_a0f543c81b7a999b"
        
        let uniqueIdB = OPAppUniqueID(appID: appID, identifier: nil, versionType: .current, appType: .gadget)
        let metaContextB = MetaContext(uniqueID: uniqueIdB, token: "")
        guard let metaB = try? self.provider.buildMetaModel(with:self.mockJSONStringB, context: metaContextB) as? GadgetMeta else {
            XCTAssertNotNil(nil, "meta can't be nil")
            return
        }
        let _ = self.metaAccessor.saveMetaWith(baseMeta: metaB)
        let allMetas = self.metaAccessor.getAllMetasWithBy(appID: appID)
        allMetas.forEach { metaString in
            guard let metaNotNil =  try? self.provider.buildMetaModel(with:metaString, context: metaContextB) as? GadgetMeta else {
                XCTAssertNotNil(nil, "meta can't be nil")
                return
            }
            XCTAssertEqual(metaNotNil.appVersion, metaB.appVersion)
            XCTAssertEqual(metaNotNil.urls, metaB.urls)
        }
        XCTAssertEqual(allMetas.count, 1)
    }

    // func test_db_insert_batch_metas() {
    //     let appIDA = "cli_a0f543c81b7a900b"
    //     let uniqueId = OPAppUniqueID(appID: appIDA, identifier: nil, versionType: .current, appType: .gadget)
    //     let metaContext = MetaContext(uniqueID: uniqueId, token: "")
    //     let provider = GadgetMetaProvider(type: .gadget)
    //     guard let metaA_v0 = try? provider.buildMetaModel(with:self.mockJSONStringA_v0, context: metaContext) as? GadgetMeta else {
    //         XCTAssertNotNil(nil, "meta can't be nil")
    //         return
    //     }
    //     guard let metaA_v1 = try? provider.buildMetaModel(with:self.mockJSONStringA_v1, context: metaContext) as? GadgetMeta else {
    //         XCTAssertNotNil(nil, "meta can't be nil")
    //         return
    //     }
    //     guard let metaA_v2 = try? provider.buildMetaModel(with:self.mockJSONStringA_v2, context: metaContext) as? GadgetMeta else {
    //         XCTAssertNotNil(nil, "meta can't be nil")
    //         return
    //     }

    //     let metaAlistUpdateCheck = [metaA_v0, metaA_v1, metaA_v2]
    //     metaAlistUpdateCheck.forEach { meta in
    //         let _ = self.metaAccessor.saveMetaWith(baseMeta: meta)
    //     }

    //     let savedResults: [GadgetMeta] = self.metaAccessor.getAllMetasWithTimestampBy(appIDA).compactMap {
    //         guard let metaNotNil = try? provider.buildMetaModel(with: $0.0, context: metaContext) as? GadgetMeta else {
    //             return nil
    //         }
    //         return metaNotNil
    //     }
    //     XCTAssertEqual(metaAlistUpdateCheck.count, savedResults.count)
        
    //     //返回结果应该是按照插入的顺序倒排（按时间戳降序返回，最后插入的排最前面）
    //     XCTAssertEqual(metaAlistUpdateCheck[0].appVersion, savedResults[2].appVersion)
    //     XCTAssertEqual(metaAlistUpdateCheck[1].appVersion, savedResults[1].appVersion)
    //     XCTAssertEqual(metaAlistUpdateCheck[2].appVersion, savedResults[0].appVersion)

    //     //返回的结果应该是按照版本顺序返回，不需要再排序
    //     let savedResultsWithVersionOrder = MetaLocalAccessorBridge.getAllMetasDESCByAppVersionBy(appIDA)
    //     //重新排一次看看，两次结果是不是相同
    //     let sortedWithVersion = savedResultsWithVersionOrder.sorted(by: { BDPVersionManager.compareVersion($0.appVersion, with: $1.appVersion) > 0 })
    //     //比较两次结果是不是真的一样，预期是相同的
    //     for (index, savedItem) in savedResultsWithVersionOrder.enumerated() {
    //         XCTAssertEqual(savedItem.appVersion, sortedWithVersion[index].appVersion)
    //     }
    // }
    
    func test_removeMetas() {
        let appIDA = "cli_a0f543c81b7a900b"

        let uniqueId = OPAppUniqueID(appID: appIDA, identifier: nil, versionType: .current, appType: .gadget)
        let metaContext = MetaContext(uniqueID: uniqueId, token: "")
        let provider = GadgetMetaProvider(type: .gadget)
        guard let metaA_v0 = try? provider.buildMetaModel(with:self.mockJSONStringA_v0, context: metaContext) as? GadgetMeta else {
            XCTAssertNotNil(nil, "meta can't be nil")
            return
        }
        guard let metaA_v1 = try? provider.buildMetaModel(with:self.mockJSONStringA_v1, context: metaContext) as? GadgetMeta else {
            XCTAssertNotNil(nil, "meta can't be nil")
            return
        }
        guard let metaA_v2 = try? provider.buildMetaModel(with:self.mockJSONStringA_v2, context: metaContext) as? GadgetMeta else {
            XCTAssertNotNil(nil, "meta can't be nil")
            return
        }

        let metaAlistUpdateCheck = [metaA_v0, metaA_v1, metaA_v2]
        metaAlistUpdateCheck.forEach { meta in
            let _ = self.metaAccessor.saveMetaWith(baseMeta: meta)
        }

        self.metaAccessor.removeMetas(metas: [metaA_v0, metaA_v1, metaA_v2])
        XCTAssertEqual(self.metaAccessor.getAllMetasWithBy(appID: appIDA).count, 0)
    }

    private lazy var mockJSONStringA_v0: String = {
        """
{"appVersion":"1.1.50","versionType":"current","version":"0.1.65","name":"subpackage-test","packageData":{"urls":
["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js"],"md5":"ca7498574d852ca0f27a76f4fd0cec00"},"appID":"cli_a0f543c81b7a900b","compileVersion":"","businessData":{"versionCode":1669259473,"minJSsdkVersion":"","message_action":true,"isFromBuildin":false,"chat_action":true,"extraDict":{"feedback":false,"useOpenSchemaWhiteList":true,"openSchemaWhiteList":[{"host":"itunes.apple.com","schema":"https"},{"host":"app.feishu.cn","schema":"https"},{"schema":"seal"},{"host":"canva.cn","schema":"https"},{"host":"login.microsoftonline.com","schema":"https"},{"host":"wj.bytedance.com","schema":"https"},{"host":"seal.bytedance.net","schema":"https"},{"host":"www.canva.cn","schema":"https"},{"host":"canva-china.jp.jp.ngrok.io","schema":"https"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.larksuite.com","schema":"https"},{"host":"i.snssdk.com","schema":"https"},{"host":"www.feishu.cn","schema":"https"},{"host":"crashes","schema":"chrome"},{"schema":"itms-services"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.feishu.cn","schema":"lark"},{"host":"applink.larksuite.com","schema":"https"},{"host":"larksuite.help","schema":"https"},{"host":"getfeishu.cn","schema":"https"},{"host":"approval.bytedance.com","schema":"https"},{"host":"applink.larksuite.com","schema":"lark"},{"host":"wiki.bytedance.net","schema":"https"},{"host":"accounts.google.com","schema":"https"}],"orgAuthScope":{},"web_app":{"md5":"","url":"","version_code":""},"userAuthScopeList":{"userLocation":{"mod":1,"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"mod":1,"auth":true,"modifyTime":1668564938000}},"userAuthScope":{"userLocation":{"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"auth":true,"modifyTime":1668564938000}}},"shareLevel":0,"webURL":"","minLarkVersion":""},"components":[{"name":"editor"}],"batchMetaVersion":0,"authData":{"domainsAuthDict":{},"versionUpdateTime":1669265056,"versionState":0,"blackList":[],"authList":[],"gadgetSafeUrls":["https://open.larksuite.com","https://open.feishu.cn","https://open.larksuite.com","https://app.feishu.cn","https://wj.bytedance.com","https://seal.bytedance.net","https://applink.feishu.cn","https://applink.larksuite.com","https://i.snssdk.com","https://www.feishu.cn","https://applink.feishu.cn","https://applink.larksuite.com","https://larksuite.help","https://getfeishu.cn","https://wiki.bytedance.net","https://sso.bytedance.com","https://passport.feishu.cn","https://jira.feishu.cn"],"appStatus":1},"mobileSubPackage":{"page/API":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js"],"pages":["index","pages/login/login","pages/check-session/check-session","pages/vibrate/vibrate","pages/get-user-info/get-user-info","pages/share/share","pages/watermark/watermark","pages/live-check/live-check","pages/choose-contact/choose-contact","pages/set-navigation-bar-title/set-navigation-bar-title","pages/navigator/navigator","pages/pull-down-refresh/pull-down-refresh","pages/animation/animation","pages/action-sheet/action-sheet","pages/modal/modal","pages/toast/toast","pages/get-network-type/get-network-type","pages/get-system-info/get-system-info","pages/keep-screen-brightness/keep-screen-brightness","pages/on-user-capture-screen/on-user-capture-screen","pages/make-phone-call/make-phone-call","pages/scan-code/scan-code","pages/request/request","pages/web-socket/web-socket","pages/upload-file/upload-file","pages/download-file/download-file","pages/image/image","pages/voice/voice","pages/file/file","pages/on-accelerometer-change/on-accelerometer-change","pages/on-compass-change/on-compass-change","pages/canvas/canvas","pages/page-scroll-to/page-scroll-to","pages/inneraudio/inneraudio","pages/video/video","pages/get-location/get-location","pages/open-location/open-location","pages/choose-location/choose-location","pages/storage/storage","pages/get-connected-wifi/get-connected-wifi","pages/get-clipboard-data/get-clipboard-data","pages/on-network-status-change/on-network-status-change","pages/chat/chat","pages/openschema/openschema","pages/device-authentication/device-authentication","pages/password-verify/password-verify","pages/mailto/mailto","pages/choose-chat/choose-chat","pages/get-device-id/get-deviceId","pages/get-launch-query/get-launch-query"],"independent":false,"md5":"e01543d3cf5fdc8e352f4fd75a496698"},"page/componen2":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false,"md5":"9c6101826973c82e0a3b1414c2d21ad0"},"page/component":{"md5":"bff3aa680e2a7846aaa08aac2060baca","path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js","https://sf3-cn.feishucd.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false},"page/independent":{"md5":"7b5e0dafb01f33b0bf5061a638b4fce1","independent":true,"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js"],"pages":["index"]},"__APP__":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js"],"independent":false,"md5":"ba6d24a04f6b905f4c944800cf8c31e9","pages":["page/index"]}},"appType":1,"iconUrl":"https://s1-imfile.feishucdn.com/static-resource/v1/cace5838-a1c9-4829-a68a-18e4014cfeag","identifier":"cli_a0f543c81b7a900b"}
"""
    }()

    private lazy var mockJSONStringA_v1: String = {
        """
{"appVersion":"1.1.51","versionType":"current","version":"0.1.65","name":"subpackage-test","packageData":{"urls":
["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js"],"md5":"ca7498574d852ca0f27a76f4fd0cec00"},"appID":"cli_a0f543c81b7a900b","compileVersion":"","businessData":{"versionCode":1669259473,"minJSsdkVersion":"","message_action":true,"isFromBuildin":false,"chat_action":true,"extraDict":{"feedback":false,"useOpenSchemaWhiteList":true,"openSchemaWhiteList":[{"host":"itunes.apple.com","schema":"https"},{"host":"app.feishu.cn","schema":"https"},{"schema":"seal"},{"host":"canva.cn","schema":"https"},{"host":"login.microsoftonline.com","schema":"https"},{"host":"wj.bytedance.com","schema":"https"},{"host":"seal.bytedance.net","schema":"https"},{"host":"www.canva.cn","schema":"https"},{"host":"canva-china.jp.jp.ngrok.io","schema":"https"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.larksuite.com","schema":"https"},{"host":"i.snssdk.com","schema":"https"},{"host":"www.feishu.cn","schema":"https"},{"host":"crashes","schema":"chrome"},{"schema":"itms-services"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.feishu.cn","schema":"lark"},{"host":"applink.larksuite.com","schema":"https"},{"host":"larksuite.help","schema":"https"},{"host":"getfeishu.cn","schema":"https"},{"host":"approval.bytedance.com","schema":"https"},{"host":"applink.larksuite.com","schema":"lark"},{"host":"wiki.bytedance.net","schema":"https"},{"host":"accounts.google.com","schema":"https"}],"orgAuthScope":{},"web_app":{"md5":"","url":"","version_code":""},"userAuthScopeList":{"userLocation":{"mod":1,"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"mod":1,"auth":true,"modifyTime":1668564938000}},"userAuthScope":{"userLocation":{"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"auth":true,"modifyTime":1668564938000}}},"shareLevel":0,"webURL":"","minLarkVersion":""},"components":[{"name":"editor"}],"batchMetaVersion":0,"authData":{"domainsAuthDict":{},"versionUpdateTime":1669265056,"versionState":0,"blackList":[],"authList":[],"gadgetSafeUrls":["https://open.larksuite.com","https://open.feishu.cn","https://open.larksuite.com","https://app.feishu.cn","https://wj.bytedance.com","https://seal.bytedance.net","https://applink.feishu.cn","https://applink.larksuite.com","https://i.snssdk.com","https://www.feishu.cn","https://applink.feishu.cn","https://applink.larksuite.com","https://larksuite.help","https://getfeishu.cn","https://wiki.bytedance.net","https://sso.bytedance.com","https://passport.feishu.cn","https://jira.feishu.cn"],"appStatus":1},"mobileSubPackage":{"page/API":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js"],"pages":["index","pages/login/login","pages/check-session/check-session","pages/vibrate/vibrate","pages/get-user-info/get-user-info","pages/share/share","pages/watermark/watermark","pages/live-check/live-check","pages/choose-contact/choose-contact","pages/set-navigation-bar-title/set-navigation-bar-title","pages/navigator/navigator","pages/pull-down-refresh/pull-down-refresh","pages/animation/animation","pages/action-sheet/action-sheet","pages/modal/modal","pages/toast/toast","pages/get-network-type/get-network-type","pages/get-system-info/get-system-info","pages/keep-screen-brightness/keep-screen-brightness","pages/on-user-capture-screen/on-user-capture-screen","pages/make-phone-call/make-phone-call","pages/scan-code/scan-code","pages/request/request","pages/web-socket/web-socket","pages/upload-file/upload-file","pages/download-file/download-file","pages/image/image","pages/voice/voice","pages/file/file","pages/on-accelerometer-change/on-accelerometer-change","pages/on-compass-change/on-compass-change","pages/canvas/canvas","pages/page-scroll-to/page-scroll-to","pages/inneraudio/inneraudio","pages/video/video","pages/get-location/get-location","pages/open-location/open-location","pages/choose-location/choose-location","pages/storage/storage","pages/get-connected-wifi/get-connected-wifi","pages/get-clipboard-data/get-clipboard-data","pages/on-network-status-change/on-network-status-change","pages/chat/chat","pages/openschema/openschema","pages/device-authentication/device-authentication","pages/password-verify/password-verify","pages/mailto/mailto","pages/choose-chat/choose-chat","pages/get-device-id/get-deviceId","pages/get-launch-query/get-launch-query"],"independent":false,"md5":"e01543d3cf5fdc8e352f4fd75a496698"},"page/componen2":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false,"md5":"9c6101826973c82e0a3b1414c2d21ad0"},"page/component":{"md5":"bff3aa680e2a7846aaa08aac2060baca","path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false},"page/independent":{"md5":"7b5e0dafb01f33b0bf5061a638b4fce1","independent":true,"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js"],"pages":["index"]},"__APP__":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js"],"independent":false,"md5":"ba6d24a04f6b905f4c944800cf8c31e9","pages":["page/index"]}},"appType":1,"iconUrl":"https://s1-imfile.feishucdn.com/static-resource/v1/cace5838-a1c9-4829-a68a-18e4014cfeag","identifier":"cli_a0f543c81b7a900b"}
"""
    }()

    private lazy var mockJSONStringA_v2: String = {
        """
{"appVersion":"1.1.52","versionType":"current","version":"0.1.65","name":"subpackage-test","packageData":{"urls":
["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js"],"md5":"ca7498574d852ca0f27a76f4fd0cec00"},"appID":"cli_a0f543c81b7a900b","compileVersion":"","businessData":{"versionCode":1669259473,"minJSsdkVersion":"","message_action":true,"isFromBuildin":false,"chat_action":true,"extraDict":{"feedback":false,"useOpenSchemaWhiteList":true,"openSchemaWhiteList":[{"host":"itunes.apple.com","schema":"https"},{"host":"app.feishu.cn","schema":"https"},{"schema":"seal"},{"host":"canva.cn","schema":"https"},{"host":"login.microsoftonline.com","schema":"https"},{"host":"wj.bytedance.com","schema":"https"},{"host":"seal.bytedance.net","schema":"https"},{"host":"www.canva.cn","schema":"https"},{"host":"canva-china.jp.jp.ngrok.io","schema":"https"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.larksuite.com","schema":"https"},{"host":"i.snssdk.com","schema":"https"},{"host":"www.feishu.cn","schema":"https"},{"host":"crashes","schema":"chrome"},{"schema":"itms-services"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.feishu.cn","schema":"lark"},{"host":"applink.larksuite.com","schema":"https"},{"host":"larksuite.help","schema":"https"},{"host":"getfeishu.cn","schema":"https"},{"host":"approval.bytedance.com","schema":"https"},{"host":"applink.larksuite.com","schema":"lark"},{"host":"wiki.bytedance.net","schema":"https"},{"host":"accounts.google.com","schema":"https"}],"orgAuthScope":{},"web_app":{"md5":"","url":"","version_code":""},"userAuthScopeList":{"userLocation":{"mod":1,"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"mod":1,"auth":true,"modifyTime":1668564938000}},"userAuthScope":{"userLocation":{"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"auth":true,"modifyTime":1668564938000}}},"shareLevel":0,"webURL":"","minLarkVersion":""},"components":[{"name":"editor"}],"batchMetaVersion":0,"authData":{"domainsAuthDict":{},"versionUpdateTime":1669265056,"versionState":0,"blackList":[],"authList":[],"gadgetSafeUrls":["https://open.larksuite.com","https://open.feishu.cn","https://open.larksuite.com","https://app.feishu.cn","https://wj.bytedance.com","https://seal.bytedance.net","https://applink.feishu.cn","https://applink.larksuite.com","https://i.snssdk.com","https://www.feishu.cn","https://applink.feishu.cn","https://applink.larksuite.com","https://larksuite.help","https://getfeishu.cn","https://wiki.bytedance.net","https://sso.bytedance.com","https://passport.feishu.cn","https://jira.feishu.cn"],"appStatus":1},"mobileSubPackage":{"page/API":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js"],"pages":["index","pages/login/login","pages/check-session/check-session","pages/vibrate/vibrate","pages/get-user-info/get-user-info","pages/share/share","pages/watermark/watermark","pages/live-check/live-check","pages/choose-contact/choose-contact","pages/set-navigation-bar-title/set-navigation-bar-title","pages/navigator/navigator","pages/pull-down-refresh/pull-down-refresh","pages/animation/animation","pages/action-sheet/action-sheet","pages/modal/modal","pages/toast/toast","pages/get-network-type/get-network-type","pages/get-system-info/get-system-info","pages/keep-screen-brightness/keep-screen-brightness","pages/on-user-capture-screen/on-user-capture-screen","pages/make-phone-call/make-phone-call","pages/scan-code/scan-code","pages/request/request","pages/web-socket/web-socket","pages/upload-file/upload-file","pages/download-file/download-file","pages/image/image","pages/voice/voice","pages/file/file","pages/on-accelerometer-change/on-accelerometer-change","pages/on-compass-change/on-compass-change","pages/canvas/canvas","pages/page-scroll-to/page-scroll-to","pages/inneraudio/inneraudio","pages/video/video","pages/get-location/get-location","pages/open-location/open-location","pages/choose-location/choose-location","pages/storage/storage","pages/get-connected-wifi/get-connected-wifi","pages/get-clipboard-data/get-clipboard-data","pages/on-network-status-change/on-network-status-change","pages/chat/chat","pages/openschema/openschema","pages/device-authentication/device-authentication","pages/password-verify/password-verify","pages/mailto/mailto","pages/choose-chat/choose-chat","pages/get-device-id/get-deviceId","pages/get-launch-query/get-launch-query"],"independent":false,"md5":"e01543d3cf5fdc8e352f4fd75a496698"},"page/componen2":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false,"md5":"9c6101826973c82e0a3b1414c2d21ad0"},"page/component":{"md5":"bff3aa680e2a7846aaa08aac2060baca","path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false},"page/independent":{"md5":"7b5e0dafb01f33b0bf5061a638b4fce1","independent":true,"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js"],"pages":["index"]},"__APP__":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js"],"independent":false,"md5":"ba6d24a04f6b905f4c944800cf8c31e9","pages":["page/index"]}},"appType":1,"iconUrl":"https://s1-imfile.feishucdn.com/static-resource/v1/cace5838-a1c9-4829-a68a-18e4014cfeag","identifier":"cli_a0f543c81b7a900b"}
"""
    }()

    private lazy var mockJSONStringB: String = {
        """
{"appVersion":"1.1.52","versionType":"current","version":"0.1.65","name":"subpackage-test","packageData":{"urls":
["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuv_vwaen3ztjid.ttpkg.js"],"md5":"ca7498574d852ca0f27a76f4fd0cec00"},"appID":"cli_a0f543c81b7a999b","compileVersion":"","businessData":{"versionCode":1669259473,"minJSsdkVersion":"","message_action":true,"isFromBuildin":false,"chat_action":true,"extraDict":{"feedback":false,"useOpenSchemaWhiteList":true,"openSchemaWhiteList":[{"host":"itunes.apple.com","schema":"https"},{"host":"app.feishu.cn","schema":"https"},{"schema":"seal"},{"host":"canva.cn","schema":"https"},{"host":"login.microsoftonline.com","schema":"https"},{"host":"wj.bytedance.com","schema":"https"},{"host":"seal.bytedance.net","schema":"https"},{"host":"www.canva.cn","schema":"https"},{"host":"canva-china.jp.jp.ngrok.io","schema":"https"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.larksuite.com","schema":"https"},{"host":"i.snssdk.com","schema":"https"},{"host":"www.feishu.cn","schema":"https"},{"host":"crashes","schema":"chrome"},{"schema":"itms-services"},{"host":"applink.feishu.cn","schema":"https"},{"host":"applink.feishu.cn","schema":"lark"},{"host":"applink.larksuite.com","schema":"https"},{"host":"larksuite.help","schema":"https"},{"host":"getfeishu.cn","schema":"https"},{"host":"approval.bytedance.com","schema":"https"},{"host":"applink.larksuite.com","schema":"lark"},{"host":"wiki.bytedance.net","schema":"https"},{"host":"accounts.google.com","schema":"https"}],"orgAuthScope":{},"web_app":{"md5":"","url":"","version_code":""},"userAuthScopeList":{"userLocation":{"mod":1,"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"mod":1,"auth":true,"modifyTime":1668564938000}},"userAuthScope":{"userLocation":{"auth":true,"modifyTime":1668564978000},"writePhotosAlbum":{"auth":true,"modifyTime":1668564938000}}},"shareLevel":0,"webURL":"","minLarkVersion":""},"components":[{"name":"editor"}],"batchMetaVersion":0,"authData":{"domainsAuthDict":{},"versionUpdateTime":1669265056,"versionState":0,"blackList":[],"authList":[],"gadgetSafeUrls":["https://open.larksuite.com","https://open.feishu.cn","https://open.larksuite.com","https://app.feishu.cn","https://wj.bytedance.com","https://seal.bytedance.net","https://applink.feishu.cn","https://applink.larksuite.com","https://i.snssdk.com","https://www.feishu.cn","https://applink.feishu.cn","https://applink.larksuite.com","https://larksuite.help","https://getfeishu.cn","https://wiki.bytedance.net","https://sso.bytedance.com","https://passport.feishu.cn","https://jira.feishu.cn"],"appStatus":1},"mobileSubPackage":{"page/API":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_nrg8sgaald.ttpkg.js"],"pages":["index","pages/login/login","pages/check-session/check-session","pages/vibrate/vibrate","pages/get-user-info/get-user-info","pages/share/share","pages/watermark/watermark","pages/live-check/live-check","pages/choose-contact/choose-contact","pages/set-navigation-bar-title/set-navigation-bar-title","pages/navigator/navigator","pages/pull-down-refresh/pull-down-refresh","pages/animation/animation","pages/action-sheet/action-sheet","pages/modal/modal","pages/toast/toast","pages/get-network-type/get-network-type","pages/get-system-info/get-system-info","pages/keep-screen-brightness/keep-screen-brightness","pages/on-user-capture-screen/on-user-capture-screen","pages/make-phone-call/make-phone-call","pages/scan-code/scan-code","pages/request/request","pages/web-socket/web-socket","pages/upload-file/upload-file","pages/download-file/download-file","pages/image/image","pages/voice/voice","pages/file/file","pages/on-accelerometer-change/on-accelerometer-change","pages/on-compass-change/on-compass-change","pages/canvas/canvas","pages/page-scroll-to/page-scroll-to","pages/inneraudio/inneraudio","pages/video/video","pages/get-location/get-location","pages/open-location/open-location","pages/choose-location/choose-location","pages/storage/storage","pages/get-connected-wifi/get-connected-wifi","pages/get-clipboard-data/get-clipboard-data","pages/on-network-status-change/on-network-status-change","pages/chat/chat","pages/openschema/openschema","pages/device-authentication/device-authentication","pages/password-verify/password-verify","pages/mailto/mailto","pages/choose-chat/choose-chat","pages/get-device-id/get-deviceId","pages/get-launch-query/get-launch-query"],"independent":false,"md5":"e01543d3cf5fdc8e352f4fd75a496698"},"page/componen2":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznux_c00vlcr3soe.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false,"md5":"9c6101826973c82e0a3b1414c2d21ad0"},"page/component":{"md5":"bff3aa680e2a7846aaa08aac2060baca","path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuw_jektg1tsnqb.ttpkg.js"],"pages":["index","pages/view/view","pages/scroll-view/scroll-view","pages/swiper/swiper","pages/text/text","pages/icon/icon","pages/progress/progress","pages/button/button","pages/checkbox/checkbox","pages/form/form","pages/input/input","pages/label/label","pages/picker/picker","pages/radio/radio","pages/slider/slider","pages/switch/switch","pages/textarea/textarea","pages/richtext/richtext","pages/navigator/navigator","pages/navigator/navigate","pages/navigator/redirect","pages/image/image","pages/video/video","pages/canvas/canvas","pages/web-view/web-view","pages/editor/editor","pages/picker-view/picker-view"],"independent":false},"page/independent":{"md5":"7b5e0dafb01f33b0bf5061a638b4fce1","independent":true,"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_lkm8hdqqo3b.ttpkg.js"],"pages":["index"]},"__APP__":{"path":["https://sf3-scmcdn-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js","https://sf3-cn.feishucdn.com/obj/larkdeveloper/app/cli_a0f543c81b7a900b/current/gadget_mobile_splits_pkg/lauhznuy_6vxzf9v81qq.ttpkg.js"],"independent":false,"md5":"ba6d24a04f6b905f4c944800cf8c31e9","pages":["page/index"]}},"appType":1,"iconUrl":"https://s1-imfile.feishucdn.com/static-resource/v1/cace5838-a1c9-4829-a68a-18e4014cfeag","identifier":"cli_a0f543c81b7a900b"}
"""
    }()
}
